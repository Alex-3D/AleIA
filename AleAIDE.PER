; SAMPLE AOK AI FILE
; 17 MAY 2000

; Timers definition
(defconst VillagerTimer 1)				; Villager production control
;(defconst HelpTimer 2)					; Timer for managing help requests
(defconst MonkspeedTimer 3)
(defconst InfanteriaspeedTimer 4)
(defconst CaballeriaspeedTimer 5)
(defconst ArqueriaspeedTimer 6)
(defconst UniquespeedTimer 7)
(defconst siegespeedTimer 8)
(defconst farmspeedTimer 9)
(defconst AttackTimer 2)
(defconst TributeTimer 6)
(defconst ShipsTimer 10)
(defconst haxTimer 11)
(defconst chatTimer 12)

; Goals definition
(defconst Age 1)							; Age goal
(defconst AllowMilitaryUnits 23)			; Goal for all	ow military production
(defconst AllowMilitaryTechs 24)			; Goal for allow military technologies
(defconst AllowboatTechs 25)
(defconst Advantage 26)						; Goal to determine advantage AI/enemy/NONE
(defconst ArmyAdvantage 31)					; Goal to determine army advantage AI/enemy/NONE
(defconst ATTACK 2)
(defconst Allowmilitaryboats 4)
(defconst EnemyWarboats 5)
(defconst oceanmap 6)
(defconst watermap 7)
(defconst techstime 8)
(defconst needRecourses 9)
(defconst feudalWars 10)
(defconst techsready 11)
(defconst Farmtime 12)
(defconst Needcannongaleon 13)
(defconst EnabledAttack 18)
(defconst Food 19)
(defconst Wood 20)
(defconst Gold 21)
(defconst Ston 22)
(defconst Farms 28)
(defconst UnitType 29)
(defconst UnitType2 30)
(defconst Gold? 32)
(defconst Formation 33)
(defconst EnemyCab 34)
(defconst EnemyInf 35)
(defconst LandTrade 36)
(defconst HumanAttacks 37)
(defconst HumanTactical 38)
(defconst Almirante 39)
(defconst Archipielago 40)
(defconst Wonderr 15)
(defconst Estrategia 41)
(defconst HumanEstrategia 42)
(defconst RushLevel 43)
(defconst dificultad 44)
(defconst wallMap 45)
(defconst isTreaty 46)
(defconst gl-treaty-time 47)
(defconst treaty-time 54)

(defconst NONE 0)
(defconst SLOW 2)

; Constants for goal Estrategia
(defconst Std 0)
(defconst Agre 1)
(defconst Eco 2)

; Constants for goal Advantage
(defconst PLAYER 1)
(defconst ENEMY 2)

; Constants for goal Age
(defconst RESEARCHFEUDAL 0)
(defconst RESEARCHCASTLE 1)
(defconst GOTOIMPERIAL 2)
(defconst RESEARCHIMPERIAL 3)
(defconst IMPERIAL 4)

;Recursos
(defconst DEMASIADO 0)
(defconst MUCHO 1)
(defconst MEDIO 2)
(defconst VAJO 3)

; Constants for goal AllowMilitaryUnits
(defconst NO 0)
(defconst YES 1)
(defconst MANY 3)

; Constants for goal Allowmilitaryboats
;(defconst NO 0)
;(defconst YES 1)
 
; Constants for goal ATTACK
;(defconst NO 0)
;(defconst YES 1)

; Constants for goal oceanmap and watermap
;(defconst NO 0)
;(defconst YES 1)

; Constants for goal EnemyWarboats
;(defconst NO 0)
;(defconst YES 1)
(defconst HUMAN 3)

; Constants for goal Units
(defconst INF 0)
(defconst CAB 1)
(defconst ARQ 2)
(defconst UNI 3)
(defconst MONK 4)
(defconst DEFENSE 5)

; Constants for goal Almirante
(defconst NIVELN 1)
(defconst NIVEL1 2)
(defconst NIVEL2 3)
(defconst NIVEL3 4)
(defconst NIVEL4 5)
(defconst NIVEL5 6)
(defconst NIVEL6 7)

; Constants for goal RushLevel
(defconst CERO 0)
(defconst INTR 1)
(defconst MAX 2)

; Constants for goal Wonderr
(defconst NADA 1)
(defconst POSIBLE 2)
(defconst ENEMYW 3)
(defconst MYW 4)
(defconst RELIK 5)
(defconst ALLYW 6)

; Constants for goal Dificultad (Por ahora un parche al bug de deteccion de dificultad)
(defconst menosQueHard 0)
(defconst masQueModerado 1)
(defconst MAX 2)

; Constants for goal Muro wallMap
(defconst veryFriendly 0)
(defconst friendly 1)
(defconst standard 2)
(defconst choto 3)

; Constants to define large groops of units

(defconst footranged 900)		; such as archer and skirms
(defconst mountedranged 936)	; such as cavarchers
(defconst footmelee 906)		; such as militia and berserks
(defconst mountedmelee 912)		; such as knights and cataphrats
(defconst warships 922)			; such as warships ^^
(defconst gunpowder 944)		; such as polvora?
(defconst elite-kipchak-mercenary 1260)

; ============== GROUPS - most of these will work for any file

(defrule
	(true)
=>
	(set-strategic-number sn-attack-intelligence 1)
	(set-strategic-number sn-gold-defend-priority 3)
	(set-strategic-number sn-town-defend-priority 6)
	(set-strategic-number sn-stone-defend-priority 4)
	(set-strategic-number sn-forage-defend-priority 7)
	(set-strategic-number sn-number-defend-groups 0)
	(set-strategic-number sn-gather-defense-units 1)
	(set-strategic-number sn-attack-group-gather-spacing 20)				; 4 default; Distance from gather point in grouping phases
	(set-strategic-number sn-defense-distance 3)						; Town/gold/stone defense distance ( 3 default )
	(set-strategic-number sn-sentry-distance 20)						; Town defense over max town size
	(set-strategic-number sn-target-evaluation-ally-proximity 1000)		; Attacks enemies near allies
	(set-strategic-number sn-target-evaluation-continent 90)			; Attack before enemies in the same continent
	(set-strategic-number sn-target-evaluation-boat 100)
	(set-strategic-number sn-target-evaluation-siege-weapon 100)
	(disable-self)
)


(defrule
	(true)
=>
	(set-strategic-number sn-relic-defend-priority 5)
	(set-strategic-number sn-coop-share-attacking 1)
	(set-strategic-number sn-maximum-gaia-attack-response 2)
	(set-strategic-number sn-minimum-attack-group-size 40)
	(set-strategic-number sn-garrison-rams 0)
	(set-strategic-number sn-relic-return-distance 999)
	(set-strategic-number sn-ignore-attack-group-under-attack -1)
	;(set-strategic-number sn-special-attack-influence1 9999)
        ;(set-strategic-number sn-special-attack-type1 villager)
	(set-strategic-number sn-dock-defend-priority 1)
	(set-strategic-number sn-percent-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-explorers 0)
	(set-strategic-number sn-target-evaluation-distance 10)	
	(set-strategic-number sn-preferred-trade-distance 255);255 ;it is only the preferred trade distance, not max. 255 is the max value
	(up-chat-data-to-player my-player-number "sn-focus-player: %d." s: sn-focus-player-number)
	(up-chat-data-to-player my-player-number "sn-target-player: %d." s: sn-target-player-number)
	(disable-self)
)

(defrule
	(true)
=>
	(set-strategic-number sn-target-evaluation-range -10)	
	(set-strategic-number sn-attack-winning-player 0)
	(set-strategic-number sn-attack-winning-player-factor 1)  ;25
	(generate-random-number 100)						;///RANDOM!!!
	(disable-self)
)

#load-if-not-defined REVEAL-NORMAL
(defrule
	(true)
=>
	(set-strategic-number sn-unexplored-construction 1) ;means ai can build in places that have not been explored yet
	(disable-self))
#end-if

;/////////////////////// FORMA DE EXPLORAR /////////////////////////
;#load-if-defined DARK-AGE-START
(defrule
	(game-time > 1)
	(food-amount <= 1500)
=>
	(set-strategic-number sn-home-exploration-time 900) ;just under 10 minutes
	(disable-self)
)
;#else
(defrule
	(game-time > 1)
	(food-amount > 1500)
	(food-amount <= 6000)
=>
	(set-strategic-number sn-home-exploration-time 300) ;5 minutes
	(disable-self)
)

(defrule
	(game-time > 1)
	(food-amount > 6000)

=>
	(set-strategic-number sn-home-exploration-time 180) ;3 minutes
	(disable-self)
)
;#end-if

	;scout the border ;NEW
(defrule
	(game-time > 2)
	(goal Estrategia Eco)
	(food-amount <= 6000)
	(game-time s:> sn-home-exploration-time) 
=>
	(chat-to-player my-player-number "Scouting the border.")
	(up-send-scout group-type-land-explore scout-border) ;scout the border closest to them
	(disable-self)
)

(defrule
	(game-time > 2)
	(or
		(not (goal Estrategia Eco)) (food-amount > 6000)
	)
	(game-time s:> sn-home-exploration-time) 
=>
	(chat-to-player my-player-number "Scouting the flank (enemy).")
	(up-send-scout group-type-land-explore scout-flank) ;scout the border closest to them
	(disable-self)
)

(defrule
	(game-time > 1800)
	(game-time s:> sn-home-exploration-time) 
=>
	(chat-to-player my-player-number "Scouting the corner.")
	(up-send-scout group-type-land-explore scout-corner) ;Scouts the location of the corner closest to position-self (the location of the player's oldest Town Center).
	(disable-self)
)

;/////////////////////////////////////////////////////////////////

(defrule
	                (not (map-type archipelago) )
=>
	(set-strategic-number sn-coop-share-information 1)
	(disable-self)
)

(defrule
	                (map-type archipelago)
=>
	(set-strategic-number sn-coop-share-information 0)
	(disable-self)
)

(defrule
	(or
	(building-type-count-total market < 1)		(goal oceanmap YES))
=>
	(set-strategic-number sn-number-build-attempts-before-skip 100)	;25
	(set-strategic-number sn-max-skips-per-attempt 100)	;10
)

(defrule
	(building-type-count-total market >= 1)
		(goal oceanmap NO)
=>
	(set-strategic-number sn-number-build-attempts-before-skip 25)	;25
	(set-strategic-number sn-max-skips-per-attempt 10)	;10
)

; ///////////////////Reglas para las carretas de mercancias (distancia entre mercado)////////////////////
(defrule
(or	(unit-type-count 178 > 4);dead trade cart (empty/loaded)
	(unit-type-count 205 > 4))
	(strategic-number sn-preferred-trade-distance > 60)
=>
	(set-strategic-number sn-preferred-trade-distance 60)
)

(defrule
	(unit-type-count 178 == 0);dead trade cart (empty/loaded)
	(unit-type-count 205 == 0)
	(strategic-number sn-preferred-trade-distance <= 60)
=>
	(set-strategic-number sn-preferred-trade-distance 255)
)


;...///////TOWN SIZE/////////

(defrule
	(true)
=>
	(set-strategic-number sn-maximum-hunt-drop-distance 30)
	(set-strategic-number sn-maximum-town-size 15)
        (set-strategic-number sn-camp-max-distance 20)
        (set-strategic-number sn-mill-max-distance 30)
	(set-strategic-number sn-percent-enemy-sighted-response 80)
	(set-strategic-number sn-enemy-sighted-response-distance 10)
	(set-strategic-number sn-number-explore-groups 1)
	(set-strategic-number sn-maximum-gold-drop-distance 20)
	(set-strategic-number sn-maximum-stone-drop-distance 20)
	(set-strategic-number sn-maximum-food-drop-distance 20)
	(disable-self)
)

(defrule
	(current-age == feudal-age)
=>
	(set-strategic-number sn-maximum-hunt-drop-distance 30)
	(set-strategic-number sn-maximum-town-size 20)
        (set-strategic-number sn-camp-max-distance 30)
        (set-strategic-number sn-mill-max-distance 30)
	(set-strategic-number sn-percent-enemy-sighted-response 100)
	(set-strategic-number sn-enemy-sighted-response-distance 20)
	(set-strategic-number sn-number-explore-groups 1)
	(set-strategic-number sn-maximum-gold-drop-distance 20)
	(set-strategic-number sn-maximum-stone-drop-distance 20)
	(set-strategic-number sn-maximum-food-drop-distance 20)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
=>
	(set-strategic-number sn-maximum-hunt-drop-distance 30)
	(set-strategic-number sn-maximum-town-size 25)
        (set-strategic-number sn-camp-max-distance 35)
        (set-strategic-number sn-mill-max-distance 30)
	(set-strategic-number sn-percent-enemy-sighted-response 100)
	(set-strategic-number sn-enemy-sighted-response-distance 10)
;	(set-strategic-number sn-number-explore-groups 1)
	(set-strategic-number sn-maximum-gold-drop-distance 20)
	(set-strategic-number sn-maximum-stone-drop-distance 20)
	(set-strategic-number sn-maximum-food-drop-distance 20)
	(set-strategic-number sn-maximum-wood-drop-distance 15)
	(disable-self)
)

(defrule
	(current-age == castle-age)
	(building-type-count lumber-camp >= 1)
=>
        (set-strategic-number sn-camp-max-distance 50)
	(disable-self)
)

(defrule
	(current-age >= imperial-age)
	(building-type-count lumber-camp >= 1)
=>
        (set-strategic-number sn-camp-max-distance 100)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(goal oceanmap NO)
	(building-type-count-total castle <= 2)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 25)
)

(defrule
	(current-age == imperial-age)
	(goal oceanmap NO)
	(building-type-count-total castle > 2)
	(building-type-count-total castle <= 4)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 30)
)

(defrule
	(current-age == imperial-age)
	(goal oceanmap NO)
	(building-type-count-total castle > 4)
	(building-type-count-total castle <= 6)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 35)
)

(defrule
	(current-age == imperial-age)
	(goal oceanmap NO)
	(building-type-count-total castle > 6)
	(building-type-count-total castle <= 10)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 40)
)

(defrule
	(current-age == imperial-age)
	(goal oceanmap NO)
	(building-type-count-total castle > 10)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 50)
)

(defrule
	(current-age >= castle-age)
	(goal oceanmap YES)
	(not (strategic-number sn-maximum-town-size == 70))
=>
	(set-strategic-number sn-maximum-town-size 60)
        (set-strategic-number sn-camp-max-distance 200)
)

(defrule
	(current-age == imperial-age)
	(or
	(cc-players-building-count any-enemy > 10)		(unit-type-count villager < 55))
=>
	(set-strategic-number sn-enemy-sighted-response-distance 20)
)

(defrule
	(current-age == imperial-age)
	(cc-players-building-count any-enemy < 10)
	(not (cc-players-building-count any-enemy > 10))
	(unit-type-count villager > 55)
=>
	(set-strategic-number sn-enemy-sighted-response-distance 20)
)

(defrule
	(current-age == imperial-age)
	(cc-players-building-count any-enemy < 5)
	(not (cc-players-building-count any-enemy > 10))
	(unit-type-count villager > 65)
=>
	(set-strategic-number sn-enemy-sighted-response-distance 30)
)

(defrule
	(current-age == imperial-age)
	(cc-players-building-count any-enemy <= 3)
	(not (cc-players-building-count any-enemy > 10))
	(unit-type-count villager > 65)
=>
	(set-strategic-number sn-enemy-sighted-response-distance 50)
)

(defrule
	(current-age == imperial-age)
	(cc-players-building-count any-enemy < 2)
	(not (cc-players-building-count any-enemy > 10))
	(unit-type-count villager > 65)
=>
	(set-strategic-number sn-enemy-sighted-response-distance 100)
)

;///////////////////////////////HAX/////////////////////////////////////////

(defrule
	(game-time > 10)
	(not (goal dificultad masQueModerado))
=>
	(set-goal dificultad menosQueHard)
	(disable-self)
)

#load-if-defined DIFFICULTY-HARD

(defrule
	(true)
=>
	(set-goal dificultad masQueModerado)
	(disable-self)
)

#end-if

#load-if-defined DIFFICULTY-HARDEST

(defrule
	(true)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(set-goal dificultad masQueModerado)
	(disable-self)
)

(defrule
	(current-age == feudal-age)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(disable-self)
)

(defrule
	(current-age == castle-age)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(disable-self)
)
#end-if

#load-if-defined DIFFICULTY-EXTREME
(defrule
	(true)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(set-goal dificultad masQueModerado)
	(disable-self)
)

(defrule
	(current-age >= feudal-age)
=>
	(cc-add-resource wood 1000)
	(cc-add-resource food 1000)
	(cc-add-resource gold 1000)
	(cc-add-resource stone 500)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
=>
	(cc-add-resource wood 2000)
	(cc-add-resource food 2000)
	(cc-add-resource gold 2000)
	(cc-add-resource stone 2000)
	(disable-self)
)

(defrule
	(game-time > 1800)
=>
	(cc-add-resource wood 200)
	(cc-add-resource food 100)
	(cc-add-resource gold 100)
	(cc-add-resource stone 300)
	(disable-timer haxTimer)
	(enable-timer haxTimer 300)
	(disable-self)
)


(defrule
	(timer-triggered haxTimer)

=>
	(cc-add-resource wood 50)
	(cc-add-resource food 50)
	(cc-add-resource gold 50)
	(cc-add-resource stone 20)
	(disable-timer haxTimer)
	(enable-timer haxTimer 60)
)
#end-if

;////////////////////////////////Land trade?/////////////////////////////////


(defrule
	(true)
=>
	(set-goal LandTrade NO)
	(set-goal Archipielago NO)
	(disable-self)
)

(defrule
                (not (goal Archipielago YES) )
                (not (map-type islands) )
                (not (map-type salt-marsh) )
                ;(not (map-type rivers) )
	(game-time > 30)
=>
	(set-goal LandTrade YES)
	(chat-local-to-self "Land trade!")
	(disable-self)
)


(defrule
               (map-type archipelago)
	(game-time > 1300)
=>
	(set-strategic-number sn-coop-share-information 1)
	(disable-self)
)

(defrule
	(not (goal LandTrade YES))
	(taunt-detected any-ally 53)
=>
	(acknowledge-taunt this-any-ally 53)
	(chat-to-allies "Ok! Enseguida mando mis carretas de mercansias!")
	(set-goal LandTrade YES)
	(chat-to-allies "53")
)

(defrule
	(not (goal LandTrade NO))
	(taunt-detected any-ally 54)
=>
	(acknowledge-taunt this-any-ally 54)
	(chat-to-allies "Entendido! No habra comercio por tierra...")
	(set-goal LandTrade NO)
	(chat-to-allies "54")
)

;(defrule
;               (map-type archipelago)
;	(game-time > 50)
;	(game-time < 1200)
;	(players-unit-type-count any-ally villager > 1)
;	(players-building-count any-ally > 1)
;=>
;	(set-goal LandTrade YES)
;	(chat-local-to-self "Land trade!")
;	(disable-self)
;)

;============================= DETECTOR DE MAPAS ******************

;*************************************************************
(defrule
	(not (map-type highland) ) 	
	(not (map-type scandanavia))
=>
	(set-strategic-number sn-minimum-water-body-size-for-dock 3000)
	(disable-self)
)
;*************************************************************

(defrule							; Goal initialization
	(true)
=>
	(set-goal watermap NO)
	(set-goal oceanmap NO)
	(disable-self)
)

;*******************************
#load-if-defined ARCHIPELAGO-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting WATER map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(set-goal wallMap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined ISLANDS-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean map!")
	(set-goal oceanmap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined MIGRATION-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean map!")
	(set-goal oceanmap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined TEAM-ISLANDS-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean map!")
	(set-goal oceanmap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-SPAIN-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-ENGLAND-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)


#end-if
;*******************************
#load-if-defined REAL-WORLD-ITALY-MAP

(defrule
		(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-JUTLAND-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-NIPPON-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-BYZANTIUM-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting ocean? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-MIDEAST-MAP

(defrule
	(game-time > 300)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-TEXAS-MAP
(defrule
	(game-time > 300)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-CARIBBEAN-MAP

(defrule
	(game-time > 300)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined REAL-WORLD-FRANCE-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined CUSTOM-MAP
(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water?? map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined NOMAD-MAP

(defrule
	(game-time > 300)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)

(defrule
	(game-time < 90)
=>
	(set-strategic-number sn-minimum-civilian-explorers 6)

	(set-strategic-number sn-cap-civilian-explorers 6)
	(set-strategic-number sn-cap-civilian-builders 0)
	(set-strategic-number sn-cap-civilian-gatherers 0)

	(set-strategic-number sn-percent-civilian-explorers 100)
	(set-strategic-number sn-percent-civilian-builders 0)
	(set-strategic-number sn-percent-civilian-gatherers 0)

	(disable-self)
)

(defrule
	(game-time > 180)
	(unit-type-count villager < 15)
	(starting-resources < high-resources)
	(or
		(unit-type-count scout-cavalry == 0)
		(unit-type-count eagle-warrior == 0)
	)
=>
	(set-strategic-number sn-minimum-civilian-explorers 1)
	(set-strategic-number sn-cap-civilian-explorers 1)
	(set-strategic-number sn-percent-civilian-explorers 5)
	(set-strategic-number sn-percent-civilian-builders 15)
	(set-strategic-number sn-percent-civilian-gatherers 80)
	(disable-self)
)

(defrule
	(game-time > 180)
	(unit-type-count villager < 15)
	(starting-resources == high-resources)
	(or
		(unit-type-count scout-cavalry == 0)
		(unit-type-count eagle-warrior == 0)
	)
=>
	(set-strategic-number sn-minimum-civilian-explorers 1)
	(set-strategic-number sn-cap-civilian-explorers 1)
	(set-strategic-number sn-percent-civilian-explorers 5)
	(set-strategic-number sn-percent-civilian-builders 80)
	(set-strategic-number sn-percent-civilian-gatherers 15)
	(disable-self)
)

(defrule
   (game-time > 30)
	(building-type-count town-center < 1)
	(can-build town-center)
=>
	(build town-center)
)


#load-if-defined HUN-CIV
(defrule
	(building-type-count-total town-center > 0)
	(building-type-count-total mill == 0)
	(can-build mill)
=>
	(build mill)
)
#end-if
#end-if
;*******************************
#load-if-defined GOLD-RUSH-MAP

(defrule
	(true)
=>
	(chat-local-to-self "detecting land map!")
	(disable-self)
)

(defrule
	(not(town-under-attack))
	(soldier-count > 30)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 1)
)

(defrule
	(soldier-count < 30)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 0)
)
#end-if
;*******************************
#load-if-defined SALT-MARSH-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(set-strategic-number sn-minimum-water-body-size-for-dock 1500)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined SCANDANAVIA-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)	;NOOOOOOOOOOO! ahora si :)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined BALTIC-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(set-goal wallMap veryFriendly)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined COASTAL-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(set-goal wallMap friendly)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined CONTINENTAL-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined CRATER-LAKE-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined MEDITERRANEAN-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(set-goal wallMap veryFriendly)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined RIVERS-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(set-goal wallMap veryFriendly)
	(disable-self)
)
#end-if
;*******************************
#load-if-defined HIGHLAND-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal watermap YES)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined SCENARIO-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting Scenario map!")
	(set-goal watermap YES)
	(set-goal Archipielago YES)
	(chat-to-all-using-id 22145)
	(chat-to-all-using-id 22146)
		;"If this is an all-land or an island map, then please"
		;"rework thy AI script accordingly."
	(chat-to-all "¡Asi que decime de que es este mapa!")
	(disable-self)
)

#end-if
;*******************************
#load-if-defined YUCATAN-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting map!")
	(set-goal wallMap friendly)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined ARENA-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting map!")
	(set-goal wallMap choto)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined FORTRESS-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting map!")
	(set-goal wallMap choto)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined BLACK-FOREST-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting water map!")
	(set-goal wallMap friendly)
	(disable-self)
)

#end-if
;*******************************
#load-if-defined OASIS-MAP

(defrule
	(game-time > 3)
=>
	(chat-local-to-self "detecting map!")
	(set-goal wallMap veryFriendly)
	(disable-self)
)

#end-if
;***********************************************************

(defrule
	(or
	(goal Archipielago YES)	(goal Almirante NIVEL6))
	(goal watermap YES)
	(not (goal EnemyWarboats HUMAN))
	(goal EnemyWarboats YES)
=>
	(set-goal oceanmap YES)
	(set-goal watermap NO)
)

(defrule
	(or
	(goal Archipielago YES)	(goal Almirante NIVEL6))
	(goal oceanmap YES)
	(not (goal EnemyWarboats HUMAN))
	(goal EnemyWarboats NO)
=>
	(set-goal oceanmap NO)
	(set-goal watermap YES)
	(set-strategic-number sn-percent-attack-soldiers 100)
)

(defrule
               (goal Archipielago YES)
	(civ-selected gothic)
	(game-time > 30)
	(game-time < 1200)
	(players-unit-type-count any-ally villager == 0)
	(players-unit-type-count any-enemy villager > 0)
	(players-building-count any-enemy > 0)
=>
	(set-goal EnemyWarboats HUMAN)
	(set-goal oceanmap NO)
	(set-goal watermap YES)
	(chat-local-to-self "Enemigo en la misma isla!!!")
	(disable-self)
)

(defrule
               (goal Archipielago YES)
	(civ-selected gothic)
	(game-time > 1250)
	(players-unit-type-count any-ally villager == 0)
	(players-unit-type-count any-enemy villager == 0)
	(players-building-count any-enemy == 0)
	(not (goal EnemyWarboats HUMAN))
=>
	(set-goal EnemyWarboats HUMAN)
	(set-goal oceanmap YES)
	(set-goal watermap NO)
	(chat-local-to-self "¿donde esta el enemigo?")
	(disable-self)
)

(defrule
               (goal Archipielago YES)
	(not (civ-selected gothic))
	(current-age-time > 500)
	(current-age-time < 900)
	(current-age >= feudal-age)
	(building-type-count stone-wall-line > 0)
	(building-type-count gate > 0)
=>
	(set-goal EnemyWarboats HUMAN)
	(set-goal oceanmap NO)
	(set-goal watermap YES)
	(chat-to-allies "16 Enemigo en la misma isla!!!")
	(chat-local-to-self "Enemigo en la misma isla!!!")
	(disable-self)
)

(defrule
               (goal Archipielago YES)
	(not (civ-selected gothic))
	(current-age-time > 500)
	(current-age-time < 900)
	(current-age >= feudal-age)
	(building-type-count stone-wall-line == 0)
	(building-type-count gate == 0)
=>
	(set-goal EnemyWarboats HUMAN)
	(set-goal oceanmap YES)
	(set-goal watermap NO)
	(chat-to-allies "17 No hay muros en la costa XD...")
	(chat-local-to-self "No hay muros en la costa XD...")
	(disable-self)
)

(defrule
               (goal Archipielago YES)
	(player-resigned any-enemy)
	(goal watermap YES)
=>
	(set-goal EnemyWarboats NO)
	(chat-local-to-self "Debuelta a los parametros normales")
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(current-age-time > 1200)
	(not (map-type archipelago))
	(goal watermap YES)
	(not (goal EnemyWarboats YES))
	(cc-players-building-type-count any-enemy dock < 1)
	(building-type-count-total dock less-than 1)
	(unit-type-count-total warships < 1)
	(cc-players-unit-type-count any-enemy warships < 1)
=>
	(set-goal watermap NO)
)

(defrule
	(not (map-type archipelago))
	(current-age >= castle-age)
	(current-age-time > 1200)
	(not (goal watermap YES))
	(not (goal oceanmap YES))
	(cc-players-building-type-count any-enemy dock > 1)
	(cc-players-unit-type-count any-enemy warships > 1)
=>
	(set-goal watermap YES)							;por las dudas...
)



; ============== ATTACK GROUPS - changing percent attack soldiers will make an AI weak or tough

(defrule
	(true)
=>
	(set-strategic-number sn-task-ungrouped-soldiers 0)
	(set-strategic-number sn-percent-attack-soldiers 85)
	(set-strategic-number sn-percent-attack-boats 75)
;	(set-strategic-number sn-number-explore-groups 1)
	(set-strategic-number sn-number-boat-explore-groups 0)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
		(game-time <= 900)
	(food-amount >= 5000)
=>
	(set-strategic-number sn-number-explore-groups 5)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(or
		(game-time > 900)	(food-amount < 5000))
=>
	(set-strategic-number sn-number-explore-groups 1)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(game-time > 950)
	(town-under-attack)
	(soldier-count < 30)

=>
	(set-strategic-number sn-number-explore-groups 0)
)

(defrule
	(current-age >= castle-age)
	(game-time > 950)
	(not (town-under-attack))

=>
	(set-strategic-number sn-number-explore-groups 1)
)

(defrule
	(unit-type-count galley-line > 0)
=>
	(set-strategic-number sn-number-boat-explore-groups 1)
	(disable-self)
)

(defrule
		(game-time > 3600)
	(goal watermap YES)
=>
	(set-strategic-number sn-number-boat-explore-groups 1)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
		(goal oceanmap YES)
		(game-time > 30)
	(unit-type-count transport-ship < 2)
=>
	(set-strategic-number sn-percent-attack-soldiers 0)
)

(defrule
	(current-age >= castle-age)
		(goal oceanmap YES)
		(game-time > 30)
	(unit-type-count transport-ship >= 2)
=>
	(set-strategic-number sn-percent-attack-soldiers 75)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap NO)
		(game-time > 30)
=>
	(set-strategic-number sn-percent-attack-soldiers 100)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap NO)
		(game-time > 30)
	(unit-type-count warships < 10)
=>
	(set-strategic-number sn-percent-attack-boats 0)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap NO)
		(game-time > 30)
	(unit-type-count warships >= 10)
=>
	(set-strategic-number sn-percent-attack-boats 75)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap YES)
		(game-time > 30)
	(unit-type-count warships < 5)
=>
	(set-strategic-number sn-percent-attack-boats 0)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap YES)
		(game-time > 30)
	(unit-type-count warships >= 5)
=>
	(set-strategic-number sn-percent-attack-boats 90)
)

(defrule
	(current-age == imperial-age)
		(goal oceanmap YES)
		(game-time > 30)
=>
	(set-strategic-number sn-percent-attack-boats 90)
	(disable-self)
)

; ================== RESIGNING -----------------------------

(defrule
	(building-type-count town-center less-than 1)
	(unit-type-count-total villager < 3)
	(unit-type-count-total warships < 5)	
	(not (can-train villager) )
	(building-type-count castle less-than 1)
	(building-type-count wonder less-than 1)
=>
	(set-goal 1 19)
	(disable-self)
)

(defrule
	(goal 1 9)
=>
	(resign)
	(disable-self)
)

; ============== VILLAGER ASSIGNMENT - most of these will work for any file  ECONOMIA

(defrule
	(unit-type-count villager <= 15)
	(housing-headroom greater-than 2)	
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  90)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  10)
)

(defrule
	(unit-type-count villager <= 15)
	(housing-headroom less-than 2)
	(population-headroom greater-than 0)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  70)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  30)
)

(defrule
	(unit-type-count villager > 15)
	(unit-type-count villager <= 20)
=>
	(set-strategic-number sn-percent-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  70)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  30)
)

(defrule
	(current-age == dark-age)
	(unit-type-count villager > 20)
	(building-type-count lumber-camp < 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  60)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  40)
)

(defrule
	(current-age == dark-age)
	(unit-type-count villager > 20)
	(building-type-count lumber-camp >= 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  80)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  20)
)

(defrule
	(current-age == dark-age)
	(not (goal oceanmap YES))
	(goal Age RESEARCHFEUDAL)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  40)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  60)
)

(defrule
	(current-age == dark-age)
	(and
	(goal Age RESEARCHFEUDAL)	(goal oceanmap YES)
	)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  30)
	(set-strategic-number sn-gold-gatherer-percentage  0)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  70)
)

(defrule
	(current-age == feudal-age)
	(not (goal oceanmap YES))
	(goal AllowMilitaryUnits NO)
	(not (goal watermap YES))
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  40)
	(set-strategic-number sn-gold-gatherer-percentage  5)
	(set-strategic-number sn-stone-gatherer-percentage 10)
	(set-strategic-number sn-wood-gatherer-percentage  45)
)

(defrule
	(current-age == feudal-age)
	(goal watermap YES)
	(goal AllowMilitaryUnits NO)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  35)
	(set-strategic-number sn-gold-gatherer-percentage  5)
	(set-strategic-number sn-stone-gatherer-percentage 10)
	(set-strategic-number sn-wood-gatherer-percentage  50)
)

(defrule
	(current-age == feudal-age)
	(goal oceanmap YES)
	(goal AllowMilitaryUnits NO)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  35)
	(set-strategic-number sn-gold-gatherer-percentage  10)
	(set-strategic-number sn-stone-gatherer-percentage 5)
	(set-strategic-number sn-wood-gatherer-percentage  50)
)

(defrule
	(current-age == feudal-age)
	(not (goal oceanmap YES))
	(unit-type-count villager > 20)
	(goal AllowMilitaryUnits YES)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  45)
	(set-strategic-number sn-gold-gatherer-percentage  19)
	(set-strategic-number sn-stone-gatherer-percentage 1)
	(set-strategic-number sn-wood-gatherer-percentage  35)
)

(defrule
	(current-age == feudal-age)
	(not (goal oceanmap YES))
	(unit-type-count villager > 20)
	(goal Age RESEARCHCASTLE)
=>
	(set-strategic-number sn-percent-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  45)
	(set-strategic-number sn-gold-gatherer-percentage  5)
	(set-strategic-number sn-stone-gatherer-percentage 5)
	(set-strategic-number sn-wood-gatherer-percentage  45)
)

(defrule
	(current-age == feudal-age)
	(goal oceanmap YES)
	(goal AllowMilitaryUnits YES)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  30)
	(set-strategic-number sn-gold-gatherer-percentage  25)
	(set-strategic-number sn-stone-gatherer-percentage 0)
	(set-strategic-number sn-wood-gatherer-percentage  45)
)

(defrule
	(current-age == feudal-age)
	(goal oceanmap YES)
	(goal Age RESEARCHCASTLE)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  25)
	(set-strategic-number sn-gold-gatherer-percentage  25)
	(set-strategic-number sn-stone-gatherer-percentage 5)
	(set-strategic-number sn-wood-gatherer-percentage  45)
)

;********Castle and Imperial********

(defrule
	(goal Food DEMASIADO)
=>
	(set-strategic-number sn-food-gatherer-percentage  50)
)

(defrule
	(goal Food MUCHO)
=>
	(set-strategic-number sn-food-gatherer-percentage  40)
)

(defrule
	(goal Food MEDIO)
=>
	(set-strategic-number sn-food-gatherer-percentage  35)
)

(defrule
	(goal Food VAJO)
=>
	(set-strategic-number sn-food-gatherer-percentage  30)
)

(defrule
	(goal Wood DEMASIADO)
=>
	(set-strategic-number sn-wood-gatherer-percentage  40)
)

(defrule
	(goal Wood MUCHO)
=>
	(set-strategic-number sn-wood-gatherer-percentage  30)
)

(defrule
	(goal Wood MEDIO)
=>
	(set-strategic-number sn-wood-gatherer-percentage  25)
)

(defrule
	(goal Wood VAJO)
=>
	(set-strategic-number sn-wood-gatherer-percentage  20)
)

(defrule
	(goal Gold DEMASIADO)
=>
	(set-strategic-number sn-gold-gatherer-percentage  30)
)

(defrule
	(goal Gold MUCHO)
=>
	(set-strategic-number sn-gold-gatherer-percentage  25)
)

(defrule
	(goal Gold MEDIO)
=>
	(set-strategic-number sn-gold-gatherer-percentage  20)
)

(defrule
	(goal Gold VAJO)
=>
	(set-strategic-number sn-gold-gatherer-percentage  15)
)

(defrule
	(goal Ston DEMASIADO)
=>
	(set-strategic-number sn-stone-gatherer-percentage 20)
)

(defrule
	(goal Ston MUCHO)
=>
	(set-strategic-number sn-stone-gatherer-percentage 15)
)

(defrule
	(goal Ston MEDIO)
=>
	(set-strategic-number sn-stone-gatherer-percentage 10)
)

(defrule
	(goal Ston VAJO)
=>
	(set-strategic-number sn-stone-gatherer-percentage 5)
)


(defrule
	(true)
=>
	(set-goal Gold? YES)
	(disable-self)
)

(defrule
	(game-time > 6300)
=>
	(set-goal Gold? NO)
	(disable-self)
)

(defrule
	(goal oceanmap YES)
	(current-age == castle-age)
	(not (research-completed ri-hand-cart))
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-percent-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)	;30
	(set-strategic-number sn-gold-gatherer-percentage  15)
	(set-strategic-number sn-stone-gatherer-percentage 10)
	(set-strategic-number sn-wood-gatherer-percentage  45)
	(set-strategic-number sn-maximum-gold-drop-distance 20)
	(set-strategic-number sn-maximum-stone-drop-distance 20)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(current-age == castle-age)
	(not (research-completed ri-hand-cart))
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold VAJO)
	(set-goal Ston VAJO)
	(set-goal Wood DEMASIADO)
)

(defrule
	(goal watermap YES)
	(current-age == castle-age)
	(not (research-completed ri-hand-cart))
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold VAJO)
	(set-goal Ston VAJO)
	(set-strategic-number sn-wood-gatherer-percentage  45)
)

;(defrule
;	(not (goal oceanmap YES))
;	(current-age == castle-age)
;	(research-completed ri-hand-cart)
;	(unit-type-count villager > 20)
;	(soldier-count <= 40)
;=>
;	(set-strategic-number sn-cap-civilian-gatherers 100)
;	(set-strategic-number sn-food-gatherer-percentage  35)
;	(set-strategic-number sn-gold-gatherer-percentage  20)
;	(set-strategic-number sn-stone-gatherer-percentage 10)
;	(set-strategic-number sn-wood-gatherer-percentage  35)
;)

;CAB

(defrule
	(current-age >= castle-age)	;zapato
	(not (goal oceanmap YES))
	(goal UnitType CAB)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
	(not (goal Age GOTOIMPERIAL))
	(building-type-count castle less-than 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal UnitType CAB)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(not (goal Age GOTOIMPERIAL))
	(unit-type-count villager > 20)
	(building-type-count castle >= 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston VAJO)
	(set-goal Wood MUCHO)
)

;INF

(defrule
	(current-age >= castle-age)
	(not (goal oceanmap YES))
	(goal UnitType INF)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
	(building-type-count castle less-than 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold VAJO)
	(set-goal Ston MUCHO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal UnitType INF)
	(current-age == castle-age)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
	(building-type-count castle >= 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

;ARQ

(defrule
	(current-age >= castle-age)
	(not (goal oceanmap YES))
	(goal UnitType ARQ)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
	(building-type-count castle less-than 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MEDIO)
	(set-goal Ston MUCHO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal UnitType ARQ)
	(not (goal Age GOTOIMPERIAL))
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
	(building-type-count castle >= 1)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

;UNIQUE



(defrule
	(civ-selected korean)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold MUCHO)
	(set-goal Ston VAJO)
	(set-goal Wood DEMASIADO)
)

(defrule
	(civ-selected mongol)
	(not (goal oceanmap YES))
	(not (goal Age GOTOIMPERIAL))
	(goal UnitType UNI)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected teutonic)
	(not (goal oceanmap YES))
	(not (goal Age GOTOIMPERIAL))
	(goal UnitType UNI)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food DEMASIADO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected mayan)
	(not (goal oceanmap YES))
	(not (goal Age GOTOIMPERIAL))
	(goal UnitType UNI)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected aztec)
	(not (goal oceanmap YES))
	(not (goal Age GOTOIMPERIAL))
	(goal UnitType UNI)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(not (goal oceanmap YES))
	(goal UnitType DEFENSE)
	(not (goal Age GOTOIMPERIAL))
	(current-age == castle-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(goal Age GOTOIMPERIAL)
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-strategic-number sn-food-gatherer-percentage  40)
	(set-strategic-number sn-gold-gatherer-percentage  25)
	(set-strategic-number sn-stone-gatherer-percentage 10)
	(set-strategic-number sn-wood-gatherer-percentage  25)
)

;*****************IMPERIAL

(defrule
	(not (goal oceanmap YES))
	(current-age == imperial-age)
	(not (research-completed ri-chemistry))
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

;CAB

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal UnitType CAB)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood VAJO)
)

(defrule
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType CAB)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MUCHO)
)

;INF

(defrule
	(not (goal oceanmap YES))
	(goal UnitType INF)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager > 20)
	(unit-type-count villager < 50)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal UnitType INF)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager >= 50)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MEDIO)
)

(defrule
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType INF)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager >= 50)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

;ARQ

(defrule
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType ARQ)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal UnitType ARQ)
	(current-age == imperial-age)
	(building-type-count castle >= 1)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

;UNIQUE

(defrule
	(civ-selected korean)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold MUCHO)
	(set-goal Ston VAJO)
	(set-goal Wood DEMASIADO)
)

(defrule
	(civ-selected mongol)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal watermap YES))
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected mongol)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap YES)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston VAJO)
	(set-goal Wood DEMASIADO)
)

(defrule
	(civ-selected teutonic)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal Gold? YES)
	(not (goal watermap YES))
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food DEMASIADO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)


(defrule
	(civ-selected teutonic)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Gold? YES))
	(not (goal watermap YES))
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected teutonic)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap YES)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected persian)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food DEMASIADO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston VAJO)
	(set-goal Wood VAJO)
)

(defrule
	(civ-selected aztec)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal watermap YES))
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected aztec)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap YES)
	(current-age == imperial-age)
	(unit-type-count 3 > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(or
	(civ-selected celtic)	(civ-selected gothic))
	(goal Gold? YES)
	(goal watermap NO)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food DEMASIADO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(or
	(civ-selected celtic)	(civ-selected gothic))
	(goal Gold? NO)
	(goal watermap NO)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected gothic)
	(goal watermap YES)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected celtic)
	(goal watermap YES)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected viking)
	(goal Gold? YES)
	(goal watermap NO)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food DEMASIADO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected viking)
	(goal Gold? NO)
	(goal watermap NO)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected viking)
	(goal watermap YES)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected japanese)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal Gold? YES)
	(goal watermap NO)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected japanese)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap NO)
	(not (goal Gold? YES))
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected japanese)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap YES)
	;(not (goal Gold? YES))
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(or
		(or
	(civ-selected briton)	(civ-selected chinese))
	(civ-selected mayan))
	(not (goal oceanmap YES))
	(goal watermap NO)
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
=>
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(or
		(or
	(civ-selected briton)	(civ-selected chinese))
	(civ-selected mayan))
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
=>
	(set-goal Food VAJO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected saracen)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal Gold? YES)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MEDIO)
)

(defrule
	(civ-selected saracen)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal Gold? NO)
	(not (goal watermap YES))
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected saracen)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap YES)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected turkish)
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood VAJO)
)

(defrule
	(civ-selected turkish)
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood MUCHO)
)

(defrule
	(or
	(civ-selected spanish)	(civ-selected frankish))
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(goal watermap NO)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MUCHO)
	(set-goal Ston MUCHO)
	(set-goal Wood VAJO)
)

(defrule
	(or
	(civ-selected spanish)	(civ-selected frankish))
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MEDIO)
	(set-goal Gold MUCHO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(civ-selected byzantine)
	(not (goal oceanmap YES))
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food DEMASIADO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston MEDIO)
	(set-goal Wood VAJO)
)

(defrule
	(civ-selected byzantine)
	(not (goal oceanmap YES))
	(goal watermap YES)
	(goal UnitType UNI)
	(not (goal Age GOTOIMPERIAL))
	(research-completed ri-hand-cart)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold DEMASIADO)
	(set-goal Ston VAJO)
	(set-goal Wood MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal UnitType DEFENSE)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food MUCHO)
	(set-goal Gold MEDIO)
	(set-goal Ston MEDIO)
	(set-goal Wood MUCHO)
)

(defrule
	(goal oceanmap YES)
	(current-age == imperial-age)
	(unit-type-count villager > 20)
=>
	(set-strategic-number sn-percent-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-explorers 0)
	(set-strategic-number sn-cap-civilian-gatherers 100)
	(set-goal Food VAJO)						;25
	(set-strategic-number sn-gold-gatherer-percentage  25)
	(set-strategic-number sn-stone-gatherer-percentage 15)
	(set-strategic-number sn-wood-gatherer-percentage  35)
	(set-strategic-number sn-maximum-gold-drop-distance 20)
	(set-strategic-number sn-maximum-stone-drop-distance 20)
	(set-strategic-number sn-maximum-food-drop-distance 20)
)


(defrule
	(current-age >= feudal-age)
	(building-type-count-total farm less-than 20)
=>
	(set-strategic-number sn-cap-civilian-builders 10)
)


(defrule
	(current-age >= feudal-age)
	(building-type-count-total farm >= 20)
=>
	(set-strategic-number sn-percent-civilian-builders 30)
	(set-strategic-number sn-percent-civilian-gatherers 70)
)

;///////////////////////////////////////Jabalies! (Boar)//////////////////////////////

(defrule
	(not	(research-available ri-loom))
	(unit-type-count villager > 15)
	(dropsite-min-distance hunting > 1)
	(dropsite-min-distance hunting <= 31)
=>
	(up-retask-gatherers food c: 1)
	(set-strategic-number sn-maximum-hunt-drop-distance 31)
	(set-strategic-number sn-minimum-number-hunters 1)
	(set-strategic-number sn-enable-boar-hunting 2)
	;(enable-timer 11 90)
	(disable-self)
)

(defrule
	(unit-type-count villager > 15)
	(strategic-number sn-minimum-number-hunters == 1)
	(unit-type-count villager-hunter > 0)
=>
	(set-strategic-number sn-minimum-number-hunters 0)
)

;///////////////////////////////////////FARMS!//////////////////////////////

(defrule
	(not (goal oceanmap YES))
	(current-age == castle-age)
	(not (research-completed ri-hand-cart))
	(unit-type-count villager > 20)
	(unit-type-count villager < 60)
=>
	(set-goal Farms VAJO)
)

(defrule
	(not (goal oceanmap YES))
	(current-age == castle-age)
	(research-completed ri-hand-cart)
	(soldier-count <= 40)
	(unit-type-count villager > 20)
=>
	(set-goal Farms MEDIO)
)

(defrule
	(not (research-completed ri-chemistry))
	(goal Age RESEARCHIMPERIAL)
	(unit-type-count villager > 20)
=>
	(set-goal Farms MUCHO)
)

(defrule
	(current-age == castle-age)
	(goal Age GOTOIMPERIAL)
	(unit-type-count villager > 20)
=>
	(set-goal Farms MUCHO)
)

(defrule
	(goal Food VAJO)
	(unit-type-count villager > 20)
=>
	(set-goal Farms VAJO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food MEDIO)
	(unit-type-count villager > 20)
	(unit-type-count villager < 60)
=>
	(set-goal Farms VAJO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food MEDIO)
	(unit-type-count villager >= 60)
=>
	(set-goal Farms MEDIO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food MUCHO)
	(unit-type-count villager > 20)
	(unit-type-count villager < 60)
=>
	(set-goal Farms MEDIO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food MUCHO)
	(unit-type-count villager >= 60)
=>
	(set-goal Farms MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food DEMASIADO)
	(unit-type-count villager > 20)
	(unit-type-count villager < 60)
=>
	(set-goal Farms MUCHO)
)

(defrule
	(not (goal oceanmap YES))
	(goal Food DEMASIADO)
	(unit-type-count villager >= 60)
=>
	(set-goal Farms DEMASIADO)
)

; ============== BUILD LISTS

(defrule							; Goal initialization
	(true)
=>
	(set-goal Farmtime NO)
	(disable-self)
)

(defrule
	(unit-type-count-total villager less-than 27)
	(not (can-research-with-escrow feudal-age))
	(not (can-research-with-escrow castle-age))
	(not (research-available ri-wheel-barrow))
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(unit-type-count-total villager less-than 10)
	(not (can-research-with-escrow feudal-age))
	(not (can-research-with-escrow castle-age))
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(research-completed feudal-age)
	(research-completed ri-wheel-barrow)
	(not (can-research-with-escrow castle-age))
	(unit-type-count-total villager less-than 35)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(goal feudalWars YES)
	(research-completed feudal-age)
	(research-completed ri-wheel-barrow)
	(research-completed ri-loom)
	(not (can-research-with-escrow castle-age))
	(unit-type-count-total villager less-than 40)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(population-cap >= 100)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 50)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)


(defrule
	(or
        (population-cap == 125)	(difficulty == easy))
	(not (difficulty == easiest))
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 55)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(or
	(population-cap == 150)	 (difficulty == moderate))
	(not (difficulty == easiest))
	(not (difficulty == easy))
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 65)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(goal oceanmap NO)
	(goal dificultad masQueModerado)
        (population-cap >= 175)
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 75)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(goal oceanmap NO)
	(goal dificultad masQueModerado)
        (population-cap >= 200)
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(players-population any-human-enemy > 0)
	(cc-players-unit-type-count any-enemy villager >= 80)
	(unit-type-count-total villager less-than 100)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(goal oceanmap NO)
	(goal dificultad masQueModerado)
        (population-cap > 210)
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 100)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)


(defrule
	(goal oceanmap YES)
	(goal dificultad masQueModerado)
        (population-cap >= 175)
	(timer-triggered VillagerTimer)
	(research-completed castle-age)
	(current-age >= castle-age)
	(food-amount < 6000)
	(unit-type-count-total villager less-than 70)
	(can-train villager)
=>
	(train villager)
	;(chat-local-to-self "villager")
)

(defrule
	(goal oceanmap YES)
	(population-cap <= 210)
	(population >= 200)
	(unit-type-count-total villager > 50)
	(unit-type-count-total transport-ship <= 3)
=>
	(delete-unit villager)
	(chat-local-to-self "deleting extra villager") ;RE HACER
)

(defrule
	(current-age == imperial-age)
	(population >= 200)
	(unit-type-count-total villager > 35)
	(food-amount > 7000)
=>
	(delete-unit villager)
	(chat-local-to-self "deleting extra villager")
)

(defrule
	(current-age == imperial-age)
	(population-cap <= 210)
	(population >= 200)
	(unit-type-count-total villager > 80)
=>
	(delete-unit villager)
	(chat-local-to-self "deleting extra villager") ;RE HACER
)

(defrule
	(not (town-under-attack))
	(unit-type-count-total fishing-ship less-than 4)
	(can-train fishing-ship)
=>
	(train fishing-ship)
	;(chat-local-to-self "fishing ship")
)

(defrule
	(goal oceanmap YES)
	(not (town-under-attack))
	(timer-triggered VillagerTimer)
	(unit-type-count-total fishing-ship less-than 6)
	(can-train fishing-ship)
=>
	(train fishing-ship)
	;(chat-local-to-self "fishing ship")
)

(defrule
		(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(game-time > 1800)
	(building-type-count town-center > 1)
	(timer-triggered VillagerTimer)
	(wood-amount > 200)
	(unit-type-count-total trade-cart < 5)
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	;(chat-local-to-self "trade-cart")
)

(defrule
		(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(not (town-under-attack))
	(building-type-count town-center > 1)
	(wood-amount > 200)
	(research-completed ri-caravan)
	(unit-type-count-total trade-cart < 10) ;asd
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	;(chat-local-to-self "trade-cart")
)

(defrule
		(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(timer-triggered VillagerTimer)
	(wood-amount > 200)
	(research-completed ri-caravan)
	(unit-type-count-total trade-cart < 10);asd
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	;(chat-local-to-self "trade-cart")
)

(defrule
		(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(game-time > 5400)
	(wood-amount > 200)
	(unit-type-count-total trade-cart < 20)
	(unit-type-count-total trade-cart > 7)
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	(chat-local-to-self "trade-cart")
)

(defrule
		(current-age == imperial-age)
	(timer-triggered VillagerTimer)
	(cc-players-building-type-count any-ally market >= 1)
	(difficulty >= hard)
	(wood-amount > 200)
	(unit-type-count-total trade-cart < 16)
	(unit-type-count-total trade-cart > 7)
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	;(chat-local-to-self "trade-cart")
)

(defrule
		(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(timer-triggered VillagerTimer)
	(wood-amount > 200)
	(population-cap > 210)
	(research-completed ri-caravan)
	(unit-type-count-total trade-cart < 40)
	(unit-type-count-total trade-cart > 7)
	(can-train trade-cart)
	(goal LandTrade YES)
=>
	(train trade-cart)
	;(chat-local-to-self "trade-cart")
)

(defrule
	(timer-triggered VillagerTimer)
	(goal LandTrade NO)
	(game-time > 3700)
	(wood-amount > 200)
	(cc-players-building-type-count any-ally dock >= 1)
	(unit-type-count-total trade-cog < 10)
	(can-train trade-cog)
=>
	(train trade-cog)
)

;maintain housing
(defrule
	(housing-headroom less-than 4)
	(population-headroom greater-than 0)
	(building-type-count town-center >= 1)
	(can-build house)
=>
	(build house)
	;(chat-local-to-self "house")
)

(defrule
	(housing-headroom less-than 10)
	(wood-amount > 500)
	(population-headroom greater-than 0)
	(can-build house)
=>
	(build house)
	;(chat-local-to-self "house")
)

(defrule
	(housing-headroom less-than 20)
	(wood-amount > 1000)
	(population-headroom greater-than 0)
	(can-build house)
=>
	(build house)
	;(chat-local-to-self "house")
)

;maintain a town center
(defrule
	(game-time greater-than 45)
	(building-type-count town-center less-than 1)
	(can-build town-center)
=>
	(build town-center)
)

(defrule
	(current-age >= castle-age)
	(building-type-count town-center less-than 2)
	(can-build town-center)
=>
	(build town-center)
)

(defrule
	(current-age >= castle-age)
	(research-completed ri-hand-cart)
	(building-type-count-total castle >= 1)
	(building-type-count town-center less-than 3)
	(can-build town-center)
=>
	(build town-center)
)

(defrule
	(goal oceanmap NO)
	(current-age >= imperial-age)
	(building-type-count-total castle >= 1)
        (wood-amount > 1150)
	(building-type-count town-center less-than 5)
	(can-build town-center)
=>
	(build town-center)
)

(defrule
	(current-age >= feudal-age)
	(building-type-count-total market >= 1)
	(building-type-count-total barracks less-than 1)
	(can-build barracks)
=>
	(build barracks)
	(chat-local-to-self "barracks")
)

(defrule
	(goal oceanmap NO)
	(or
	(game-time > 5400)	(wood-amount > 5000))
	(building-type-count-total market >= 1)
        (wood-amount > 350)
	(building-type-count-total barracks less-than 2)
	(can-build barracks)
=>
	(build barracks)
	(chat-local-to-self "barracks")
)

(defrule
	(goal oceanmap NO)
	(goal UnitType INF)
	(current-age == imperial-age)
	(unit-type-count-total villager > 50)
	(building-type-count-total market >= 1)
        (wood-amount > 350)
	(building-type-count-total barracks less-than 3)
	(can-build barracks)
=>
	(build barracks)
	(chat-local-to-self "barracks")
)

(defrule
	(goal oceanmap NO)
	(or
	(civ-selected aztec) (civ-selected mayan))
	(current-age >= feudal-age)
	(building-type-count-total market >= 1)
        (wood-amount > 350)
	(building-type-count-total barracks less-than 3)
	(can-build barracks)
=>
	(build barracks)
	(chat-local-to-self "barracks")
)

(defrule
	(goal oceanmap YES)
	(or
	(civ-selected aztec) (civ-selected mayan))
	(current-age >= feudal-age)
	(building-type-count-total market >= 1)
	(building-type-count-total barracks less-than 2)
        (wood-amount > 350)
	(building-type-count town-center >= 1)
	(can-build barracks)
=>
	(build barracks)
	(chat-local-to-self "barracks")
)

(defrule
	(goal ATTACK YES)
	(goal UnitType INF)
	(goal oceanmap NO)
	(building-type-count town-center >= 1)
        (wood-amount > 600)
	(building-type-count-total barracks less-than 7)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build barracks)
=>
	(build-forward barracks)
	(chat-local-to-self "Rush? barracks")
)

(defrule
	(building-type-count-total market >= 1)
	(building-type-count-total archery-range less-than 2)
	(or
	(building-type-count-total barracks >= 1)	(wood-amount > 5000))
	(building-type-count town-center >= 1)
	(can-build archery-range)
=>
	(build archery-range)
	(chat-local-to-self "range")
)

(defrule
	(goal oceanmap NO)
	(goal UnitType ARQ)
	(current-age == imperial-age)
	(unit-type-count-total villager > 50)
	(building-type-count-total market >= 1)
        (wood-amount > 350)
	(building-type-count-total archery-range less-than 4)
	(can-build archery-range)
=>
	(build archery-range)
	(chat-local-to-self "range")
)

(defrule
	(goal ATTACK YES)
	(goal UnitType ARQ)
	(goal oceanmap NO)
	(building-type-count town-center >= 1)
        (wood-amount > 600)
	(building-type-count-total archery-range less-than 7)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build archery-range)
=>
	(build-forward archery-range)
	(chat-local-to-self "Rush? range")
)

(defrule
	(building-type-count-total archery-range > 1)
	(building-type-count-total market >= 1)
	(building-type-count-total stable less-than 1)
	(building-type-count town-center >= 1)
	(can-build stable)
=>
	(build stable)
	(chat-local-to-self "stable")
)


(defrule
	(goal oceanmap NO)
	(or
	(current-age >= castle-age)		(wood-amount > 5000))
        (wood-amount > 350)
	(or
	(building-type-count-total barracks >= 1)	(wood-amount > 5000))
	(building-type-count-total market >= 1)
	(or
		(goal UnitType CAB)	(wood-amount > 5000))
	(building-type-count-total stable less-than 4)
	(can-build stable)
=>
	(build stable)
	(chat-local-to-self "stable")
)

(defrule
	(or
	(current-age >= castle-age)		(wood-amount > 5000))
	(building-type-count-total market >= 1)
        (wood-amount > 300)
	(building-type-count-total stable less-than 2)
	(can-build stable)
=>
	(build stable)
	(chat-local-to-self "stable")
)

(defrule
	(goal ATTACK YES)
	(goal oceanmap NO)
	(goal UnitType CAB)
	(building-type-count town-center >= 1)
        (wood-amount > 600)
	(building-type-count-total stable less-than 6)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build stable)
=>
	(build-forward stable)
	(chat-local-to-self "Rush? stable")
)

(defrule
	(building-type-count-total blacksmith less-than 2)
	(building-type-count barracks > 1)
	(building-type-count-total archery-range > 1)
	(not (goal techsready YES))
	(wood-amount > 5000)
	(not(starting-age == post-imperial-age))
	(can-build blacksmith)
=>
	(build blacksmith)
	(chat-local-to-self "blacksmith")
)

(defrule
	(building-type-count-total blacksmith less-than 1)
	(building-type-count town-center >= 1)
	(building-type-count-total mill >= 1)
	(not (goal techsready YES))
	(not(starting-age == post-imperial-age))
	(can-build blacksmith)
=>
	(build blacksmith)
	(chat-local-to-self "blacksmith")
)

(defrule
	(building-type-count-total market less-than 1)
	(building-type-count town-center >= 1)
	(or
	(building-type-count-total mill >= 1)	(wood-amount > 5000))
	(can-build market)
=>
	(build market)
	(chat-local-to-self "market")
)

(defrule
	(goal LandTrade YES)
	(population-cap > 200)
	(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(building-type-count-total market less-than 3)
	(building-type-count town-center > 1)
	(wood-amount > 800)
	(can-build market)
=>
	(build market)
	(chat-local-to-self "market")
)

;El mercado Lejos del Aliado???
(defrule
	(goal LandTrade YES)
	(current-age >= castle-age)
	(cc-players-building-type-count any-ally market >= 1)
	(building-type-count-total market less-than 2)
	(building-type-count town-center > 1)
	(wood-amount > 800)
	(can-build market)
=>
	(up-set-placement-data my-player-number -1 c: -40) ;home town center = -1 ;build it behind regardless of allies or not
	(up-build place-control 0 c: market)
)

;1° caravanserai, cerca del mercado
(defrule
	(goal LandTrade YES)
	(building-type-count-total caravanserai less-than 1)
	(building-type-count-total market > 0)
	(building-type-count town-center >= 1)
	(building-type-count castle > 1)
	(wood-amount > 900)
	(can-build caravanserai)
=>
	(set-strategic-number sn-placement-zone-size 9)
	(set-strategic-number sn-placement-to-center 1)
	(up-set-placement-data my-player-number market c: -4) ;build near our market
	(set-strategic-number sn-placement-fail-delta 0)
	(up-build place-control 0 c: caravanserai)
	(chat-local-to-self "caravanserai")
)

;1° caravanserai, cerca del mercado Aliado
(defrule
	(goal LandTrade YES)
	(building-type-count-total caravanserai less-than 6)
	(building-type-count-total caravanserai > 4)
	(building-type-count-total market > 0)
	(building-type-count town-center >= 1)
	(building-type-count castle > 1)
	(wood-amount > 900)
	(can-build caravanserai)
=>
	(set-strategic-number sn-placement-zone-size 9)
	(set-strategic-number sn-placement-to-center 1)
	(up-set-placement-data any-ally market c: -4) ;near ally market
	(set-strategic-number sn-placement-fail-delta 0)
	(up-build place-control 0 c: caravanserai)
	(chat-local-to-self "caravanserai")
)

(defrule
	(goal LandTrade YES)
	(building-type-count-total caravanserai less-than 5)
	(building-type-count-total caravanserai >= 1)
	(building-type-count-total market > 0)
	(building-type-count town-center >= 1)
	(building-type-count castle > 1)
	(wood-amount > 900)
	(can-build caravanserai)
=>
	(build caravanserai)
	(chat-local-to-self "caravanserai")
)

#load-if-defined PORTUGUESE-CIV
(defrule
	(building-type-count-total feitoria less-than 1)
	(building-type-count town-center >= 1)
	(building-type-count-total market >= 1)
	(building-type-count-total castle >= 1)
	(can-build feitoria)
=>
	(build feitoria)
	(chat-local-to-self "feitoria")
)

(defrule
	(population-cap > 210)
	(building-type-count-total feitoria less-than 3)
	(building-type-count town-center >= 1)
	(building-type-count-total market >= 1)
	(building-type-count-total castle > 1)
	(can-build feitoria)
=>
	(build feitoria)
	(chat-local-to-self "feitoria")
)
#end-if

(defrule
	(building-type-count-total market >= 1)
	(not(starting-age == post-imperial-age))
        (gold-amount > 400)
	(building-type-count-total university less-than 1)
	(can-build university)
=>
	(build university)
	(chat-local-to-self " university ")
)

(defrule
	(building-type-count-total market >= 1)
	(building-type-count-total monastery less-than 1)
	(building-type-count town-center >= 1)
	(can-build monastery)
=>
	(build monastery)
	(chat-local-to-self " monastery ")
)

(defrule
	(or
	(civ-selected aztec) (civ-selected bengalis))
        (wood-amount > 350)
	(building-type-count-total market >= 1)
	(building-type-count town-center >= 1)
	(building-type-count-total monastery less-than 2)
	(can-build monastery)
=>
	(build monastery)
	(chat-local-to-self " monastery ")
)

#load-if-defined ARMENIANS-CIV
(defrule
        (wood-amount > 350)
	(building-type-count-total market >= 1)
	(building-type-count town-center >= 1)
	(building-type-count-total monastery less-than 4)
	(can-build monastery)
=>
	(build monastery)
	(chat-local-to-self " monastery ")
)
#end-if

#load-if-defined GEORGIANs-CIV
(defrule
        (wood-amount > 350)
	(building-type-count-total market >= 1)
	(building-type-count town-center >= 1)
	(building-type-count-total monastery less-than 4)
	(can-build monastery)
=>
	(build monastery)
	(chat-local-to-self " monastery ")
)
#end-if

(defrule

	(building-type-count-total castle less-than 5)
	(can-build castle)
=>
	(build castle)
	(chat-local-to-self "castle")
)

(defrule
	(difficulty == moderate)
	(building-type-count-total castle less-than 10)
	(can-build castle)
=>
	(build castle)
	(chat-local-to-self "castle")
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(goal ATTACK YES)
	(not (goal oceanmap YES))
	(current-age == imperial-age)
	(building-type-count-total siege-workshop > 2)
	(soldier-count > 40)
=>
	(build-forward castle)
	;(chat-local-to-self "CASTILLO rushero.")
)


(defrule
	(not (strategic-number sn-maximum-town-size == 70))
	(difficulty == hard)
	(building-type-count-total castle less-than 20)
	(can-build castle)
=>
	(build castle)
	(chat-local-to-self "castle")
)

(defrule
	(not (strategic-number sn-maximum-town-size == 70))
	(not (difficulty == hard))
	(goal dificultad masQueModerado)
	(can-build castle)
=>
	(build castle)
	(chat-local-to-self "castle")
)

(defrule
	(building-type-count-total market >= 1)
	(building-type-count town-center >= 1)
        (wood-amount > 300)
	(building-type-count-total siege-workshop less-than 1)
	(can-build siege-workshop)
=>
	(build siege-workshop)
	(chat-local-to-self "siege workshop")
)

(defrule
	(or
	(civ-selected mongol) (civ-selected celtic))
        (wood-amount > 1000)
	(building-type-count-total market >= 1)
	(building-type-count-total siege-workshop less-than 2)
	(can-build siege-workshop)
=>
	(build siege-workshop)
	(chat-local-to-self "siege workshop")
)

(defrule
	(goal ATTACK YES)
	(not (goal oceanmap YES))
	(building-type-count town-center >= 1)
        (wood-amount > 500)
	(building-type-count-total siege-workshop less-than 3)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build siege-workshop)
=>
	(build-forward siege-workshop)
	(chat-local-to-self "Rush? siege workshop")
)

(defrule
	;(current-age <= castle-age)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(or	(goal watermap YES)
		(goal oceanmap YES)
	)
	(building-type-count-total dock less-than 1)
	(can-build dock)
=>
	(build dock)
	(chat-local-to-self "dock")
)

(defrule
	(current-age >= castle-age)
	(goal watermap YES)
	(wood-amount > 500)
	(building-type-count-total dock less-than 3)
	(can-build dock)
=>
	(build dock)
	(chat-local-to-self "dock")
)

(defrule
	(current-age == castle-age)
	(or
	(goal oceanmap YES)	(wood-amount > 5000))
	(wood-amount > 350)
	(building-type-count-total dock less-than 3)
	(can-build dock)
=>
	(build dock)
	(chat-local-to-self "dock")
)

(defrule
	(or
	(current-age == imperial-age)	(wood-amount > 5000))
	(goal oceanmap YES)
	(building-type-count-total dock less-than 4)
	(can-build dock)
=>
	(build dock)
	(chat-local-to-self "dock")
)

(defrule
	(goal ATTACK YES)
	(building-type-count castle > 2)
        (stone-amount > 200)
	(building-type-count-total watch-tower-line less-than 10)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build watch-tower-line)
=>
	(build-forward watch-tower-line)
	(chat-local-to-self "Rush? TORRE")
)

(defrule
	(goal ATTACK YES)
	(building-type-count castle > 2)
        (stone-amount > 200)
	(building-type-count-total bombard-tower less-than 13)
	(current-age == imperial-age)
	(soldier-count >= 80)
	(can-build bombard-tower)
=>
	(build-forward bombard-tower)
	;(chat-local-to-self "Rush? TORRE")
)

(defrule
	(true)
=>
	(enable-timer farmspeedTimer 1)
	(disable-self)
)

(defrule
	(wood-amount < 500)
	(building-type-count-total farm > 12)
=>
	(set-goal Farmtime YES)
)

(defrule
	(wood-amount > 500)
=>
	(set-goal Farmtime NO)
)

(defrule
	(building-type-count-total farm less-than 5)
	(building-type-count town-center >= 1)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(current-age == dark-age)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(building-type-count-total farm less-than 10)
	(can-build farm)
=>
	(build farm)
	(disable-timer farmspeedTimer)
	(enable-timer farmspeedTimer 20)
)

(defrule
	(current-age == feudal-age)
	(research-completed ri-horse-collar)
	(building-type-count town-center >= 1)
	(building-type-count-total farm less-than 12)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(building-type-count town-center >= 1)
	(current-age == feudal-age)
	(goal feudalWars YES)
	(building-type-count-total farm less-than 15)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(goal Farms MUCHO)
	(current-age >= castle-age)	
	(building-type-count-total farm less-than 30)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(goal Farms MEDIO)
	(current-age >= castle-age)
	(building-type-count-total farm less-than 25)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(goal Farms VAJO)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(unit-type-count-total villager <= 50)
	(current-age >= castle-age)
	(building-type-count-total farm less-than 15)
	(can-build farm)
=>
	(build farm)
)


(defrule
	(timer-triggered farmspeedTimer)
	(goal Farms VAJO)
	(food-amount <= 1000)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(current-age >= castle-age)
	(building-type-count-total farm less-than 20)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(goal Farms VAJO)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(food-amount > 1000)
	(current-age >= castle-age)
	(building-type-count-total farm less-than 15)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(building-type-count town-center >= 1)
	(building-type-count lumber-camp >= 1)
	(goal Farms DEMASIADO)
	(current-age >= castle-age)
	(building-type-count-total farm less-than 40)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(building-type-count-total farm less-than 30)
	(building-type-count town-center >= 1)
	(food-amount > 10000)
	(game-time > 400)
	(game-time < 900)
	(can-build farm)
=>
	(build farm)
)

(defrule
	(timer-triggered farmspeedTimer)
	(building-type-count town-center >= 1)
	(goal Farmtime YES)
=>
	(disable-timer farmspeedTimer)
	(enable-timer farmspeedTimer 15)
)

(defrule
	(timer-triggered farmspeedTimer)
	;(building-type-count town-center >= 1)
	(goal Farmtime NO)
=>
	(disable-timer farmspeedTimer)
	(enable-timer farmspeedTimer 1)
)

(defrule
	(or
	(unit-type-count-total villager > 5) (wood-amount < 120))
        (or
	(food-amount > 1100)         (wood-amount < 120)
	)
	(building-type-count lumber-camp less-than 1)
	(building-type-count-total mill >= 1)
	(resource-found wood)
	(can-build lumber-camp)
=>
	(build lumber-camp)
	(chat-local-to-self "First wood place")
	(disable-self)
)

(defrule
	(food-amount > 5000)
         (wood-amount > 5000)
	(building-type-count lumber-camp less-than 1)
	(resource-found wood)
	(can-build lumber-camp)
=>
	(build lumber-camp)
	(chat-local-to-self "DM wood place")
	(disable-self)
)

(defrule
	(resource-found wood)
	(dropsite-min-distance wood > 4)
	(building-type-count-total mill >= 1)
	(can-build lumber-camp)
=>
	(build lumber-camp)
	(chat-local-to-self "wood place")
)

(defrule
	(resource-found gold)
	(building-type-count town-center >= 1)
	(building-type-count-total lumber-camp >= 1)
	(dropsite-min-distance gold > 7)
	(can-build mining-camp)
=>
	(build mining-camp)
	(chat-local-to-self "gold place")
)

(defrule
	(resource-found stone)
	(building-type-count town-center >= 1)
	(building-type-count-total lumber-camp >= 1)
	(dropsite-min-distance stone > 7)
	(can-build mining-camp)
=>
	(build mining-camp)
	(chat-local-to-self "rock place")
)

(defrule
	(game-time > 60)
	(building-type-count town-center >= 1)
	(building-type-count-total mill less-than 1)
	(can-build mill)
=>
	(build mill)
	(chat-local-to-self "mill")
)

;************ Villager Timer! **********


(defrule
	(true)
=>
	(enable-timer VillagerTimer 1)
	(disable-self)
)

(defrule
	(timer-triggered VillagerTimer)
	(not (goal Estrategia Eco))
	(food-amount < 300)
	(goal 16 0)
	(soldier-count < 50)
	(unit-type-count-total villager > 35)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 15)
)

(defrule
	(timer-triggered VillagerTimer)
	(goal Estrategia Eco)
	(food-amount < 300)
	(goal 16 0)
	(soldier-count < 20)
	(unit-type-count-total villager > 35)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 15)
)


(defrule
	(timer-triggered VillagerTimer)
	(goal Estrategia Std)
	(food-amount < 500)
	(goal 16 0)
	(soldier-count < 80)
	(unit-type-count-total villager > 50)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 15)
)

(defrule
	(timer-triggered VillagerTimer)
	(goal Estrategia Agre)
	(food-amount < 500)
	(goal 16 0)
	(soldier-count < 100)
	(unit-type-count-total villager > 50)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 20)
)

(defrule
	(timer-triggered VillagerTimer)
	(town-under-attack)
	(food-amount < 1600)
	(soldier-count < 40)
	(not (goal 16 0))
	(unit-type-count-total villager > 35)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 15)
)

(defrule
	(timer-triggered VillagerTimer)
	(current-age == castle-age)
	(food-amount > 500)
	(wood-amount > 300)
	(not (research-completed ri-hand-cart))
	(soldier-count > 30)
	(unit-type-count-total villager > 35)
=>
	(disable-timer VillagerTimer)
	(enable-timer VillagerTimer 20)
)


; ============== MILITARY UNITS

(defrule
	(true)
=>
	(enable-timer InfanteriaspeedTimer 1)
	(enable-timer CaballeriaspeedTimer 1)
	(enable-timer ArqueriaspeedTimer 1)
	(enable-timer UniquespeedTimer 1)
	(enable-timer MonkspeedTimer 1)
	(enable-timer siegespeedTimer 1)
	(enable-timer ShipsTimer 1)
	(disable-self)
)


(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal oceanmap NO)
	(not (civ-selected saracen))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total knight-line < 100)
	(goal UnitType CAB)
	(can-train knight-line)
=>
	(train knight-line)
	(chat-local-to-self "knight")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal oceanmap NO)
	(not (civ-selected saracen))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total knight-line < 40)
	(not (goal UnitType CAB))
	(not (goal HumanTactical YES))
	(can-train knight-line)
	(not (can-train elite-war-elephant))
=>
	(train knight-line)
	(chat-local-to-self "knight")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal oceanmap NO)
	(goal UnitType2 CAB)
	(not (civ-selected saracen))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total knight-line < 60)
	(can-train knight-line)
	(not (can-train elite-war-elephant))
=>
	(train knight-line)
	(chat-local-to-self "knight")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal oceanmap YES)
	(not (civ-selected saracen))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total knight-line < 25)
	(can-train knight-line)
=>
	(train knight-line)
	(chat-local-to-self "knight")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(current-age == castle-age)
	(civ-selected saracen)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total knight-line < 10)
	(can-train knight-line)
=>
	(train knight-line)
	(chat-local-to-self "knight")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal oceanmap NO)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total battle-elephant-line < 40)
	(or
	(can-research-with-escrow ri-elite-battle-elephant)	(research-completed ri-elite-battle-elephant))
	(goal UnitType CAB)
	(can-train battle-elephant-line)
=>
	(train battle-elephant-line)
	(chat-local-to-self "battle elephant")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total battle-elephant-line < 20)
	(or
	(can-research-with-escrow ri-elite-battle-elephant)	(research-completed ri-elite-battle-elephant))
	(can-train battle-elephant-line)
=>
	(train battle-elephant-line)
	(chat-local-to-self "battle elephant")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal oceanmap NO)
	(not (civ-selected turkish))
	(or
		(not (goal HumanTactical YES))	(goal UnitType ARQ))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total hand-cannoneer < 40)
	(can-train hand-cannoneer)
=>
	(train hand-cannoneer)
	(chat-local-to-self "hand cannoneer")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	;(goal oceanmap YES)
	(not (civ-selected turkish))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total hand-cannoneer < 20)
	(can-train hand-cannoneer)
=>
	(train hand-cannoneer)
	(chat-local-to-self "hand cannoneer")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(civ-selected turkish)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total hand-cannoneer < 10)
	(can-train hand-cannoneer)
=>
	(train hand-cannoneer)
	(chat-local-to-self "hand cannoneer")
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(research-completed ri-man-at-arms)
	(unit-type-count-total militiaman-line < 10)
	(not (unit-available elite-war-elephant))
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(current-age == feudal-age)
	(food-amount > 10000)  
	(unit-type-count-total militiaman-line < 20)
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(civ-selected gothic)
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(research-completed feudal-age)
	(research-completed ri-man-at-arms)
	(unit-type-count-total militiaman-line < 20)
	(not (goal HumanTactical YES))
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(or
	(civ-selected viking) (civ-selected aztec))
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(research-completed ri-man-at-arms)
	(unit-type-count-total militiaman-line < 15)
	(not (goal HumanTactical YES))
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(goal UnitType INF)
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(research-completed ri-man-at-arms)
	(unit-type-count-total militiaman-line < 100)
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(goal UnitType2 INF)
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(research-completed ri-man-at-arms)
	(unit-type-count-total militiaman-line < 20)
	(can-train militiaman-line)
=>
	(train militiaman-line)
	(chat-local-to-self "infantry")
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(cc-players-unit-type-count any-enemy gunpowder > 10)
	(unit-type-count-total condottiero < 20)
	(can-train condottiero)
=>
	(train condottiero)
	(chat-local-to-self "condottiero")
)

(defrule
	(civ-selected mayan)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count archer-line < 20)
	(not (goal HumanTactical YES))
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(or
	(civ-selected briton)	(civ-selected mayan))
	(timer-triggered ArqueriaspeedTimer)
	(building-type-count-total castle less-than 1)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count archer-line < 20)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(or
	(civ-selected chinese) (civ-selected briton))
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count archer-line < 5)
	(not (goal HumanTactical YES))
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)


(defrule
	(goal oceanmap NO)
	(current-age <= castle-age)
	(not (goal Estrategia Eco))
	(not (goal AllowMilitaryUnits NO))
	(not (civ-selected hun)) 
	(not (civ-selected mongol))
	(not (civ-selected briton))
	(timer-triggered ArqueriaspeedTimer)
	(unit-type-count archer-line < 10)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(goal oceanmap NO)
	(not (goal Estrategia Eco))
	(current-age == feudal-age)
	(not (goal AllowMilitaryUnits NO))
	(timer-triggered ArqueriaspeedTimer)
	(unit-type-count archer-line < 10)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(current-age == feudal-age)
	(food-amount > 10000)  
	(unit-type-count archer-line < 20)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(goal UnitType ARQ)
	(not (unit-available hand-cannoneer))
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(not (civ-selected hun)) 
	(not (civ-selected mongol))
	(unit-type-count archer-line < 60)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(or
	(goal UnitType2 ARQ)	(goal EnemyInf YES))
	(not (unit-available hand-cannoneer))
	(timer-triggered ArqueriaspeedTimer)
	(not (civ-selected hun)) 
	(not (civ-selected mongol))
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count archer-line < 15)
	(can-train archer-line)
=>
	(train archer-line)
	(chat-local-to-self "archer")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(can-train elite-kipchak-mercenary)
=>
	(train elite-kipchak-mercenary)
	(chat-local-to-self "elite-kipchak-mercenary")
)

(defrule
	(civ-selected hun)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 20)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(civ-selected mongol)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 20)
	(building-type-count-total castle less-than 1)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(civ-selected mongol)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 5)
	(building-type-count-total castle >= 1)
	(not (goal HumanTactical YES))
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(goal UnitType ARQ)
    (or
	(or
	(civ-selected byzantine) (civ-selected japanese))
	(civ-selected persian))
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 30)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(goal UnitType ARQ)
    (or
	(or
	(civ-selected saracen) (civ-selected turkish))
	(civ-selected mongol))
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 30)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(goal UnitType ARQ)
	(civ-selected hun)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count cavalry-archer-line < 30)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line)
	(chat-local-to-self "cavalry-archer-line")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count elephant-archer-line < 20)
	(can-train elephant-archer-line)
=>
	(train elephant-archer-line)
	(chat-local-to-self "elephant-archer-line")
)

(defrule
	(goal UnitType ARQ)
	(timer-triggered ArqueriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count elephant-archer-line < 30)
	(can-train elephant-archer-line)
=>
	(train elephant-archer-line)
	(chat-local-to-self "elephant-archer-line")
)

(defrule
	(or
	(civ-selected saracen)	(civ-selected indian))
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total camel-line < 20)
	(can-train camel-line)
=>
	(train camel-line)
	(chat-local-to-self "camel")
)


(defrule
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(or
	(cc-players-unit-type-count any-enemy war-elephant-line > 5)	(goal EnemyCab YES))
	(unit-type-count-total camel-line < 20)
	(can-train camel-line)
=>
	(train camel-line)
	(chat-local-to-self "camel")
)


(defrule
	(unit-type-count-total scout-cavalry-line < 1)
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line)
	(chat-local-to-self "scout")
)

(defrule
	(goal oceanmap NO)
	(civ-selected mongol)
	(current-age >= castle-age)
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total scout-cavalry-line < 10)
	(or
	(not (goal HumanTactical YES))	(goal UnitType CAB))
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line)
	(chat-local-to-self "scout")
)

(defrule
	(civ-selected saracen)
	(current-age >= castle-age)
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total scout-cavalry-line < 15)
	(goal UnitType CAB)
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line)
	(chat-local-to-self "scout")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(civ-selected turkish)
	(current-age >= castle-age)
	(unit-type-count-total scout-cavalry-line < 5)
	(or
	(not (goal HumanTactical YES))	(goal UnitType CAB))
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line)
	(chat-local-to-self "scout")
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(current-age >= castle-age)
	(cc-players-unit-type-count any-enemy monk > 5)
	(unit-type-count-total scout-cavalry-line < 5)
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line)
	(chat-local-to-self "scout")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered CaballeriaspeedTimer)   		;¿?
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total eagle-warrior-line < 40)
	(not (goal HumanTactical YES))
	(can-train eagle-warrior-line)
=>
	(train eagle-warrior-line)
	(chat-local-to-self "eagle")
)

(defrule
	;(goal oceanmap YES)
	(timer-triggered CaballeriaspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total eagle-warrior-line < 20)
	(can-train eagle-warrior-line)
=>
	(train eagle-warrior-line)
	(chat-local-to-self "eagle")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered UniquespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total my-unique-unit-line < 100)
	(or
	(not (goal HumanTactical YES))	(goal UnitType UNI))
	(can-train my-unique-unit-line)
=>
	(train my-unique-unit-line)
	(chat-local-to-self "unique unit")
)

(defrule
	;(goal oceanmap YES)
	(timer-triggered UniquespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total my-unique-unit-line < 40)
	(can-train my-unique-unit-line)
=>
	(train my-unique-unit-line)
	(chat-local-to-self "unique unit")
)

(defrule
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total trebuchet < 2)
	(can-train trebuchet)
=>
	(train trebuchet)
	(chat-local-to-self "trebuchet")
)


(defrule
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(goal oceanmap NO)
	(unit-type-count-total trebuchet < 4)
	(can-train trebuchet)
=>
	(train trebuchet)
	(chat-local-to-self "trebuchet")
)

(defrule
	(goal dificultad masQueModerado)
	(not (difficulty == hard))
	(goal oceanmap NO)
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total trebuchet < 6)
	(can-train trebuchet)
=>
	(train trebuchet)
	(chat-local-to-self "trebuchet")
)

(defrule
	(current-age == imperial-age)
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total missionary < 3)
	(unit-type-count-total monk >= 1)
	(can-train missionary)
=>
	(train missionary)
	(chat-local-to-self "missionary")
)


(defrule
	(timer-triggered MonkspeedTimer)
	(goal AllowMilitaryUnits NO)
	(unit-type-count-total monk < 1)
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk 1")
)

(defrule
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total monk < 3)
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk")
)

(defrule
	(difficulty == moderate)
	(not (civ-selected mongol))
	(not (civ-selected celtic))
	(not (civ-selected persian))
	(not (civ-selected viking))
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total monk < 5)
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk")
)

(defrule
	(difficulty == hard)
	(not (civ-selected mongol))
	(not (civ-selected celtic))
	(not (civ-selected persian))
	(not (civ-selected viking))
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total monk < 10)
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk")
)

(defrule
	(goal dificultad masQueModerado)
	(not (difficulty == hard))
	(not (civ-selected mongol))
	(not (civ-selected celtic))
	(not (civ-selected persian))
	(not (civ-selected viking))
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total monk <= 15)
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk")
)

(defrule
	(or
	(civ-selected aztec)	(civ-selected bengalis))
	(timer-triggered MonkspeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total monk < 30)
	(not (goal HumanTactical YES))
	(can-train monk)
=>
	(train monk)
	(chat-local-to-self "monk")
)


(defrule
	(goal oceanmap NO)
	(timer-triggered InfanteriaspeedTimer)
	(or
	(town-under-attack) (game-time > 7200)
	)
	(unit-type-count-total spearman-line < 30)
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered InfanteriaspeedTimer)
	(game-time > 5400)
	(not (players-stance any-ally ally))
	(unit-type-count-total spearman-line < 30)
	(not (goal HumanTactical YES))
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered InfanteriaspeedTimer)
	(current-age >= castle-age)
	(unit-type-count-total spearman-line < 15)
	(soldier-count > 40)
	(goal ArmyAdvantage ENEMY)
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman")
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal oceanmap NO)
	(not (goal AllowMilitaryUnits NO))
	(or
	(cc-players-unit-type-count any-enemy war-elephant-line > 5)	(goal EnemyCab YES))
	(not (unit-available camel-line))
	(unit-type-count-total spearman-line < 40)
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman-line")
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal oceanmap YES)
	(not (goal AllowMilitaryUnits NO))
	(or
	(cc-players-unit-type-count any-enemy war-elephant-line > 5)	(goal EnemyCab YES))
	(not (unit-available camel-line))
	(unit-type-count-total spearman-line < 20)
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman-line")
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(current-age == feudal-age)
	(goal oceanmap NO)
	(not (goal AllowMilitaryUnits NO))
	(goal Estrategia Eco)
	(unit-type-count-total spearman-line < 5)
	(can-train spearman-line)
=>
	(train spearman-line)
	(chat-local-to-self "spearman-line")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered ArqueriaspeedTimer)
	(or
	(town-under-attack) (game-time > 7200)
	)
	(unit-type-count-total skirmisher-line < 30)
	(can-train skirmisher-line)
=>
	(train skirmisher-line)
	(chat-local-to-self "skirmisher-line")
)

(defrule
	(goal oceanmap NO)
	(timer-triggered ArqueriaspeedTimer)
	(not (players-stance any-ally ally))
	(game-time > 5400)
	(not (goal HumanTactical YES))
	(unit-type-count-total skirmisher-line < 30)
	(can-train skirmisher-line)
=>
	(train skirmisher-line)
	(chat-local-to-self "skirmisher-line")
)

(defrule
	(goal oceanmap NO)
	(current-age == feudal-age)
	(unit-type-count-total skirmisher-line < 1)
	(unit-type-count-total scout-cavalry-line < 1)
	(unit-type-count-total eagle-warrior-line < 1)
	(can-train skirmisher-line)
=>
	(train skirmisher-line)
	(chat-local-to-self "skirmisher-line")
)

(defrule
	(goal oceanmap NO)
	(not (civ-selected turkish))
	(not (goal AllowMilitaryUnits NO))
	(timer-triggered ArqueriaspeedTimer)
    (or
	(cc-players-unit-type-count any-enemy mountedranged > 5)	(cc-players-unit-type-count any-enemy footranged > 15))
	(unit-type-count-total skirmisher-line < 20)
	(can-train skirmisher-line)
=>
	(train skirmisher-line)
	(chat-local-to-self "skirmisher-line")
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(cc-players-unit-type-count any-enemy footmelee > 15)
	(unit-type-count-total slinger < 20)
	(can-train slinger)
=>
	(train slinger)
	(chat-local-to-self "slinger")
)

(defrule
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(enemy-buildings-in-town)
	(unit-type-count-total petard < 5)
	(can-train petard)
=>
	(train petard)
	(chat-local-to-self "petard")
)

(defrule
	(not (goal oceanmap YES))
	(goal Gold? YES)
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total battering-ram-line < 4)
	(can-train battering-ram-line)
=>
	(train battering-ram-line)
	(chat-local-to-self " I want to ram something")
)

(defrule
	(not (goal oceanmap YES))
	(goal Gold? NO)
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total battering-ram-line < 6)
	(can-train battering-ram-line)
=>
	(train battering-ram-line)
	(chat-local-to-self " I want to ram something")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total battering-ram-line < 2)
	(enemy-buildings-in-town)
	(can-train battering-ram-line)
=>
	(train battering-ram-line)
	(chat-local-to-self " I want to ram something")
)

(defrule
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total armored-elephant-line < 6)
	(can-train armored-elephant-line)
=>
	(train armored-elephant-line)
	(chat-local-to-self " I want to armored-elephant something")
)

(defrule
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(not (town-under-attack))
	(unit-type-count-total bombard-cannon < 4)
	(can-train bombard-cannon)
=>
	(train bombard-cannon)
	(chat-local-to-self "I want to bombard cannon something")
)

(defrule
	(or
	(goal oceanmap YES)	(goal watermap YES))
	(building-type-count-total dock less-than 1)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(unit-type-count-total bombard-cannon < 5)
	(can-train bombard-cannon)
=>
	(train bombard-cannon)
	(chat-local-to-self "coast defender! with CANNONS!!!")
)


(defrule
    (or
	(or
	(civ-selected korean) (civ-selected celtic))
	(civ-selected mongol))
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(current-age == imperial-age)
	(unit-type-count mangonel-line < 5)
	(can-train mangonel-line)
=>
	(train mangonel-line)
	(chat-local-to-self "I want to mangonel something")
)

(defrule
	(goal oceanmap YES)
    (or
	(or
	(civ-selected aztec) (civ-selected briton))
	(civ-selected mayan))
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(current-age == imperial-age)
	(unit-type-count mangonel-line < 8)
	(can-train mangonel-line)
=>
	(train mangonel-line)
	(chat-local-to-self "I want to coast defender something")
)

(defrule
	(or
	(goal oceanmap YES)	(goal watermap YES))
	(building-type-count-total dock less-than 1)
	(timer-triggered ShipsTimer)
	(not (unit-available bombard-cannon))
	(goal Allowmilitaryboats YES)
	(unit-type-count mangonel-line < 8)
	(can-train mangonel-line)
=>
	(train mangonel-line)
	(chat-local-to-self "coast defender!")
)

(defrule
	(goal oceanmap NO)
    (or
	(or
	(civ-selected chinese) (civ-selected celtic))
	(civ-selected mongol))
	(timer-triggered siegespeedTimer)
	(not (goal AllowMilitaryUnits NO))
	(current-age == imperial-age)
	(unit-type-count scorpion-line <= 8)
	(can-train scorpion-line)
=>
	(train scorpion-line)
	(chat-local-to-self "I want to scorpion something")
)

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total galley-line < 3)
	(can-train galley-line)
=>
	(train galley-line)
	(chat-local-to-self "galley-line")
)

(defrule
	(or
	(civ-selected saracen) (civ-selected viking))
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(not (unit-available longboat-line))
	(unit-type-count-total galley-line < 10)
	(can-train galley-line)
=>
	(train galley-line)
	(chat-local-to-self "galley-line")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(or
	(civ-selected saracen) (civ-selected viking))
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(not (unit-available longboat-line))
	(unit-type-count-total galley-line < 20)
	(can-train galley-line)
=>
	(train galley-line)
	(chat-local-to-self "galley-line")
)

#load-if-defined PORTUGUESE-CIV
(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total caravel-line < 10)
	(can-train caravel-line)
=>
	(train caravel-line)
	(chat-local-to-self "caravel")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total caravel-line < 20)
	(can-train caravel-line)
=>
	(train caravel-line)
	(chat-local-to-self "caravel")
)

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(not (unit-available caravel-line))
	(unit-type-count-total galley-line < 10)
	(can-train galley-line)
=>
	(train galley-line)
	(chat-local-to-self "galley-line")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(not (unit-available caravel-line))
	(unit-type-count-total galley-line < 20)
	(can-train galley-line)
=>
	(train galley-line)
	(chat-local-to-self "galley-line")
)
#end-if

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total longboat-line < 20)
	(can-train longboat-line)
=>
	(train longboat-line)
	(chat-local-to-self "longboat-line")
)

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total longboat-line < 10)
	(can-train longboat-line)
=>
	(train longboat-line)
	(chat-local-to-self "longboat-line")
)

#load-if-not-defined PORTUGUESE-CIV
(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(not (civ-selected saracen))
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total fire-ship-line < 20)
	(can-train fire-ship-line)
=>
	(train fire-ship-line)
	(chat-local-to-self "fire-ship-line")
)

(defrule
	(not (civ-selected saracen))
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total fire-ship-line < 10)
	(can-train fire-ship-line)
=>
	(train fire-ship-line)
	(chat-local-to-self "fire-ship-line")
)

(defrule
	(civ-selected saracen)
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total fire-ship-line < 5)
	(can-train fire-ship-line)
=>
	(train fire-ship-line)
	(chat-local-to-self "fire-ship-line")
)
#end-if

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total cannon-galleon-line < 5)
	(can-train cannon-galleon-line)
=>
	(train cannon-galleon-line)
	(chat-local-to-self "cannon-galleon-line")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total cannon-galleon-line < 10)
	(can-train cannon-galleon-line)
=>
	(train cannon-galleon-line)
	(chat-local-to-self "cannon-galleon-line")
)

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total dromon < 6)
	(can-train dromon)
=>
	(train dromon)
	(chat-local-to-self "dromon")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total dromon < 12)
	(can-train dromon)
=>
	(train dromon)
	(chat-local-to-self "dromon")
)

(defrule
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total turtle-ship-line < 3)
	(can-train turtle-ship-line)
=>
	(train turtle-ship-line)
	(chat-local-to-self "turtle-ship-line")
)


(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(unit-type-count-total turtle-ship-line < 5)
	(can-train turtle-ship-line)
=>
	(train turtle-ship-line)
	(chat-local-to-self "turtle-ship-line")
)

(defrule
	(goal oceanmap YES)
	(timer-triggered ShipsTimer)
	(goal Allowmilitaryboats YES)
	(not (goal Allowmilitaryboats NO))
	(not (town-under-attack))
	(unit-type-count-total transport-ship < 6)
	(unit-type-count-total warships > 3)
	(can-train transport-ship)
=>
	(train transport-ship)
	(chat-local-to-self "transport-ship")
)

(defrule
	(current-age >= castle-age)
	(not (town-under-attack))
	(unit-type-count-total transport-ship < 2)
	(unit-type-count-total warships > 3)
	(can-train transport-ship)
=>
	(train transport-ship)
	(chat-local-to-self "transport-ship")
)

(defrule
	(civ-selected chinese)
	(timer-triggered ShipsTimer)
	(not (goal AllowMilitaryUnits NO))
	(unit-type-count-total demolition-ship-line < 3)
	(can-train demolition-ship-line)
=>
	(train demolition-ship-line)
	(chat-local-to-self "demolition-ship")
)



; ============== ADVANCING IN AGE


; Dark to Feudal

(defrule
	(can-research feudal-age )
	(current-age == dark-age)
=>
	(set-goal 16 96)
	(disable-self)
)

(defrule
	(goal 16 96)
	(can-research-with-escrow feudal-age)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research feudal-age)
	(set-goal Age RESEARCHFEUDAL)
	(chat-to-allies "Voy a avanzar a la edad feudal.")
	(chat-local-to-self "rising to feudal")
)


; Feudal to Castle

(defrule
	(current-age == feudal-age)
	(research-completed ri-wheel-barrow)
=>
	(set-goal 16 98)
	(disable-self)
)

(defrule
	(current-age == feudal-age)
	(food-amount > 5000)
=>
	(set-goal 16 98)
	(disable-self)
)

(defrule
(goal 16 98)
	(difficulty < hardest)
	(gold-amount <= 200)
	(wood-amount greater-than 600)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "selling wood for castle gold")
	(sell-commodity wood)
)

(defrule
(goal 16 98)
	(difficulty < hardest)
	(gold-amount <= 0)
	(stone-amount greater-than 700)
	(commodity-selling-price stone greater-than 50)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "selling stone for castle gold")
	(sell-commodity stone)
)

(defrule
(goal 16 98)
	(difficulty < hardest)
	(gold-amount <= 200)
	(food-amount greater-or-equal 900)
	(can-sell-commodity food)
=>
	(chat-local-to-self "selling food for castle gold")
	(sell-commodity food)
)

;getting needed food
(defrule
(goal 16 98)
	(difficulty < hardest)
	(food-amount <= 800)
	(gold-amount greater-or-equal 300)
	(can-buy-commodity food)
=>
	(chat-local-to-self "buying castle food")
	(buy-commodity food)
)

(defrule
(goal 16 98)
	(difficulty >= hardest)
	(game-type < 900)
	(food-amount <= 500)
	(gold-amount greater-or-equal 1000)
	(can-buy-commodity food)
=>
	(chat-local-to-self "buying castle food")
	(buy-commodity food)
)

; advance to castle age if possible.
(defrule
	(goal 16 98)
	(can-research-with-escrow castle-age)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research castle-age)
	(set-goal Age RESEARCHCASTLE)
	(chat-to-allies "Voy a avanzar a la edad de los castillios.")
	(chat-local-to-self "rising to castle")
)

; Castle to Imperial

(defrule
	(unit-type-count-total villager > 10)
	(goal Age GOTOIMPERIAL)
	(current-age == castle-age)
=>
	(set-goal 16 99)
	(disable-self)
)

(defrule
(goal 16 99)
	(gold-amount <= 800)
	(wood-amount greater-than 600)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "selling wood for imperial gold")
	(sell-commodity wood)
)

(defrule
(goal 16 99)
	(gold-amount <= 100)
	(stone-amount greater-than 750)
	(commodity-selling-price stone greater-than 50)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "selling stone for imperial gold")
	(sell-commodity stone)
)

(defrule
(goal 16 99)
	(gold-amount <= 800)
	(food-amount greater-or-equal 1100)
	(can-sell-commodity food)
=>
	(chat-local-to-self "selling food for imperial gold")
	(sell-commodity food)
)

;getting needed food
(defrule
(goal 16 99)
	(food-amount <= 1000)
	(gold-amount greater-or-equal 900)
	(commodity-buying-price food less-than 200)
	(can-buy-commodity food)
=>
	(chat-local-to-self "buying imperial food")
	(buy-commodity food)
)

; advance to imperial age if possible.
(defrule
;	(goal 16 99)
	(can-research-with-escrow imperial-age)
	(goal Age GOTOIMPERIAL)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research imperial-age)
	(set-goal Age RESEARCHIMPERIAL)
	(chat-to-allies "Voy a avanzar a la edad IMPERIAL.")
	(chat-local-to-self "rising to imperial")
)

; ========================== UPGRADES - I usually use the same rules for upgrades for all civs.  If the AI has a certain number of units, it tries to upgrade them. 

; problem with escrow - give up

(defrule
	(or
		(or
			(escrow-amount wood > 2000)
			(escrow-amount food > 2000)
		)
		(or
			(escrow-amount gold > 3000)
			(escrow-amount stone > 3000)
		)
	)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(set-goal 16 0)
)


; ////////////////////////////////////////////////////

; sets initial goal for escrow to make sure there are villagers

(defrule
	(true)
=>
	(set-goal 16 50)
	(disable-self)
)

#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined VIKING-CIV
(defrule
	;(not (civ-selected viking))
	(research-completed ri-hand-cart)
=>
	(set-goal 16 0)
	(disable-self)
)
#end-if
#end-if

#load-if-defined VIKING-CIV
(defrule
	;(civ-selected viking)
	(research-completed ri-bow-saw)
=>
	(set-goal 16 0)
	(disable-self)
)
#end-if

#load-if-defined BURGUNDIANS-CIV
(defrule
	(research-completed ri-crop-rotation)
=>
	(set-goal 16 0)
	(disable-self)
)
#end-if

(defrule
	(not (civ-selected turkish))
	(current-age == imperial-age)
	(research-completed ri-chemistry)
	
=>
	(set-goal 16 0)
	(disable-self)
)
; sets escrow

(defrule
	(true)
=>
	(set-escrow-percentage wood 0)
	(set-escrow-percentage food 0)
	(set-escrow-percentage gold 0)
	(set-escrow-percentage stone 0)
)

;;;;;;;;;;;;;;Permitir Mejoras;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defrule
	(current-age == dark-age)
=>
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal AllowboatTechs 0)						
	(disable-self)
)

(defrule
	(true)
=>
	(set-goal feudalWars NO)
	(set-goal AllowMilitaryTechs 1)	
	(disable-self)
)

(defrule
	(current-age == feudal-age)
	(unit-type-count villager >= 30)
	(gold-amount < 200)
=>
	(set-goal feudalWars YES)
)

(defrule
	(goal feudalWars YES)
	(current-age == feudal-age)
	(unit-type-count villager >= 35)
	(soldier-count < 10)
	(game-time > 1200 )
=>
	(set-goal AllowMilitaryUnits YES)
)


(defrule
	(goal feudalWars YES)
	(not (goal Estrategia Agre))
	(current-age == feudal-age)
	(research-available castle-age)
	(unit-type-count villager >= 40)
	(soldier-count >= 10)
	(goal AllowMilitaryUnits YES)
=>
	(set-goal AllowMilitaryUnits NO)
)

(defrule
	(goal feudalWars YES)
	(not (goal Estrategia Agre))
	(current-age == feudal-age)
	(research-available castle-age)
	(can-research-with-escrow feudal-age)
	(goal AllowMilitaryUnits YES)
=>
	(set-goal AllowMilitaryUnits NO)
)

(defrule
	(goal feudalWars YES)
	(goal Estrategia Agre)
	(current-age == feudal-age)
	(research-available castle-age)
	(goal AllowMilitaryUnits YES)
	(game-time > 1800 )
=>
	(set-goal AllowMilitaryUnits NO)
)


(defrule
	(current-age == castle-age)
=>
	(set-goal AllowMilitaryTechs 1)	
	(set-goal feudalWars NO)	
	(set-goal AllowMilitaryUnits NO)	
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(research-completed ri-bow-saw)
=>
	(set-goal AllowMilitaryUnits YES)						
	(disable-self)
)

(defrule
	(current-age == castle-age)
	(unit-type-count villager >= 35)
	(soldier-count >= 30)
	(food-amount < 5000)
	(not (civ-selected viking))
	(not (research-completed ri-hand-cart))
=>
	(set-goal AllowMilitaryTechs 1)
	(set-goal AllowMilitaryUnits NO)
)

(defrule
	(goal oceanmap YES)
	(not (goal AllowMilitaryUnits NO))
	(current-age == castle-age)
	(unit-type-count villager >= 35)
	(soldier-count >= 10)
	(unit-type-count-total warships < 8)
=>
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats YES)

)

(defrule
	(goal oceanmap YES)
	(goal AllowMilitaryUnits NO)
	(goal Allowmilitaryboats YES)
	(current-age == castle-age)
	(unit-type-count villager >= 35)
	(unit-type-count-total warships > 10)
=>
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats NO)

)

(defrule
	(not (civ-selected viking))
	(current-age == castle-age)
	(research-completed ri-wheel-barrow)
	(research-completed ri-hand-cart)
=>		
	(set-goal AllowMilitaryUnits YES)
	(disable-self)
)


(defrule
	(current-age == castle-age)
	(soldier-count <= 10)
	(not (research-completed ri-hand-cart))
=>
	(set-goal AllowMilitaryUnits YES)
)

(defrule
	(not (goal AllowMilitaryUnits NO))
	(not (goal oceanmap YES))
	(current-age >= castle-age)
	(building-type-count-total monastery >= 1)
	(soldier-count > 12)
	(unit-type-count-total monk < 1)
	(cc-players-unit-type-count 0 285 > 0)
	(gold-amount < 100)
=>		
	(set-goal AllowMilitaryUnits NO)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(unit-type-count-total monk >= 1)
	(gold-amount < 100)
=>		
	(set-goal AllowMilitaryUnits YES)
	(disable-self)
)

(defrule
	(current-age == castle-age)
	(research-available imperial-age)
	(not (goal Age RESEARCHIMPERIAL))
	(unit-type-count villager >= 35)
	(population >= 120)
	(research-completed ri-hand-cart)
=>
	(set-goal Age GOTOIMPERIAL)
	(set-goal AllowMilitaryUnits NO)						
)

(defrule
	(current-age == castle-age)
	(goal Estrategia Eco)
	(research-available imperial-age)
	(not (goal Age RESEARCHIMPERIAL))
	(unit-type-count villager >= 35)
	(population >= 100)
	(research-completed ri-hand-cart)
=>
	(set-goal Age GOTOIMPERIAL)
	(set-goal AllowMilitaryUnits NO)						
)

(defrule
	(current-age == castle-age)
	(research-available imperial-age)
	(not (goal Age RESEARCHIMPERIAL))
	(soldier-count > 15)
	(food-amount > 2000)
=>
	(set-goal Age GOTOIMPERIAL)					
)

;***********************FIX ¿?**********************
(defrule
	(current-age == castle-age)
	(research-available imperial-age)
	(goal Age RESEARCHIMPERIAL)
	(soldier-count > 30)
	(food-amount > 2500)
=>
	(set-goal Age GOTOIMPERIAL)					
)
;**********************************************************

(defrule
	(current-age == castle-age)
	(soldier-count <= 20)
	(goal Age GOTOIMPERIAL)
=>
	(set-goal AllowMilitaryUnits YES)						
)

(defrule
	(current-age == castle-age)
	(goal Age RESEARCHIMPERIAL)
=>
	(set-goal AllowMilitaryUnits YES)						
)

(defrule
	(current-age == imperial-age)
	(unit-type-count villager >= 35)
	(soldier-count >= 30)
	(food-amount < 5000)
	(research-available ri-chemistry)
=>
	(set-goal AllowMilitaryTechs 1)	
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)

(defrule
	(civ-selected turkish)
	(current-age == imperial-age)
	(unit-type-count villager >= 35)
	(soldier-count >= 35)
	(food-amount < 5000)
	(building-type-count castle >= 1)
	(not (research-completed ri-cavalier))
=>
	(set-goal AllowMilitaryTechs 1)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
	(disable-self)
)



(defrule
	
	(not (civ-selected turkish))
	(current-age == imperial-age)
	(research-completed ri-chemistry)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(civ-selected turkish)
	(current-age == imperial-age)
	(research-completed ri-cavalier)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(unit-type-count villager >= 35)
	(population >= 140)
	(unit-type-count my-unique-unit > 10)
	(building-type-count castle >= 1)
	(research-completed ri-chemistry)
	(not (research-completed my-unique-unit-upgrade))
=>
	(set-goal AllowMilitaryTechs 2)					
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)

(defrule
	(civ-selected persian)
	(goal oceanmap NO)
	(current-age == imperial-age)
	(population >= 155)
	(building-type-count castle >= 1)
	(research-completed ri-chemistry)
	(not (research-completed my-unique-unit-upgrade))
=>
	(set-goal AllowMilitaryTechs 2)					
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)

(defrule
	(population >= 160)
	(unit-type-count-total cavalier > 20)
	(not (research-completed ri-paladin))
	(research-available ri-paladin)
=>
	(set-goal AllowMilitaryTechs 1)				
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)

(defrule
	(population >= 155)
	(unit-type-count-total cavalry-archer > 10)
	(goal UnitType ARQ)
	(not (research-completed ri-heavy-cavalry-archer))
	(research-available ri-heavy-cavalry-archer)
=>
	(set-goal AllowMilitaryTechs 1)				
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)

(defrule
	(current-age == imperial-age)
	(unit-type-count villager >= 35)
	(population >= 145)
	(unit-type-count mangonel >= 5)
	(not (research-completed ri-onager))
=>
	(set-goal AllowMilitaryTechs 1)					
	(set-goal 16 0)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)	
)

#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined HUN-CIV
(defrule
	(current-age == imperial-age)
	(unit-type-count villager >= 35)
	(population >= 190)
	(building-type-count castle >= 1)
	(research-completed my-unique-unit-upgrade)
	(not (research-completed my-unique-research))
=>
	(set-goal AllowMilitaryTechs 1)					
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)						
)
#end-if
#end-if

(defrule
	(current-age == imperial-age)
	(population <= 100)
	(research-completed ri-chemistry)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
)


(defrule
	(current-age == imperial-age)
	(research-completed ri-paladin)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)


(defrule
	(current-age == imperial-age)
	(research-completed ri-heavy-cavalry-archer)
	(goal UnitType ARQ)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(research-completed my-unique-unit-upgrade)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)


(defrule
	(current-age == imperial-age)
	(research-completed ri-onager)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(population >= 175)
	(cc-players-unit-type-count any-enemy monk > 7)
	(building-type-count monastery >= 1)
	(not (town-under-attack))
	(research-completed my-unique-unit-upgrade)
	(not (research-completed ri-faith))
=>
	(set-goal AllowMilitaryTechs 3)					; Allows military technologies
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 0)							
)

(defrule
	(goal AllowMilitaryTechs 3)
	(current-age == imperial-age)
	(population <= 100)
	(research-completed my-unique-unit-upgrade)
	(not (research-completed ri-faith))
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
)

(defrule
	(current-age == imperial-age)
	(research-completed my-unique-unit-upgrade)
	(research-completed ri-faith)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(research-completed my-unique-unit-upgrade)
	(research-completed my-unique-research)
=>		
	(set-goal AllowMilitaryUnits YES)
	(set-goal AllowMilitaryTechs 1)	
	(set-goal 16 0)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)
	(disable-self)
)

(defrule
	(current-age == imperial-age)
	(population <= 160)
	(research-completed my-unique-research)
	(research-completed ri-chemistry)
	(research-completed my-unique-unit-upgrade)
=>
	(set-goal AllowMilitaryTechs 1)					; Allows military technologies
	(set-goal 16 0)
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)						
)

;**********************************MEJORAS SECUNDARIAS********************************

(defrule							; Goal initialization
	(true)
=>
	(set-goal techstime NO)
	(disable-self)
)

(defrule							; Goal initialization
	(true)
=>
	(set-goal needRecourses NO)
	(disable-self)
)

(defrule							; Goal initialization
	(true)
=>
	(set-goal techsready NONE)
	(disable-self)
)

(defrule
	(current-age == castle-age)
	(soldier-count >= 10)
	(or
	(or	(food-amount < 1500)
		(gold-amount < 1500))
		
		(wood-amount < 900)
	)
=>
	(set-goal needRecourses YES)
)

(defrule
	(current-age == imperial-age)
	(soldier-count > 10)
	(or
	(or	(food-amount < 1500)
		(gold-amount < 1500))
		
		(wood-amount < 900)
	)
=>
	(set-goal needRecourses YES)
)

(defrule
	(food-amount > 1500)
	(gold-amount > 1500)
	(wood-amount > 900)
=>
	(set-goal needRecourses NO)
)

(defrule
	(current-age == imperial-age)
	(or	(or	(and(unit-type-count mountedmelee > 15)
				(research-available ri-scale-barding)	; Armor 1 mounted
			)
			(and(unit-type-count mountedmelee > 15)
				(research-available ri-chain-barding)	; Armor 2 mounted
			)
		)
		(and(unit-type-count mountedmelee > 15)
			(research-available ri-plate-barding)		; Armor 3 mounted
		)
	)
=>
	(set-goal techstime SLOW)
)

(defrule
	(current-age == imperial-age)
	(or	(or	(and(unit-type-count footmelee > 15)
				(research-available ri-scale-mail)	; Armor 1 foot
			)
			(and(unit-type-count footmelee > 20)
				(research-available ri-chain-mail)	; Armor 2 foot
			)
		)
		(and(unit-type-count footmelee > 15)
			(research-available ri-plate-mail)		; Armor 3 foot
		)
	)
=>
	(set-goal techstime SLOW)
)

(defrule
	(current-age == imperial-age)
	(or	(and(or	(unit-type-count footmelee > 10)
				(unit-type-count mountedmelee > 10)
			)
			(research-available ri-forging)				; Attack 1 melee
		)
		(and(or	(unit-type-count footmelee > 20)
				(unit-type-count mountedmelee > 20)
			)
			(research-available ri-iron-casting)		; Attack 2 melee

		)
	)
=>
	(set-goal techstime SLOW)
)

(defrule
	(current-age == imperial-age)
	(or	(unit-type-count footmelee > 20)
		(unit-type-count mountedmelee > 15)
	)
	(research-available ri-blast-furnace)				; Attack 3 melee

=>
	(set-goal techstime SLOW)
)

(defrule
	(current-age == imperial-age)
	(or	(and(or	(unit-type-count footranged > 10)
				(unit-type-count mountedranged > 10)
			)
			(research-available ri-padded-archer-armor)			; Armor 1 archer
		)
		(and(or	(unit-type-count footranged > 15)
				(unit-type-count mountedranged > 15)
			)
			(research-available ri-leather-archer-armor)		; Armor 2 archer
		)
	)
=>
	(set-goal techstime SLOW)
)

(defrule
	(current-age == imperial-age)
		(and(or	(unit-type-count footranged > 15)
				(unit-type-count mountedranged > 15)
			)
			(research-available ri-ring-archer-armor)	; Armor 3 archer
		)
=>
	(set-goal techstime SLOW)
)

(defrule
	(goal techsready NONE)
	(current-age == imperial-age)
	(research-completed ri-iron-casting)
	(and 
	(not(research-available ri-ring-archer-armor))
		(not(research-available ri-blast-furnace))
	)
=>
	(set-goal techsready 1)
	(disable-self)
)

(defrule
	(goal techsready 1)
	(and	(and	(and(research-completed ri-chain-barding)
				(not(research-available ri-plate-barding))
			)
			(and(research-completed ri-chain-mail)
				(not(research-available ri-plate-mail))	  
			)
		)
		(and(research-completed ri-leather-archer-armor)
			(not (research-available ri-ring-archer-armor))		  
		)
	)
=>
	(set-goal techsready YES)
)

(defrule
	(goal techsready YES)
=>
	(set-goal techstime NO)
	(disable-self)
)

(defrule
	(or
	(goal oceanmap YES)	(goal watermap YES))
	(goal needRecourses YES)
	(not (goal techstime SLOW))
	(current-age == imperial-age)
	(soldier-count > 30)
=>
	(set-goal techstime MANY)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal needRecourses YES)
	(not (goal techstime SLOW))
	(current-age == imperial-age)
	(soldier-count > 30)
	(unit-type-count-total  trebuchet < 3)
=>
	(set-goal techstime MANY)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal needRecourses YES)
	(not (goal techstime SLOW))
	(current-age == imperial-age)
	(soldier-count > 30)
	(soldier-count < 80)
	(unit-type-count-total  trebuchet >= 3)
=>
	(set-goal techstime NO)
)

(defrule
	(not (goal oceanmap YES))
	(not (goal watermap YES))
	(goal needRecourses YES)
	(not (goal techstime SLOW))
	(current-age == imperial-age)
	(soldier-count > 80)
	(unit-type-count-total  trebuchet < 3)
=>
	(set-goal techstime MANY)
)

(defrule
	(goal needRecourses YES)
	(goal techstime MANY)
	(goal techsready YES)
	(not (town-under-attack))
	(current-age == imperial-age)
	(soldier-count >= 85)
	(or
	(unit-type-count-total  trebuchet < 3)	(goal Needcannongaleon YES))
=>
	(set-goal techstime SLOW)
)

(defrule
	(goal needRecourses YES)
	(goal techstime SLOW)
	(goal techsready YES)
	(current-age == imperial-age)
	(unit-type-count-total  trebuchet >= 3)
	(not (goal Needcannongaleon YES))
=>
	(set-goal techstime MANY)
)

(defrule
	(soldier-count < 10)
=>
	(set-goal techstime NO)
)

(defrule
	(true)
=>
	(set-goal Needcannongaleon NO)
	(disable-self)
)

(defrule
	(or
	(goal oceanmap YES)	(goal watermap YES))
	(research-completed ri-cannon-galleon)
	(unit-type-count-total cannon-galleon-line < 3)
=>
	(set-goal Needcannongaleon YES)
)

(defrule
	(goal Needcannongaleon YES)
	(unit-type-count-total cannon-galleon-line >= 3)
=>
	(set-goal Needcannongaleon NO)
)

;**************SHIPS


(defrule
	(current-age == imperial-age)
	(population >= 150)
	(not (goal AllowMilitaryUnits NO))
	(building-type-count dock >= 1)
	(not (town-under-attack))
	(unit-type-count-total galley-line > 1)
	(research-available ri-cannon-galleon)
	(not (research-completed ri-cannon-galleon))
=>
	(set-goal AllowMilitaryTechs 0)					; Allows military technologies
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 2)						
)

(defrule
	(current-age == imperial-age)
	(population >= 150)
	(not (goal AllowMilitaryUnits NO))
	(building-type-count dock >= 1)
	(not (town-under-attack))
	(research-available 376)
	(unit-type-count-total cannon-galleon-line >= 5)
=>
	(set-goal AllowMilitaryTechs 0)					; Allows military technologies
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 2)						
)

(defrule
	(civ-selected viking)
	(current-age == imperial-age)
	(population >= 155)
	(not (goal AllowMilitaryUnits NO))
	(building-type-count dock >= 1)
	(not (town-under-attack))
	(unit-type-count-total longboat-line > 5)
	(not (research-completed ri-elite-longboat))
=>
	(set-goal AllowMilitaryTechs 0)					; Allows military technologies
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 4)						
)

#load-if-defined PORTUGUESE-CIV
(defrule
	(current-age == imperial-age)
	(population >= 155)
	(not (goal AllowMilitaryUnits NO))
	(building-type-count dock >= 1)
	(not (town-under-attack))
	(unit-type-count-total caravel-line > 5)
	(not (research-completed ri-elite-caravel))
=>
	(set-goal AllowMilitaryTechs 0)					; Allows military technologies
	(set-goal 16 50)
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats NO)
	(set-goal AllowboatTechs 4)						
)
#end-if

(defrule
	(current-age == imperial-age)
	(research-completed ri-cannon-galleon)
=>
	(set-goal AllowMilitaryTechs 1)					; Allows military technologies
	(set-goal 16 0)
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)						
)

(defrule
	(current-age == imperial-age)
	(research-completed ri-deck-guns)
=>
	(set-goal AllowMilitaryTechs 1)					; Allows military technologies
	(set-goal 16 0)
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)						
)

(defrule
	(current-age == imperial-age)
	(research-completed ri-elite-longboat)
=>
	(set-goal AllowMilitaryTechs 1)					; Allows military technologies
	(set-goal 16 0)
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
	(set-goal AllowboatTechs 1)						
)

(defrule
	(goal oceanmap YES)
	(current-age == imperial-age)
	(not (goal AllowMilitaryUnits NO))
	(not (goal Allowmilitaryboats NO))
	(soldier-count > 50)
	(building-type-count dock >= 1)
	(unit-type-count-total warships <= 10)
=>
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats YES)						
)

(defrule
	(goal oceanmap YES)
	(current-age == imperial-age)
	(not (goal AllowMilitaryUnits NO))
	(not (goal Allowmilitaryboats NO))
	(population >= 195)
	(unit-type-count-total transport-ship < 2)
	(building-type-count dock >= 1)
	(not (town-under-attack))
=>
	(set-goal AllowMilitaryUnits NO)
	(set-goal Allowmilitaryboats YES)						
)

(defrule
	(goal oceanmap YES)
	(goal AllowMilitaryUnits NO)
	(goal Allowmilitaryboats YES)
	(current-age == imperial-age)
	(population >= 195)
	(unit-type-count-total transport-ship >= 4)
=>
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
)

(defrule
	(goal oceanmap YES)
	(goal AllowMilitaryUnits NO)
	(goal Allowmilitaryboats YES)
	(current-age == imperial-age)
	(soldier-count < 50)
=>
	(set-goal AllowMilitaryUnits YES)
	(set-goal Allowmilitaryboats YES)
)

;/////////////////////////////TIMERS Y ESTRATEGIA/////////////////

(defrule
	(true)
=>
	(set-goal HumanTactical NO)
	(disable-self)
)

(defrule
	(food-amount > 2000)
	(current-age >= castle-age)
	(unit-type-count villager < 50)
=>
	(set-goal UnitType CAB)
)

(defrule
	(food-amount < 2000)
	(current-age >= castle-age)
	(unit-type-count villager < 50)
=>
	(set-goal UnitType INF)
)

(defrule
	(soldier-count > 30)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(unit-available knight-line)
=>
	(set-goal UnitType CAB)
)

(defrule
	(soldier-count > 30)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(unit-type-count villager >= 50)
	(building-type-count-total castle > 1)
	(unit-available knight-line)
	(not (civ-selected teutonic))
=>
	(set-goal UnitType CAB)
)

(defrule
	(soldier-count > 30)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(unit-available knight-line)
=>
	(set-goal UnitType ARQ)
)

(defrule
	(soldier-count > 30)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
	(unit-type-count villager >= 50)
	(building-type-count-total castle > 1)
	(unit-available knight-line)
	(not (civ-selected korean))
=>
	(set-goal UnitType ARQ)
)

(defrule
	(soldier-count > 30)
	(civ-selected korean)
	(goal watermap YES)
	(not (goal HumanTactical YES))
	(building-type-count-total castle >= 1)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(unit-type-count villager >= 50)
=>
	(set-goal UnitType UNI)
)

(defrule
	(soldier-count > 30)
	(civ-selected mayan)
	(not (goal HumanTactical YES))
	(building-type-count-total castle < 1)
	(unit-type-count villager >= 50)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
=>
	(set-goal UnitType ARQ)
)

(defrule
	(soldier-count > 30)
	(not (unit-available knight-line))
	(building-type-count-total castle >= 1)
	(unit-type-count villager >= 50)
	(not (goal HumanTactical YES))
	(research-completed ri-hand-cart)
	(current-age == castle-age)
=>
	(set-goal UnitType UNI)
)

(defrule
	(soldier-count > 30)
	(civ-selected teutonic)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(building-type-count-total castle >= 1)
	(research-completed ri-hand-cart)
	(current-age == castle-age)
	(unit-type-count villager >= 50)
=>
	(set-goal UnitType UNI)
)

(defrule
	(soldier-count >= 51)
	(goal UnitType DEFENSE)
	(current-age == imperial-age)
=>
	(set-goal UnitType CAB)
	(set-goal HumanTactical NO)
)

(defrule
	(soldier-count < 50)
	(goal needRecourses YES)
	(town-under-attack)
	(goal ArmyAdvantage ENEMY)
	(current-age == imperial-age)
=>
	(set-goal UnitType DEFENSE)
)

;(defrule
;	(soldier-count < 70)
;	(soldier-count >= 40)
;	(goal needRecourses YES)
;	(town-under-attack)
;	(goal ArmyAdvantage ENEMY)
;	(research-completed ri-hand-cart)
;	(current-age == castle-age)
;=>
;	(set-goal UnitType DEFENSE)
;)


;*****Civs

(defrule
	(unit-type-count villager >= 50)
	(not (civ-selected byzantine))
	(not (civ-selected frankish))
	(not (civ-selected saracen))
	(not (goal watermap YES))
	(goal HumanTactical NO)
	(building-type-count-total castle >= 1)
	(not (goal UnitType DEFENSE))
	(not (goal Gold? YES))
=>
	(set-goal UnitType UNI)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(not (civ-selected saracen))
	(not (goal UnitType DEFENSE))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(current-age == imperial-age)
	(unit-available knight-line)
=>
	(set-goal UnitType CAB)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(unit-available hand-cannoneer)
	(not (unit-available camel-line))
	(not (civ-selected korean))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
;	(not (civ-selected byzantine))
	(unit-available knight-line)
	(current-age == imperial-age)
	(goal Gold? YES)
=>
	(set-goal UnitType CAB)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
   (or
	(or
	(civ-selected hun)	(civ-selected celtic))
	(civ-selected briton))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(current-age == imperial-age)
	(goal Gold? YES)
=>
	(set-goal UnitType CAB)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(civ-selected turkish)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(current-age == imperial-age)
	(goal Gold? YES)
=>
	(set-goal UnitType CAB)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(not (goal EnemyCab YES))
	(civ-selected saracen)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(current-age == imperial-age)
=>
	(set-goal UnitType ARQ)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle >= 1)
	(not (goal UnitType DEFENSE))
	(goal EnemyCab YES)
	(not (goal EnemyCab NO))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(civ-selected saracen)
	(current-age == imperial-age)
=>
	(set-goal UnitType UNI)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(not (goal UnitType DEFENSE))
	(goal EnemyCab YES)
	(not (goal EnemyCab NO))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(civ-selected saracen)
	(current-age == imperial-age)
=>
	(set-goal UnitType INF)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(not (goal EnemyInf YES))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(civ-selected byzantine)
	(current-age == imperial-age)
=>
	(set-goal UnitType CAB)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle >= 1)
	(not (goal UnitType DEFENSE))
	(goal EnemyInf YES)
	(not (goal EnemyInf NO))
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
	(civ-selected byzantine)
	(current-age == imperial-age)
=>
	(set-goal UnitType UNI)
)

(defrule
	(or
	(civ-selected chinese) (civ-selected mongol))
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
=>
	(set-goal UnitType UNI)
)

(defrule
    (or
	(or
	(civ-selected korean) (civ-selected viking))
	(civ-selected persian))
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
	(not (goal watermap YES))
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType UNI)
)

(defrule
	(not (unit-available knight-line))
	(unit-type-count villager >= 50)
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
	(not (goal HumanTactical YES))
	;(not (research-completed my-unique-unit-upgrade))
=>
	(set-goal UnitType UNI)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(current-age == imperial-age)
	(not (goal UnitType DEFENSE))
	(not (goal HumanTactical YES))
	(civ-selected aztec)
=>
	(set-goal UnitType INF)
)

(defrule
	(unit-type-count villager >= 50)
	(building-type-count-total castle < 1)
	(not (goal UnitType DEFENSE))
	(not (goal HumanTactical YES))
	(current-age == imperial-age)
	(civ-selected mayan)
=>
	(set-goal UnitType ARQ)
)

;****WATER!

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(or
	(civ-selected hun)	(civ-selected byzantine))
	(current-age == imperial-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType ARQ)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
   (or
	(or
	(civ-selected persian)	(civ-selected saracen))
	(civ-selected turkish))
	(current-age == imperial-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType ARQ)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(building-type-count-total castle < 1)
	(current-age == imperial-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType ARQ)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
   (or
	(or
	(not (unit-available hand-cannoneer))	(civ-selected korean))
	(civ-selected spanish))
	(not (civ-selected hun))
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
	(goal watermap YES)
	(goal HumanTactical NO)
=>
	(set-goal UnitType UNI)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
   (or
	(or
	(civ-selected frankish)	(civ-selected gothic))
	(civ-selected teutonic))
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType UNI)
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(civ-selected japanese)
	(building-type-count-total castle >= 1)
	(current-age == imperial-age)
	(goal watermap YES)
	(not (goal HumanTactical YES))
=>
	(set-goal UnitType UNI)
)

;******************************HUMAN ESTRATEGIA*******

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(taunt-detected any-ally 45)
	(building-type-count-total castle >= 1)
	(current-age >= castle-age)

=>
	(acknowledge-taunt this-any-ally 45)
	(set-goal HumanTactical YES)
	(set-goal UnitType UNI)
	(chat-to-allies "Entrenare la mayor cantidad de unidades del castillo que pueda")
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(taunt-detected any-ally 45)
	(building-type-count-total castle < 1)
	(current-age >= castle-age)

=>
	(acknowledge-taunt this-any-ally 45)
	(chat-to-allies "Lo siento señor no tengo castillo =(")
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(taunt-detected any-ally 46)
	(current-age >= castle-age)

=>
	(acknowledge-taunt this-any-ally 46)
	(set-goal HumanTactical YES)
	(set-goal UnitType INF)
	(chat-to-allies "¡Pronto vera mis legiones de infanteria!")
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(taunt-detected any-ally 47)
	(current-age >= castle-age)

=>
	(acknowledge-taunt this-any-ally 47)
	(set-goal HumanTactical YES)
	(set-goal UnitType ARQ)
	(chat-to-allies "Entrenare las unidades con alcanse que me parescan apropiadas señor.")
)

(defrule
	(unit-type-count villager >= 50)
	(not (goal UnitType DEFENSE))
	(taunt-detected any-ally 48)
	(current-age >= castle-age)

=>
	(acknowledge-taunt this-any-ally 48)
	(set-goal HumanTactical YES)
	(set-goal UnitType CAB)
	(chat-to-allies "Si, ME ENCANTA LA CABALLERIA ¡ESO ARE!")
)

(defrule
 (or
	(or
	(unit-type-count villager < 50)		(goal UnitType DEFENSE))
	(current-age >= feudal-age))
   (or
	(or
	(taunt-detected any-ally 45)	(taunt-detected any-ally 46))
	(taunt-detected any-ally 47))
=>
	(acknowledge-taunt this-any-ally 45)
	(acknowledge-taunt this-any-ally 46)
	(acknowledge-taunt this-any-ally 47)
	(chat-to-allies "Lo siento señor pero no puedo aseptar su solisitud en este momento")
)

(defrule
 (or
	(or
	(unit-type-count villager < 50)		(goal UnitType DEFENSE))
	(current-age >= feudal-age))
	(taunt-detected any-ally 48)
=>
	(acknowledge-taunt this-any-ally 48)
	(chat-to-allies "Lo siento señor pero no puedo aseptar su solisitud en este momento")
)

(defrule
	(goal watermap YES)
	(taunt-detected any-ally 34)

=>
	(acknowledge-taunt this-any-ally 34)
	(set-goal oceanmap YES)
	(set-goal watermap NO)
	(set-goal EnemyWarboats HUMAN)
	(chat-to-allies "Si señor, y mi buque insignia llevara su nombre ;)")
)

(defrule
	(goal watermap NO)
	(goal oceanmap YES)
	(taunt-detected any-ally 34)

=>
	(acknowledge-taunt this-any-ally 34)
	(chat-to-allies "Si almirante")
)

(defrule
	(goal watermap NO)
	(goal oceanmap NO)
	(taunt-detected any-ally 34)

=>
	(acknowledge-taunt this-any-ally 34)
	(chat-to-allies "Quizás no se dio cuenta pero ¡¡¡ESTE NO ES UN MAPA DE AGUA!!!  Señor.")
)

(defrule
	(goal oceanmap YES)
	(taunt-detected any-ally 35)

=>
	(acknowledge-taunt this-any-ally 35)
	(set-goal oceanmap NO)
	(set-goal watermap YES)
	(set-goal EnemyWarboats HUMAN)
	(set-strategic-number sn-percent-attack-soldiers 100)
	(chat-to-allies "Si señor, me gustan más las batallas en tierra")
)
(defrule
	(goal watermap YES)
	(goal oceanmap NO)
	(taunt-detected any-ally 35)

=>
	(acknowledge-taunt this-any-ally 35)
	(chat-to-allies "¡En eso estoy!")
)

(defrule
	(goal watermap NO)
	(goal oceanmap NO)
	(taunt-detected any-ally 35)

=>
	(acknowledge-taunt this-any-ally 35)
	(chat-to-allies "SI, eso es exactamente lo que iba a hacer.")
)

;*******************************Aliado!******

(defrule
	(true)
=>
	(set-goal Almirante NO)
	(disable-self)
)

(defrule
	(players-stance any-computer ally)
	(game-time > 50)

=>
	(chat-to-allies "/99")
	(disable-self)
)

(defrule
;	(players-stance any-computer ally)
	(taunt-detected any-ally 99)

=>
	(acknowledge-taunt this-any-ally 99)
	(chat-to-allies "Viva Egipto!!!")
	(set-goal Almirante NIVELN)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 100)
	(or
		(or
	(civ-selected aztec)	(civ-selected hun))
	(civ-selected briton))
=>
	(chat-to-allies "91")
	(set-goal Almirante NIVEL1)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 100)
	(or
		(or
	(civ-selected chinese)	(civ-selected gothic))
	(civ-selected teutonic))
=>
	(chat-to-allies "91")
	(set-goal Almirante NIVEL1)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 200)
	(or
		(or
	(civ-selected celtic)	(civ-selected frankish))
	(civ-selected mayan))
=>
	(chat-to-allies "92")
	(set-goal Almirante NIVEL2)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 300)
	(or
		(or
	(civ-selected korean)	(civ-selected spanish))
	(civ-selected mongol))
=>
	(chat-to-allies "93")
	(set-goal Almirante NIVEL3)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 300)
	(civ-selected turkish)
=>
	(chat-to-allies "93")
	(set-goal Almirante NIVEL3)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 400)
	(or
		(or
	(civ-selected byzantine)	(civ-selected japanese))
	(civ-selected viking))
=>
	(chat-to-allies "94")
	(set-goal Almirante NIVEL4)
	(disable-self)
)

(defrule
	(goal Almirante NIVELN)
	(game-time > 400)
	(or
	(civ-selected persian)	(civ-selected saracen))
=>
	(chat-to-allies "94")
	(set-goal Almirante NIVEL4)
	(disable-self)
)

(defrule
	(goal Almirante NIVEL1)
	(taunt-detected any-ally 92)
=>
	(acknowledge-taunt this-any-ally 92)
	(set-goal Almirante NO)
	(chat-to-allies "Listo")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL1)
	(taunt-detected any-ally 93)
=>
	(acknowledge-taunt this-any-ally 93)
	(set-goal Almirante NO)
	(chat-to-allies "Listo")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL1)
	(taunt-detected any-ally 94)
=>
	(acknowledge-taunt this-any-ally 94)
	(set-goal Almirante NO)
	(chat-to-allies "Listo")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL2)
	(taunt-detected any-ally 93)
=>
	(acknowledge-taunt this-any-ally 93)
	(set-goal Almirante NO)
	(chat-to-allies "Bueno")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL2)
	(taunt-detected any-ally 94)
=>
	(acknowledge-taunt this-any-ally 94)
	(set-goal Almirante NO)
	(chat-to-allies "Bueno")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL3)
	(taunt-detected any-ally 94)
=>
	(acknowledge-taunt this-any-ally 94)
	(set-goal Almirante NO)
	(chat-to-allies "OK")
	(disable-self)
)

(defrule
	(not (goal Almirante NO))
	(current-age-time > 1260)
	(current-age >= castle-age)
=>
	(chat-to-allies "95")
	(set-goal Almirante NIVEL5)
	(chat-local-to-self "¡¡¡¡¡¡¡¡¡ALMIRANTE!!!!!!!!!!")
	(disable-self)
)

(defrule
	(not (goal Almirante NO))
	(taunt-detected any-ally 95)
=>
	(acknowledge-taunt this-any-ally 95)
	(set-goal Almirante NO)
	(chat-to-allies "OK... almirante ^^")
	(disable-self)
)

(defrule
	(goal Almirante NIVEL5)
	(goal watermap YES)
	(not (goal Archipielago YES))
	(not (map-type mediterranean))
	(not (map-type baltic))
	(not (map-type highland))
	(not (map-type salt-marsh))
=>
	(set-goal Almirante NIVEL6)
	(disable-self)
)

(defrule
	(goal Almirante NIVEL5)
	(goal watermap YES)
	(or
	(map-type mediterranean)	(or (map-type baltic) (map-type salt-marsh)))
=>
	(set-goal oceanmap YES)
	(set-goal watermap NO)
	(disable-self)
)


(defrule
	(goal Almirante NO)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "no")
)
(defrule
	(goal Almirante NIVEL1)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "111111111111111111")
)
(defrule
	(goal Almirante NIVEL2)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "222222222222222222")
)
(defrule
	(goal Almirante NIVEL3)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "3333333333333333")
)
(defrule
	(goal Almirante NIVEL4)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "4444444444444444444444")
)
(defrule
	(goal Almirante NIVEL5)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "55555555555555555")
)
(defrule
	(goal Almirante NIVELN)
	(taunt-detected any-ally 50)
=>
	(acknowledge-taunt this-any-ally 50)
	(chat-to-allies "1 N!!!!!!!!!!!!!?!!!!!!!!!!!!!?")
)

(defrule
	(players-stance any-computer ally)
	(game-time > 500)

=>
	(chat-to-allies "50")
	(disable-self)
)


;********secondari unit

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(or
	(unit-available hand-cannoneer)	(civ-selected hun))
	(goal UnitType CAB)
=>
	(set-goal UnitType2 ARQ)
)

(defrule
	(soldier-count > 30)
	(civ-selected turkish)
	(not (goal UnitType UNI))
=>
	(set-goal UnitType2 UNI)
)

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(not (unit-available hand-cannoneer))
	(not (civ-selected hun))
	(goal UnitType CAB)
=>
	(set-goal UnitType2 UNI)
)

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(goal UnitType INF)
=>
	(set-goal UnitType2 ARQ)
)

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(or
	(unit-available hand-cannoneer)	(civ-selected hun))
	(goal UnitType UNI)
=>
	(set-goal UnitType2 ARQ)
)

(defrule
	(soldier-count > 30)
	(civ-selected turkish)
	(goal UnitType UNI)
=>
	(set-goal UnitType2 CAB)
)

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(not (unit-available hand-cannoneer))
	(not (civ-selected hun))
	(goal UnitType UNI)
=>
	(set-goal UnitType2 CAB)
)

(defrule
	(soldier-count > 30)
	(not (civ-selected turkish))
	(goal UnitType ARQ)
=>
	(set-goal UnitType2 UNI)
)


;Timers/*/*/*//**/*.

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal needRecourses YES)
	(soldier-count <= 50)
	(soldier-count >= 10)
	(current-age == castle-age)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 15)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 15)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 15)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 15)

)

(defrule
	(timer-triggered siegespeedTimer)
	(goal needRecourses YES)
	(soldier-count <= 50)
	(soldier-count >= 10)
	(current-age == castle-age)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 15)
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 10)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal needRecourses YES)
	(soldier-count > 50)
	(current-age == castle-age)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 10)
)

(defrule
	(timer-triggered MonkspeedTimer)
	(goal needRecourses YES)
	(soldier-count > 50)
	(unit-type-count monk <= 1)
	(current-age == castle-age)
=>
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 10)
)

(defrule
	(timer-triggered MonkspeedTimer)
	(goal needRecourses YES)
	(soldier-count > 50)
	(unit-type-count monk > 1)
	(current-age == castle-age)
=>
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 16)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal needRecourses YES)
	(goal UnitType CAB)
	(soldier-count > 50)
	(current-age == castle-age)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 20)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 15)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 20)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 20)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal needRecourses YES)
	(goal UnitType UNI)
	(soldier-count > 50)
	(current-age == castle-age)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 20)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 20)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 20)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 15)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal needRecourses YES)
	(goal UnitType INF)
	(soldier-count > 50)
	(current-age == castle-age)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 15)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 20)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 20)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 20)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal needRecourses YES)
	(goal UnitType ARQ)
	(soldier-count > 50)
	(current-age == castle-age)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 20)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 20)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 15)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 20)
)

;********Imperial*****

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime NO)
	(soldier-count > 10)
	(goal needRecourses YES)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 5)
	(disable-timer ShipsTimer)
	(enable-timer ShipsTimer 4)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal needRecourses YES)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 20)
	(disable-timer ShipsTimer)
	(enable-timer ShipsTimer 15)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal needRecourses YES)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 30)
	(disable-timer ShipsTimer)
	(enable-timer ShipsTimer 25)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal needRecourses YES)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 35)
	(disable-timer ShipsTimer)
	(enable-timer ShipsTimer 30)
)

(defrule
	(timer-triggered MonkspeedTimer)
	(goal needRecourses YES)
	(not (goal techstime NO))
	(soldier-count > 10)
	(unit-type-count monk <= 2)
	(not (goal UnitType DEFENSE))
	(current-age == imperial-age)
=>
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 10)
)

(defrule
	(timer-triggered MonkspeedTimer)
	(goal needRecourses YES)
	(not (civ-selected aztec))
	(not (goal techstime NO))
	(not (goal UnitType DEFENSE))
	(soldier-count > 10)
	(unit-type-count monk > 2)
	(current-age == imperial-age)
=>
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 50)
)

(defrule
	(timer-triggered MonkspeedTimer)
	(goal needRecourses YES)
	(civ-selected aztec)
	(not (goal techstime NO))
	(not (goal UnitType DEFENSE))
	(soldier-count > 10)
	(unit-type-count monk > 2)
	(current-age == imperial-age)
=>
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 35)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime NO)
	(current-age == imperial-age)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 10)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 10)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 10)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 10)
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 10)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 25)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 35)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 40)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 30)
	(soldier-count <= 50)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 30)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 45)
)
(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 60)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 25)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 35)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 40)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 30)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 45)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 60)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 25)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 35)
)


(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 40)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 30)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 45)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 60)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 25)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 35)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType UNI)
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 40)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType UNI))
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 30)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 45)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(not (goal UnitType UNI))
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 60)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 10)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 15)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 20)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 15)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 25)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(not (goal UnitType CAB))
	(not (goal UnitType2 CAB))
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 40)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 10)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 15)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 20)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 15)
)


(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 25)
)


(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(not (goal UnitType INF))
	(not (goal UnitType2 INF))
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 40)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 10)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 15)
)


(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 20)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 15)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 25)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(not (goal UnitType ARQ))
	(not (goal UnitType2 ARQ))
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 40)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 10)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 15)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 20)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(not (goal UnitType UNI))
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 15)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(not (goal UnitType UNI))
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 25)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(not (goal UnitType UNI))
	(not (goal UnitType2 UNI))
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 40)
)


(defrule
	(timer-triggered InfanteriaspeedTimer)
	(soldier-count > 10)
	(goal UnitType DEFENSE)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 10)
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 10)
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 10)
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 10)
	(disable-timer MonkspeedTimer)
	(enable-timer MonkspeedTimer 5)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime MANY)	
	(soldier-count > 10)
	(not (goal watermap YES))
	(not (goal oceanmap YES))
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 5)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime MANY)	
	(soldier-count > 10)
	(or
	(goal watermap YES)	(goal oceanmap YES))
	(unit-type-count-total trebuchet <= 2)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 5)
)

(defrule
	(timer-triggered siegespeedTimer)
	(goal techstime MANY)	
	(soldier-count > 10)
	(or
	(goal watermap YES)	(goal oceanmap YES))
	(unit-type-count-total trebuchet >= 2)
=>
	(disable-timer siegespeedTimer)
	(enable-timer siegespeedTimer 15)
)

(defrule
	(timer-triggered ShipsTimer)
	(goal techstime MANY)	
	(soldier-count > 10)
=>
	(disable-timer ShipsTimer)
	(enable-timer ShipsTimer 4)
)


;*************timers2****

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 27)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 37)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 45)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 27)

)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 37)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 45)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 27)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 37)
)


(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 45)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 27)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 37)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime SLOW)
	(soldier-count > 70)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 45)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 13)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 17)
)

(defrule
	(timer-triggered CaballeriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType2 CAB)
	(goal needRecourses YES)
=>
	(disable-timer CaballeriaspeedTimer)
	(enable-timer CaballeriaspeedTimer 25)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 13)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 17)
)

(defrule
	(timer-triggered InfanteriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType2 INF)
	(goal needRecourses YES)
=>
	(disable-timer InfanteriaspeedTimer)
	(enable-timer InfanteriaspeedTimer 25)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 13)
)

(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 17)
)


(defrule
	(timer-triggered ArqueriaspeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType2 ARQ)
	(goal needRecourses YES)
=>
	(disable-timer ArqueriaspeedTimer)
	(enable-timer ArqueriaspeedTimer 25)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 10)
	(soldier-count <= 50)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 13)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 50)
	(soldier-count <= 70)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 17)
)

(defrule
	(timer-triggered UniquespeedTimer)
	(goal techstime MANY)
	(soldier-count > 70)
	(goal UnitType2 UNI)
	(goal needRecourses YES)
=>
	(disable-timer UniquespeedTimer)
	(enable-timer UniquespeedTimer 25)
)

;//////////////////some TACTICAL information///////

(defrule
	(true)
=>
	(set-goal EnemyCab NO)
	(set-goal EnemyInf NO)
	(disable-self)
)

(defrule
	(goal EnemyCab NO)
	(civ-selected saracen)
	(or
		(cc-players-unit-type-count any-enemy mountedmelee > 30)
		(cc-players-unit-type-count any-enemy scout-cavalry-line > 30))
=>
	(set-goal EnemyCab YES)
)

(defrule
	(goal EnemyCab NO)
	(not (civ-selected saracen))
	(or
		(cc-players-unit-type-count any-enemy mountedmelee > 15)
		(cc-players-unit-type-count any-enemy scout-cavalry-line > 20))
=>
	(set-goal EnemyCab YES)
)

(defrule
	(goal EnemyCab YES)
	(cc-players-unit-type-count any-enemy mountedmelee < 2)
	(cc-players-unit-type-count any-enemy scout-cavalry-line < 3)
=>
	(set-goal EnemyCab NO)
)

(defrule
	(goal EnemyInf NO)
	(cc-players-unit-type-count any-enemy footmelee > 40)
=>
	(set-goal EnemyInf YES)
)

(defrule
	(goal EnemyInf YES)
	(cc-players-unit-type-count any-enemy footmelee < 5)
=>
	(set-goal EnemyInf NO)
)

(defrule
	(goal oceanmap YES)
	(unit-type-count warships < 20)
=>
	(set-difficulty-parameter ability-to-dodge-missiles 0)
	(set-difficulty-parameter ability-to-maintain-distance 0)
)

(defrule
	(goal oceanmap YES)
	(unit-type-count warships >= 20)
=>
	(set-difficulty-parameter ability-to-dodge-missiles 100)
	(set-difficulty-parameter ability-to-maintain-distance 100)
)

(defrule
	(not (goal oceanmap YES))
	(unit-type-count footranged < 20)
	(unit-type-count hand-cannoneer < 10)
	(unit-type-count mountedranged < 15)
=>
	(set-difficulty-parameter ability-to-dodge-missiles 0)
	(set-difficulty-parameter ability-to-maintain-distance 0)
)

(defrule
	(not (goal oceanmap YES))
	(or
		(or
	(unit-type-count footranged >= 20)	(unit-type-count mountedranged >= 15))
	(unit-type-count hand-cannoneer >= 10))
=>
	(set-difficulty-parameter ability-to-dodge-missiles 100)
	(set-difficulty-parameter ability-to-maintain-distance 100)
)

(defrule
	(unit-type-count footranged < 15)
	(unit-type-count hand-cannoneer < 10)
	(unit-type-count mountedranged < 10)
=>
      	(set-strategic-number sn-target-evaluation-boat -1)
)

(defrule
	(or
		(or
	(unit-type-count footranged >= 15)	(unit-type-count mountedranged >= 10))
	(unit-type-count hand-cannoneer >= 10))
=>
      	(set-strategic-number sn-target-evaluation-boat 100)
)

;tactical attacks Type

(defrule
	(true)
=>
	;(set-strategic-number sn-special-attack-influence2 20000)
	(set-strategic-number sn-special-attack-influence1 10000)
	(disable-self)
)

(defrule
	(not (goal Wonderr ENEMYW))
	(current-age == castle-age)
	(cc-players-unit-type-count any-enemy trade-cart <= 15)
	(not (town-under-attack))
	(unit-type-count-total battering-ram-line > 1)
=>
	(set-strategic-number sn-special-attack-type2 town-center)
)

(defrule
	(not (goal Wonderr ENEMYW))
=>
	(set-strategic-number sn-special-attack-type1 1)
	(disable-self)
)


(defrule
	(not (goal Wonderr ENEMYW))
	(current-age == imperial-age)
	(not (civ-selected persian))
	(cc-players-unit-type-count any-enemy trade-cart <= 15)
	(not (town-under-attack))
	(unit-type-count-total battering-ram-line > 3)
	(unit-type-count-total trebuchet >= 3)
=>
	(set-strategic-number sn-special-attack-type2 castle)
)

;(defrule
;	(current-age == imperial-age)
;	(not (town-under-attack))
;	(cc-players-building-type-count any-enemy stone-wall-line > 100)
;	(cc-players-unit-type-count any-enemy trade-cart <= 15)
;	(unit-type-count-total battering-ram-line > 3)
;	(unit-type-count-total trebuchet < 3)
;=>
;	(set-strategic-number sn-special-attack-type2 gate)
;)

(defrule
	(not (goal Wonderr ENEMYW))
	(current-age == imperial-age)
	(not (town-under-attack))
	(cc-players-unit-type-count any-enemy trade-cart <= 15)
	(unit-type-count-total battering-ram-line < 3)
	(unit-type-count-total trebuchet < 3)
=>
	(set-strategic-number sn-special-attack-type2 town-center)
)

(defrule
	(not (goal Wonderr ENEMYW))
	(current-age == imperial-age)
	(not (town-under-attack))
	(cc-players-unit-type-count any-enemy trade-cart > 15)
=>
	(set-strategic-number sn-special-attack-type2 market)
	(up-set-offense-priority c: market c: 11)
)

(defrule
	(not (goal Wonderr ENEMYW))
	(town-under-attack)
	(cc-players-unit-type-count any-enemy trebuchet >= 1)
=>
	(set-strategic-number sn-special-attack-type2 trebuchet)
)

;(defrule
;	(not (goal Wonderr ENEMYW))
;	(town-under-attack)
;	(cc-players-unit-type-count any-enemy trebuchet >= 1)
;=>
;	(set-strategic-number sn-special-attack-type2 954)
;)


(defrule
	(goal Wonderr ENEMYW)

	(current-age >= castle-age)
=>
	(set-strategic-number sn-special-attack-type1 0)
	(set-strategic-number sn-special-attack-type3 1)
	(set-strategic-number sn-special-attack-type2 0)
	(up-set-offense-priority c: wonder c: 11)
	(up-set-offense-priority c: market c: 8)
	;(set-strategic-number sn-special-attack-influence3 10000)
)

(defrule
	(goal Wonderr RELIK)
	(not (town-under-attack))
	(current-age >= castle-age)
=>
	(set-strategic-number sn-special-attack-type1 1)
	(up-set-offense-priority c: monastery c: 11)
	(set-strategic-number sn-special-attack-influence1 30000)
)

;some TARGETING PRIORITIES
(defrule
	(true)
=>
	(set-strategic-number sn-enable-offensive-priority 1)
	(up-set-offense-priority c: gate-class c: 2)
	(up-set-offense-priority c: stone-wall-line c: 0)
	(up-set-offense-priority c: palisade-wall c: 2)
	(up-set-offense-priority c: demolition-ship c: 11)
	(up-set-offense-priority c: transport-ship c: 7)
	(up-set-offense-priority c: house c: -1) ;no more attacking random houses and farms when other priorities exist
	(up-set-offense-priority c: farm c: -1)
	(up-set-defense-priority c: stone-wall-line c: 1)
	(up-set-defense-priority c: palisade-wall c: 3000)
	(up-set-defense-priority c: castle c: 10)
	;(set-strategic-number sn-disable-trade-evasion 0) ;0:1 default: 0
	(set-strategic-number sn-disable-builder-assistance 1)
	(set-strategic-number sn-gather-defense-units 1)
	(set-strategic-number sn-wall-targeting-mode 1) ;1 = on, 0 = off
	;(set-strategic-number sn-disable-villager-garrison 0) ;THIS STOPS VILLAGERS FROM DEFENSIVE GARRISONING
	(disable-self)
)

(defrule
	(true)
=>
	(up-set-offense-priority c: king-class c: 11)
	(up-set-offense-priority c: town-center-foundation c: 11)
	(up-set-offense-priority c: town-center c: 8)
	(up-set-defense-priority c: town-center-foundation c: 10000)
	(up-set-offense-priority c: market c: 9)
	(up-set-offense-priority c: battering-ram-line c: 7)
	(up-set-offense-priority c: armored-elephant-line c: 7)
	(up-set-offense-priority c: trebuchet c: 7) ;doesn't include packed-trebuchet
	(up-set-offense-priority c: unpacked-trebuchet-class c: 11)
	(up-set-offense-priority c: packed-trebuchet-class c: 11)
	(up-set-offense-priority c: castle c: 10)
	(disable-self)
)

(defrule
	(current-age <= feudal-age)
=>
	(up-set-offense-priority c: villager c: 7)
	(disable-self)
)

(defrule
	(current-age > feudal-age)
=>
	(up-set-offense-priority c: villager c: 1)
	(disable-self)
)

(defrule
	(civ-selected persian)
=>
	(up-set-offense-priority c: monk c: 11)
	(up-set-offense-priority c: missionary c: 11)
	(disable-self)
)

(defrule
	(not (civ-selected persian))
=>
	(up-set-offense-priority c: monk c: 7)
	(up-set-offense-priority c: missionary c: 7)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(goal ATTACK YES)
=>
	(set-strategic-number sn-garrison-rams 1)
)

(defrule
	(current-age >= castle-age)
	(goal ATTACK NO)
=>
	(set-strategic-number sn-garrison-rams 0)
)

;*********************************Tactical attack target***

(defrule
	(true)

=>
	(set-goal HumanAttacks NO)
	(disable-self)
)


(defrule
	(not (map-type oasis))
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(current-age >= castle-age)
	(soldier-count < 80)
	(goal ATTACK NO)
	(goal oceanmap NO)
	(not (goal HumanAttacks YES))

=>
	(set-strategic-number sn-attack-winning-player 0)
	(set-strategic-number sn-attack-winning-player-factor 1)  ;25
	(set-strategic-number sn-target-evaluation-distance 1)	
)

(defrule
	(not (map-type oasis))
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(current-age >= castle-age)
	(soldier-count > 80)
	(goal ATTACK NO)
	(goal oceanmap NO)
	(not (goal HumanAttacks YES))

=>
	(set-strategic-number sn-attack-winning-player 1)
	(set-strategic-number sn-attack-winning-player-factor 25)  ;1
	(set-strategic-number sn-target-evaluation-distance 20)
)

(defrule
	(current-age >= castle-age)
	(goal oceanmap YES)
	(not (goal HumanAttacks YES))

=>
	(set-strategic-number sn-attack-winning-player 1)
	(set-strategic-number sn-attack-winning-player-factor 25)  ;1
	(set-strategic-number sn-target-evaluation-distance 20)
)


(defrule				
	(taunt-detected any-ally 43)
=>
	(acknowledge-taunt this-any-ally 43)
	(chat-to-allies "El jugador de mas puntaje poronto se arrodilliara a mis pies.")
	(chat-to-allies "39")
	(set-goal HumanAttacks YES)
	(set-strategic-number sn-attack-winning-player 1)
	(set-strategic-number sn-attack-winning-player-factor 25)
	(set-strategic-number sn-target-evaluation-distance 20)
	(chat-local-to-self "Human Tactis...1")
)

(defrule				
	(taunt-detected any-ally 44)
=>
	(acknowledge-taunt this-any-ally 44)
	(chat-to-allies "Enseguida señor, atacare de forma aleatoria al enemigo.")
	(chat-to-allies "39")
	(set-goal HumanAttacks YES)
	(set-strategic-number sn-attack-winning-player 0)
	(set-strategic-number sn-attack-winning-player-factor 1)
	(set-strategic-number sn-target-evaluation-distance 1)
	(chat-local-to-self "Human Tactis...2")
)

(defrule				
	(taunt-detected any-ally 143)
	(not (goal HumanAttacks YES))
	(current-age >= castle-age)
	(soldier-count > 60)
	(goal ATTACK YES)
	(not (goal HumanAttacks YES))
=>
	(acknowledge-taunt this-any-ally 143)
	(set-strategic-number sn-attack-winning-player 1)
	(set-strategic-number sn-attack-winning-player-factor 25)
	(set-strategic-number sn-target-evaluation-distance 20)
	(chat-local-to-self "Atacar al jugador de mas puntaje!!!")
)

(defrule				
	(taunt-detected any-ally 143)
	(not (goal HumanAttacks YES))
	(current-age >= castle-age)
	(or
	(soldier-count < 60)	(goal ATTACK NO))
	(not (goal HumanAttacks YES))
=>
	(acknowledge-taunt this-any-ally 143)
	(chat-local-to-self "No hay cambios!!! :(")
)

;*****************************Game type*************:
(defrule
	(true)
=>
	(set-goal Wonderr NADA)
	(chat-local-to-self "conquista?")
	(disable-self)
)

#load-if-not-defined VICTORY-CONQUEST
(defrule
	(goal Wonderr NADA)
	(game-time > 1)
=>
	(set-goal Wonderr POSIBLE)
	(chat-local-to-self "No es conquista...")
	(disable-self)
)
#end-if

(defrule
	(goal Wonderr POSIBLE)
	(cc-players-building-type-count any-enemy wonder > 0)
=>
	(set-goal Wonderr ENEMYW)
	(chat-local-to-self "EL ENEMIGO TIENE UNA MARAVILLA!!!")
)

(defrule
	(goal Wonderr ENEMYW)
	(cc-players-building-type-count every-enemy wonder == 0)
=>
	(set-goal Wonderr POSIBLE)
	(chat-local-to-self "Enemigo sin maravilla")
)

(defrule
	(goal Wonderr POSIBLE)
	(building-type-count  wonder >= 1)
=>
	(set-goal Wonderr MYW)
	(up-set-defense-priority c: wonder c: 3000)
	(chat-local-to-self "tenemos la maravilla :)")
)


(defrule
	(goal Wonderr MYW)
	(building-type-count  wonder <= 0)
=>
	(set-goal Wonderr POSIBLE)
	(chat-local-to-self "Perdimos la maravilla :(")
)

(defrule
	(goal Wonderr POSIBLE)
	(enemy-captured-relics)
	(cc-players-building-type-count any-enemy wonder <= 0)
=>
	(set-goal Wonderr RELIK)
	(chat-local-to-self "Nos garkaron las relikias")
)

(defrule
	(goal Wonderr RELIK)
	(not (enemy-captured-relics))
=>
	(set-goal Wonderr POSIBLE)
	(chat-local-to-self "kbn las relikias")
)

(defrule
	(goal Wonderr POSIBLE)
	(cc-players-building-type-count any-ally wonder >= 1)
=>
	(set-goal Wonderr ALLYW)
	(chat-local-to-self "EL ALIADO TIENE UNA MARAVILLA!!!")
)

(defrule
	(goal Wonderr ALLYW)
	(cc-players-building-type-count every-ally wonder == 0)
=>
	(set-goal Wonderr POSIBLE)
	(chat-local-to-self "EL ALIADO ES UN PELOTUDO!!!")
)

#load-if-not-defined KING-OF-THE-HILL
(defrule
	(goal dificultad masQueModerado)
	(not (difficulty == hard))
	(goal Wonderr ENEMYW)
	;(cc-players-building-type-count any-enemy wonder > 0)
	(game-time > 5400)
=>
	(cc-add-resource wood 500)
	(cc-add-resource food 500)
	(cc-add-resource gold 500)
	(cc-add-resource stone 500)
	(disable-self)
)

(defrule
	(goal Wonderr MYW)
	(building-type-count  wonder > 0)
=>
	(set-goal EnabledAttack NO)
	(disable-self)
)


(defrule
	(goal Wonderr ALLYW)
	(game-time > 60)
	(cc-players-building-type-count any-ally wonder > 0)
=>
	(set-strategic-number sn-target-evaluation-ally-proximity 100000)
	(disable-self)
)
#end-if

#load-if-defined DEFEND-WONDER

(defrule
	(goal dificultad masQueModerado)
	(not (difficulty == hard))
	;(goal Wonderr ENEMYW)
	(cc-players-building-type-count any-enemy wonder > 0)
	(game-time > 2)
=>
	(cc-add-resource wood 5000)
	(cc-add-resource food 5000)
	(cc-add-resource gold 5000)
	(cc-add-resource stone 5000)
	(disable-self)
)

(defrule
	(difficulty == hard)
	;(goal Wonderr ENEMYW)
	(cc-players-building-type-count any-enemy wonder > 0)
	(game-time > 2)
=>
	(cc-add-resource wood 1000)
	(cc-add-resource food 1000)
	(cc-add-resource gold 1000)
	(cc-add-resource stone 1000)
	(disable-self)
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(game-time > 900)
	(soldier-count > 50)
	(building-type-count  castle > 1)
	(building-type-count  wonder < 0)
=>
	(set-strategic-number sn-maximum-town-size 70)
	(disable-self)
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(game-time > 1000)
	(soldier-count > 10)
	(or
	(unit-type-count trebuchet > 0)	(unit-type-count-total battering-ram-line > 1))
	(goal ATTACK NO)
	(building-type-count  wonder < 0)
=>
	(attack-now)
)

#end-if

;///////////////////////////////REY DE LA COLINA!///////////////////////////////////////////////////
#load-if-defined KING-OF-THE-HILL

(defrule
	(soldier-count > 1)
	(game-time > 600)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 1)
	(chat-local-to-self "HORA DE TOMAR LA COLINA!!!")
	(disable-self)
)

(defrule
	(soldier-count < 5)
	(game-time > 900)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 0)
	(disable-self)
)

(defrule
	(hold-koh-ruin)
	(soldier-count > 10)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 1)
)

(defrule
	(not (hold-koh-ruin))
	(soldier-count > 50)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 1)
)

(defrule
	(goal oceanmap YES)
	(not (hold-koh-ruin))
	(unit-type-count  warships > 10)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 1)
)

(defrule
	(game-time > 900)
	(soldier-count < 10)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 0)
)

(defrule
	(not (goal oceanmap YES))
	(not (hold-koh-ruin))
	(game-time > 900)
	(soldier-count < 20)
=>
	(set-strategic-number sn-gather-idle-soldiers-at-center 0)
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(game-time > 1860)
	(current-age >= castle-age)
	(soldier-count > 65)
	(building-type-count  castle > 2)
	(building-type-count  town-center > 1)
=>
	(set-strategic-number sn-maximum-town-size 70)
	(disable-self)
)

(defrule
	(current-age >= castle-age)
	(building-type-count  castle < 2)
	(strategic-number sn-maximum-town-size == 70)
=>
	(set-strategic-number sn-maximum-town-size 25)
	(disable-self)
)

(defrule
	(goal dificultad menosQueHard)
	(current-age >= castle-age)
	(strategic-number sn-maximum-town-size == 70)
	(building-type-count  castle <= 20)
=>
	(build-forward castle)
	;(chat-local-to-self "CASTILLO de la colina.")
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(current-age >= castle-age)
	(strategic-number sn-maximum-town-size == 70)
	(building-type-count  watch-tower-line <= 12)
=>
	(build-forward watch-tower-line)
)

(defrule
	(difficulty != easy)
	(difficulty != easiest)
	(difficulty != moderate)
	(current-age >= castle-age)
	(strategic-number sn-maximum-town-size == 70)
	(building-type-count  bombard-tower <= 15)
=>
	(build-forward bombard-tower)
)

(defrule
	(game-time > 2500)
=>
	(set-goal EnabledAttack NO)
	(chat-local-to-self "Tomemos la colina y fuee!!!")
	(disable-self)
)

#end-if
; /////////////////////////////////////////////////////
;UNIT UPGRADES        MEJORAS \ TEGNOLOGIAS

(defrule
	(goal AllowMilitaryTechs 2)
	(can-research-with-escrow my-unique-unit-upgrade)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research my-unique-unit-upgrade)
	(chat-local-to-self "research elite uniques")
)

(defrule
	(or
	(goal oceanmap YES)	(goal watermap YES))
	(goal 16 0)
	(unit-type-count my-unique-unit > 15)
	(can-research-with-escrow my-unique-unit-upgrade)
	(research-completed ri-chemistry)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research my-unique-unit-upgrade)
	(chat-local-to-self "research elite uniques")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(or
 	(current-age >= castle-age)	(and
		 (goal feudalWars YES) (not (goal Estrategia Eco)) )
	)
	(can-research-with-escrow ri-man-at-arms)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-man-at-arms)
	(chat-local-to-self "research man-at-arms")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-long-swordsman)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      (research ri-long-swordsman)
	(chat-local-to-self "research long swordsman ")
)

(defrule
	(goal 16 0)
	(unit-type-count long-swordsman > 4)
	(can-research-with-escrow ri-two-handed-swordsman)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      (research ri-two-handed-swordsman)
	(chat-local-to-self "research two-handed-swordsman")
)

#load-if-defined ROMANS-CIV
(defrule
	(goal 16 0)
	(unit-type-count two-handed-swordsman > 9)
	(can-research-with-escrow ri-legionary)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-legionary)
	(chat-local-to-self "research legionary")
)
#end-if

(defrule
	(goal 16 0)
	(unit-type-count two-handed-swordsman > 10)
	(can-research-with-escrow ri-champion)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-champion)
	(chat-local-to-self "research champion")
)

(defrule
	(goal 16 0)
	(unit-type-count-total spearman > 5)
	(can-research-with-escrow ri-pikeman)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      (research ri-pikeman)
	(chat-local-to-self "research pike")
)

(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(can-research-with-escrow ri-pikeman)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      (research ri-pikeman)
	(chat-local-to-self "research pike")
)

(defrule
	(goal 16 0)
	(unit-type-count-total pikeman > 15)
	(can-research-with-escrow ri-halberdier)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      (research ri-halberdier)
	(chat-local-to-self "research halberdier")
)


(defrule
	(goal 16 0)
	(unit-type-count-total scout-cavalry > 3)
	(can-research-with-escrow ri-light-cavalry)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-light-cavalry)
	(chat-local-to-self "research light-cavalry")
)

(defrule
	(goal 16 0)
	(unit-type-count-total scout-cavalry-line > 4)
	(can-research-with-escrow ri-hussar)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-hussar)
	(chat-local-to-self "research hussar")
)

#load-if-defined LITHUANIANS-CIV
(defrule
	(goal 16 0)
	(unit-type-count-total scout-cavalry-line > 4)
	(can-research-with-escrow ri-winged-hussar)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-winged-hussar)
	(chat-local-to-self "research winged hussar")
)
#end-if

#load-if-defined POLES-CIV
(defrule
	(goal 16 0)
	(unit-type-count-total scout-cavalry-line > 4)
	(can-research-with-escrow ri-winged-hussar)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-winged-hussar)
	(chat-local-to-self "research winged hussar")
)
#end-if

(defrule
	(goal 16 0)
	(unit-type-count-total camel > 5)
	(can-research-with-escrow ri-heavy-camel)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-heavy-camel)
	(chat-local-to-self "research heavy camel")
)

(defrule
	(goal 16 0)
	(unit-type-count-total camel > 9)
	(can-research-with-escrow ri-imperial-camel)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-imperial-camel)
	(chat-local-to-self "research imperial camel")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-cavalier)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-cavalier)
	(chat-local-to-self "research cavalier")
)


(defrule
	(goal AllowMilitaryTechs 1)
      	(unit-type-count-total cavalier > 0)
	(can-research-with-escrow ri-paladin)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-paladin)
	(chat-local-to-self "research paladin")
)

(defrule
	(goal AllowMilitaryTechs 1)
      	(unit-type-count-total battle-elephant-line > 2)
	(can-research-with-escrow ri-elite-battle-elephant)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-battle-elephant)
	(chat-local-to-self "research elite battle elephant")
)

(defrule
	(goal AllowMilitaryTechs 1)
      (unit-type-count-total eagle-warrior-line >= 2)
	(can-research-with-escrow ri-eagle-warrior)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
        (research ri-eagle-warrior)

	(chat-local-to-self "research DE eagle warrior")
)

(defrule
	(goal AllowMilitaryTechs 1)
      (unit-type-count-total eagle-warrior-line >= 5)
	(can-research-with-escrow ri-elite-eagle-warrior)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-elite-eagle-warrior)
	(chat-local-to-self "research elite eagle warrior")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(unit-type-count archer > 3)
	(can-research-with-escrow ri-crossbow)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-crossbow)
	(chat-local-to-self "research crossbow")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(not (research-available ri-cavalier))
	(not (can-research ri-elite-eagle-warrior))
	(unit-type-count crossbowman > 6)
	(can-research-with-escrow ri-arbalest)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-arbalest)
	(chat-local-to-self "research arbalest")
)

(defrule
	(goal 16 0)
	(unit-type-count cavalry-archer > 5)
	(can-research-with-escrow ri-heavy-cavalry-archer)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-heavy-cavalry-archer)
	(chat-local-to-self "research heavy-cavalry-archer")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(goal UnitType ARQ)
	(unit-type-count cavalry-archer > 0)
	(can-research-with-escrow ri-heavy-cavalry-archer)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-heavy-cavalry-archer)
	(chat-local-to-self "research heavy-cavalry-archer")
)

(defrule
	(goal 16 0)
	(unit-type-count elephant-archer > 5)
	(can-research-with-escrow ri-elite-elephant-archer)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-elephant-archer)
	(chat-local-to-self "research ri-elite-elephant-archer")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(goal UnitType ARQ)
	(unit-type-count elephant-archer > 0)
	(can-research-with-escrow ri-heavy-cavalry-archer)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-elephant-archer)
	(chat-local-to-self "ri-elite-elephant-archer")
)

(defrule
	(unit-type-count-total skirmisher > 5)
	(can-research-with-escrow ri-elite-skirmisher)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-skirmisher)
	(chat-local-to-self "research elite skirmisher")
)

(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(can-research-with-escrow ri-elite-skirmisher)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-skirmisher)
	(chat-local-to-self "research elite skirmisher")
)

(defrule
	(goal 16 0)
	(unit-type-count-total skirmisher > 9)
	(can-research-with-escrow ri-imperial-skirmisher)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-imperial-skirmisher)
	(chat-local-to-self "research imperial skirmisher")
)

(defrule
	(goal 16 0)
	(unit-type-count scorpion > 0)
	(can-research-with-escrow ri-heavy-scorpion)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-heavy-scorpion)
	(chat-local-to-self "research heavy-scorpion")
)

(defrule
	(goal 16 0)
      	(unit-type-count battering-ram > 0)
	(can-research-with-escrow ri-capped-ram)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-capped-ram)
	(chat-local-to-self "research capped ram")
)

(defrule
	(goal 16 0)
      	(unit-type-count capped-ram >= 2)
	(can-research-with-escrow ri-siege-ram)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-siege-ram)
	(chat-local-to-self "research siege-ram")
)

(defrule
	(goal 16 0)
      	(unit-type-count armored-elephant >= 2)
	(can-research-with-escrow ri-elite-armored-elephant)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-armored-elephant)
	(chat-local-to-self "research elite armored elephant")
)

(defrule
	(goal 16 0)
	(unit-type-count mangonel >= 1)
	(can-research-with-escrow ri-onager)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-onager)
	(chat-local-to-self "research onager")
)

(defrule
	(goal 16 0)
      	(unit-type-count onager > 6)
	(can-research-with-escrow ri-siege-onager)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-siege-onager)
	(chat-local-to-self "research siege onager")
)

;DOCK UNITS
(defrule
	(goal AllowMilitaryTechs 1)
	(unit-type-count galley > 0)
	(can-research-with-escrow ri-war-galley)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-war-galley)
	(chat-local-to-self "research war-galley")
)

(defrule
	(goal 16 0)
	(unit-type-count war-galley >= 3)
	(can-research-with-escrow ri-galleon)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    (research ri-galleon)
	(chat-local-to-self "research galleon")
)

(defrule
	(goal AllowboatTechs 4)
	(can-research ri-elite-longboat)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-elite-longboat)
)

(defrule
	(goal 16 0)
	(unit-type-count-total longboat-line >= 5)
	(can-research ri-elite-longboat)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-elite-longboat)
)

(defrule
	(goal AllowboatTechs 4)
	(can-research ri-elite-caravel)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-elite-caravel)
)

(defrule
	(goal 16 0)
	(unit-type-count-total caravel-line >= 5)
	(can-research ri-elite-caravel)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-elite-caravel)
)

(defrule
	(goal AllowboatTechs 2)
	(can-research-with-escrow ri-cannon-galleon)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-cannon-galleon)
	(chat-local-to-self "research cannon-galleon")
)

(defrule
	(goal 16 0)
	(wood-amount > 600)
	(unit-type-count-total warships > 10)
	(can-research-with-escrow ri-cannon-galleon)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
      	(research ri-cannon-galleon)
	(chat-local-to-self "research cannon-galleon")
)

(defrule
	(goal AllowboatTechs 1)
	(unit-type-count-total fire-ship > 0)
	(can-research-with-escrow ri-fast-fire-ship)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-fast-fire-ship)
	(chat-local-to-self "research fast-fire-ship")
)

(defrule
	(goal 16 0)
	(unit-type-count demolition-ship > 1)
	(can-research-with-escrow ri-heavy-demolition-ship)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-heavy-demolition-ship)
	(chat-local-to-self "research heavy-demolition-ship")
)

(defrule
	(goal 16 0)
	(unit-type-count turtle-ship-line > 1)
	(can-research-with-escrow ri-elite-turtle-ship)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-elite-turtle-ship)
	(chat-local-to-self "ri-elite-turtle-ship")
)

; ////////////////////////WEAPONS//////////////////

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-forging)
	(current-age >= castle-age)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
     (research ri-forging)
	(chat-local-to-self "research forging")
)

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-iron-casting)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-iron-casting)
	(chat-local-to-self "research iron-casting")
)

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-blast-furnace)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-blast-furnace)
	(chat-local-to-self "research blast-furnace")
)

;ARCHER UPGRADES -- cost food/gold
(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-fletching)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-fletching)
	(chat-local-to-self "research fletching")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-bodkin-arrow)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-bodkin-arrow)
	(chat-local-to-self "research bodkin-arrow")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-bracer)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-bracer)
	(chat-local-to-self "research bracer")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total hand-cannoneer > 3)
		(or
			(unit-type-count-total footranged > 3)
			(unit-type-count-total mountedranged > 3)
		)
	)
	(can-research-with-escrow ri-padded-archer-armor)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-padded-archer-armor)
	(chat-local-to-self "research padded-archer-armor")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total hand-cannoneer > 5)
		(or
			(unit-type-count-total footranged >= 5)
			(unit-type-count-total mountedranged >= 5)
		)
	)
	(can-research-with-escrow ri-leather-archer-armor)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-leather-archer-armor)
	(chat-local-to-self "research leather-archer-armor")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total hand-cannoneer > 10)
		(or
			(unit-type-count-total footranged >= 5)
			(unit-type-count-total mountedranged >= 5)
		)
	)
	(can-research-with-escrow ri-ring-archer-armor)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-ring-archer-armor)
	(chat-local-to-self "research ring-archer-armor")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total footmelee > 5)
		(unit-type-count-total spearman-line > 3)
	)
	(current-age >= castle-age)
	(can-research-with-escrow ri-scale-mail)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-scale-mail)
	(chat-local-to-self "research scale-mail")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total footmelee > 5)
		(unit-type-count-total spearman-line > 3)
	)
	(can-research-with-escrow ri-chain-mail)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-chain-mail)
	(chat-local-to-self "research chain-mail")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total footmelee > 5)
		(unit-type-count-total spearman-line > 3)
	)
	(can-research-with-escrow ri-plate-mail)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-plate-mail)
	(chat-local-to-self "research plate-mail")
)


(defrule
	(goal 16 0)
	(or
		(unit-type-count-total footmelee > 5)
		(unit-type-count-total spearman-line > 5)
	)
	(not (research-available ri-squires))
	(can-research-with-escrow ri-tracking)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-tracking)
	(chat-local-to-self "research tracking")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total footmelee >= 5)
		(unit-type-count-total spearman-line >= 5)
	)
	(can-research-with-escrow ri-squires)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-squires)
	(chat-local-to-self "research squires")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(or
 	(current-age >= castle-age)	(and
		 (goal feudalWars YES) (not (goal Estrategia Eco)) )
	)
	(can-research-with-escrow ri-supplies)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-supplies)
	(chat-local-to-self "research supplies")
)

(defrule
	(goal 16 0)
		(unit-type-count-total militiaman-line > 8)
	(can-research-with-escrow ri-gambesons)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-gambesons)
	(chat-local-to-self "research gambesons")
)

(defrule
	(goal 16 0)
		(unit-type-count-total militiaman-line > 8)
	(can-research-with-escrow ri-arson)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-arson)
	(chat-local-to-self "research arson")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total knight-line > 3)
		;(unit-type-count-total war-elephant-line > 3)
		(unit-type-count-total camel-line > 3)
	)
	(can-research-with-escrow ri-scale-barding)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-scale-barding)
	(chat-local-to-self "research scale-barding")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total mountedmelee > 3)
		;(unit-type-count-total war-elephant-line > 3)
		(unit-type-count-total camel-line > 3)
	)
	(can-research-with-escrow ri-chain-barding)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-chain-barding)
	(chat-local-to-self "research chain-barding")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total mountedmelee > 3)
		;(unit-type-count-total war-elephant-line > 3)
		(unit-type-count-total camel-line > 3)
	)
	(can-research-with-escrow ri-plate-barding)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-plate-barding)
	(chat-local-to-self "research plate-barding")
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total mountedmelee > 5)
		;(unit-type-count-total war-elephant-line > 3)
		(unit-type-count-total camel-line > 5)
	)
	(can-research-with-escrow ri-husbandry)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-husbandry)
	(chat-local-to-self "research husbandry")
)

(defrule
	(goal 16 0)
	(unit-type-count mountedranged > 3) ;cavalry-archer-line
	(can-research ri-parthian-tactics)
=>
	(research ri-parthian-tactics)
	(disable-self)
)

(defrule
	(goal 16 0)
	(or
		(unit-type-count-total hand-cannoneer > 10)
		(or
			(unit-type-count-total footranged >= 5)
			(unit-type-count-total mountedranged >= 5)
		)
	)
	(can-research ri-thumb-ring)
=>
	(research ri-thumb-ring)
	(disable-self)
)


(defrule
	(goal AllowMilitaryTechs 1)
	(or	(unit-type-count camel-line > 3)
		(or	(unit-type-count mountedmelee > 3)
			(unit-type-count war-elephant-line > 3)
		)
	)
	(can-research ri-bloodlines)
=>
	(research ri-bloodlines)
	(disable-self)
)
; /////////////////////SIEGE RESEARCH ITEMS///////////////////////////

(defrule
	(goal 16 0)
	(and
	(unit-type-count trebuchet >= 0)
        (wood-amount > 700)
	)
	(can-research-with-escrow ri-siege-engineers)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-siege-engineers)
	(chat-local-to-self "research siege-engineers")
)

;FORTRESS UPGRADES
(defrule
	(goal 16 0)
	(can-research-with-escrow ri-hoardings)
        (wood-amount > 500)
        (food-amount > 500)
	
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-hoardings)
	(chat-local-to-self "research hoardings")
)

;SHIPS

(defrule
	(goal 16 0)
	(unit-type-count fishing-ship > 2)
	(can-research ri-gillnets)
        (wood-amount > 500)
	(food-amount > 300)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-gillnets)
	(chat-local-to-self "research gillnets")
)

(defrule
	(goal AllowboatTechs 2)
	(can-research-with-escrow ri-deck-guns)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-deck-guns)
	(chat-local-to-self "research deck guns ")
)

(defrule
	(goal AllowboatTechs 2)
	(can-research-with-escrow 376)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research  376)
	(chat-local-to-self "research deck guns ")
)

(defrule
	(goal 16 0)
	(unit-type-count-total warships > 10)
	(unit-type-count-total cannon-galleon-line >= 1)
	(can-research-with-escrow 376)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research  376)
	(chat-local-to-self "research deck guns ")
)

(defrule
	(goal 16 0)
	(unit-type-count-total cannon-galleon-line >= 1)
	(can-research-with-escrow ri-deck-guns)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-deck-guns)
	(chat-local-to-self "research deck guns ")
)

(defrule
	(goal AllowboatTechs 1)
	(or
		(unit-type-count transport-ship > 0)
		(unit-type-count galley-line > 0)
	)
	(can-research-with-escrow ri-careening)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-careening)
	(chat-local-to-self "research careening ")
)

(defrule
	(goal 16 0)
	(goal oceanmap YES)
	(or
		(unit-type-count transport-ship > 0)
		(unit-type-count galley-line > 0)
	)
	(can-research-with-escrow ri-careening)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-careening)
	(chat-local-to-self "research careening ")
)

(defrule
	(goal AllowboatTechs 1)
	(or
		(unit-type-count transport-ship > 0)
		(unit-type-count galley-line > 0)
	)
	(can-research-with-escrow ri-dry-dock)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-dry-dock)
	(chat-local-to-self "research dry-dock ")
)

(defrule
	(goal AllowboatTechs 1)
	(can-research-with-escrow ri-shipwright)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-shipwright)
	(chat-local-to-self "research shipwright ")
)

;OTHER RESEARCH ITEMS
(defrule
	(goal 16 0)
	(can-research-with-escrow ri-ballistics)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-ballistics)
	(chat-local-to-self "research ballistics ")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-chemistry)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-chemistry)
	(chat-local-to-self "research chemistry ")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(not (can-research ri-cavalier))
	(can-research-with-escrow ri-conscription)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-conscription)
	(chat-local-to-self "research conscription")
)

#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined HUN-CIV
(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow my-unique-research)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research my-unique-research)
	(chat-local-to-self "research unique tech")
)
#end-if
#end-if

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow my-second-unique-research)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research my-second-unique-research)
	(chat-local-to-self "research unique tech 2")
)

#load-if-defined BURGUNDIANS-CIV
(defrule
	(goal AllowMilitaryTechs 1)
	(cc-players-unit-type-count any-enemy mountedmelee > 40)
	(unit-type-count-total villager > 55)
	(soldier-count > 65)
	(food-amount > 1500)
	(can-research-with-escrow my-unique-research)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research my-unique-research)
	(set-goal Estrategia Eco)
	(chat-local-to-self "research unique tech")
	(disable-self)
)
#end-if

(defrule 
	(current-age == imperial-age) 
	(research-completed my-unique-research) 
	(can-research 457)
=>	
	(research 457) 
	(chat-local-to-self "Researching Perfusion") 
)


(defrule	;200 in regicide
	(cc-players-building-type-count any-enemy town-center less-than 1)
	(cc-players-unit-type-count any-enemy villager < 5)
	(can-spy)
=>
	(spy)
	(disable-self)
)


; //////////////////////ECONOMIC////////////////////////

;market & town center
(defrule
	(goal AllowMilitaryTechs 1)
	(not (can-research ri-cavalier))
	(can-research-with-escrow ri-guilds)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-guilds)
	(chat-local-to-self "research guilds")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-loom)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-loom)
	(chat-local-to-self "research loom")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-hand-cart)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-hand-cart)
	(chat-local-to-self "research hand-cart")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-wheel-barrow)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-wheel-barrow)
	(chat-local-to-self "research wheelbarrow")
)

(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(food-amount > 700)
	(can-research-with-escrow ri-town-watch)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-town-watch)
	(chat-local-to-self "research town watch")
)

(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(population >= 200)
	(not (research-available ri-ring-archer-armor))
	(not (research-available ri-plate-mail))
	(not (research-available ri-chain-barding))
	(not (research-available ri-plate-barding))
	(can-research-with-escrow ri-town-patrol)
=>

	(research ri-town-patrol)
	(chat-local-to-self "ri-town-patrol")
)
#load-if-defined POPULATION-CAP-175
(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(population >= 175)
	(not (research-available ri-ring-archer-armor))
	(not (research-available ri-plate-mail))
	(not (research-available ri-chain-barding))
	(not (research-available ri-plate-barding))
	(can-research-with-escrow ri-town-patrol)
=>

	(research ri-town-patrol)
	(chat-local-to-self "ri-town-patrol")
)
#end-if
#load-if-defined POPULATION-CAP-150
(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(population == 150)
	(not (research-available ri-ring-archer-armor))
	(not (research-available ri-plate-mail))
	(not (research-available ri-chain-barding))
	(not (research-available ri-plate-barding))
	(can-research-with-escrow ri-town-patrol)
=>

	(research ri-town-patrol)
	(chat-local-to-self "ri-town-patrol")
)
#end-if
#load-if-defined POPULATION-CAP-125
(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(population >= 125)
	(not (research-available ri-ring-archer-armor))
	(not (research-available ri-plate-mail))
	(not (research-available ri-chain-barding))
	(not (research-available ri-plate-barding))
	(can-research-with-escrow ri-town-patrol)
=>

	(research ri-town-patrol)
	(chat-local-to-self "ri-town-patrol")
)
#end-if

(defrule
	(goal AllowMilitaryTechs 1)
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(can-research-with-escrow ri-caravan)
	
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-caravan)
	(chat-local-to-self "research caravan")
)

(defrule
	(goal 16 0)
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(research-completed castle-age)
	(can-research-with-escrow ri-coinage)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-coinage)
	(chat-local-to-self "research coinage")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(research-completed castle-age)
	(can-research-with-escrow ri-cartography)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-cartography)
	(chat-local-to-self "research cartography")
)



(defrule
	(goal 16 0)
	(or
		(players-stance any-computer ally)
		(players-stance any-human ally)
	)
	(can-research-with-escrow ri-banking)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-banking)
	(chat-local-to-self "research banking")
)

;mining-camp items
(defrule
	(goal AllowMilitaryTechs 1)
	(research-completed ri-double-bit-axe)
	(can-research-with-escrow ri-gold-mining)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-gold-mining)
	(chat-local-to-self "research gold mining")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-gold-shaft-mining)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-gold-shaft-mining)
	(chat-local-to-self "research gold shaft mining")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(building-type-count mining-camp > 1)
	(can-research-with-escrow ri-stone-mining)
	(research-completed ri-bow-saw)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-stone-mining)
	(chat-local-to-self "research stone mining")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(building-type-count mining-camp > 1)
	(can-research-with-escrow ri-stone-shaft-mining)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-stone-shaft-mining)
	(chat-local-to-self "research stone shaft mining")
)

;mill items
(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-horse-collar)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-horse-collar)
	(chat-local-to-self "research horse collar")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-heavy-plow)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-heavy-plow)
	(chat-local-to-self "research heavy plow")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-crop-rotation)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-crop-rotation)
	(chat-local-to-self "research crop rotation")
)

;saw mill
(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-double-bit-axe)	
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-double-bit-axe)
	(chat-local-to-self "research double bit axe")
)

(defrule
	(goal AllowMilitaryTechs 1)
	(can-research-with-escrow ri-bow-saw)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-bow-saw)
	(chat-local-to-self "research bow saw")
)

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-two-man-saw)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-two-man-saw)
	(chat-local-to-self "research 2 man saw")
)

;university stuff
(defrule
	(goal 16 0)
	(can-research-with-escrow ri-masonry)
        (wood-amount > 200)
        (food-amount > 200)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-masonry)
	(chat-local-to-self "research masonry")
)

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-architecture)
        (wood-amount > 600)
        (food-amount > 600)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-architecture)
	(chat-local-to-self "research architecture")
)

(defrule
	(goal 16 0)
	(can-research-with-escrow ri-stonecutting)
        (wood-amount > 500)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-stonecutting)
	(chat-local-to-self "research stonecutting")
)



; ////////////////////MONK/////////////////
(defrule
	(goal AllowMilitaryTechs 3)
	(can-research-with-escrow ri-faith)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-faith)
	(chat-local-to-self "research faith")
	(disable-self)
)

(defrule
	(goal 16 0)
	(or
		(cc-players-unit-type-count any-enemy monk > 5)
                (unit-type-count-total war-elephant-line > 5)
	)
	(can-research-with-escrow ri-faith)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-faith)
	(chat-local-to-self "research faith")
	(disable-self)
)

(defrule
	(goal 16 0)
	(or
		(cc-players-unit-type-count any-enemy monk > 3)
                (unit-type-count-total war-elephant-line > 5)
	)
	(can-research-with-escrow ri-devotion)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-devotion)
	(chat-local-to-self "research devotion")
	(disable-self)
)

(defrule
	(goal 16 0)
        (cc-players-unit-type-count any-enemy monk > 5)
	(can-research-with-escrow ri-atonement)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-atonement)
	(chat-local-to-self "research atonement")
	(disable-self)
)

(defrule
	(goal 16 0)
	(unit-type-count-total monk > 2)
	(can-research-with-escrow ri-block-printing)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-block-printing)
	(chat-local-to-self "research block printing")
	(disable-self)
)

(defrule
	(goal 16 0)
	(unit-type-count-total monk > 1)
	(can-research-with-escrow ri-illumination)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-illumination)
	(chat-local-to-self "research illumination")
	(disable-self)
)

(defrule
	(goal AllowMilitaryTechs 1)
	(unit-type-count-total monk >= 1)
	(can-research-with-escrow ri-fervor)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-fervor)
	(chat-local-to-self "research fervor")
	(disable-self)
)

(defrule
	(goal 16 0)
	(unit-type-count-total monk > 5)
	(can-research-with-escrow ri-redemption)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-redemption)
	(chat-local-to-self "research redemption")
	(disable-self)
)


(defrule
	(goal 16 0)
	(unit-type-count-total monk > 5)
	(can-research-with-escrow ri-theocracy)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-theocracy)
	(chat-local-to-self "research theocracy")
	(disable-self)
)

(defrule
	(goal 16 0)
	(unit-type-count-total monk >= 3)
	(can-research-with-escrow ri-sanctity)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-sanctity)
	(chat-local-to-self "research sanctity")
	(disable-self)
)

(defrule
	(goal 16 0)
	(current-age == imperial-age)
	(cc-players-unit-type-count any-enemy monk > 6)
	(can-research-with-escrow ri-heresy)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-heresy)
	(chat-local-to-self "research heresy")
	(disable-self)
)

;(defrule
;	(goal 16 0)
;	(civ-selected aztec)
;	(unit-type-count-total monk > 5)
;	(can-research-with-escrow ri-herbal-medicine)
;=>
;	(release-escrow wood)
;	(release-escrow food)
;	(release-escrow gold)
;	(release-escrow stone)
;	(research ri-herbal-medicine)
;	(chat-local-to-self "herbal-medicine...")
;)

;TOWERS

(defrule
	(goal AllowMilitaryTechs 1)
	(or
		(building-type-count-total castle >= 1)
		(building-type-count-total watch-tower-line > 2)
	)
	(can-research-with-escrow ri-murder-holes)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-murder-holes)
	(chat-local-to-self "research murder-holes")
	(disable-self)
)

(defrule
	(goal AllowMilitaryTechs 1)
	(building-type-count stone-wall-line > 0)
	(can-research-with-escrow ri-fortified-wall)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(research ri-fortified-wall)
	(chat-local-to-self "research fortifications")
	(disable-self)
)


(defrule
	(goal 16 0)
	(building-type-count-total watch-tower > 3)
        (wood-amount > 200)
	(can-research-with-escrow ri-arrowslits)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
        (research ri-arrowslits)
	(chat-local-to-self "research arrowslits (dispara mas flechas)")
	(disable-self)
)

(defrule
	(goal 16 0)
	(building-type-count-total watch-tower > 3)
        (wood-amount > 200)
	(can-research-with-escrow ri-guard-tower)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
        (research ri-guard-tower)
	(chat-local-to-self "research guard tower")
	(disable-self)
)


(defrule
	(goal 16 0)
	;(building-type-count-total guard-tower > 3)
	(can-research-with-escrow ri-keep)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
    	(research ri-keep)
	(chat-local-to-self "research keep")
)

(defrule
	(goal 16 0)
	(not (town-under-attack))
	(building-type-count university > 0)
	(building-type-count-total watch-tower-line > 0)
	;(research-available ri-bombard-tower)
	(can-research-with-escrow ri-bombard-tower)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
        (research ri-bombard-tower)
	(chat-local-to-self "research bombard-tower")
	(disable-self)
)

(defrule
	(goal AllowMilitaryTechs 1)
	(cc-players-building-type-count any-enemy dock > 0)
	(can-research-with-escrow ri-heated-shot)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
        (research ri-heated-shot)
	(chat-local-to-self "research heated-shot")
	(disable-self)
)



; ================ MARKET - just buys and sells when the price is right and stockpile low

; ///////////////////////// FEUDAL

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(gold-amount >= 500)
	(wood-amount <= 100)
	(commodity-buying-price wood <= 100)
	(can-buy-commodity wood)
=>
	(chat-local-to-self "Wood panic")
	(buy-commodity wood)
)

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(gold-amount >= 500)
	(food-amount <= 100)
	(commodity-buying-price food <= 100)
	(can-buy-commodity food)
=>
	(chat-local-to-self "Food panic")
	(buy-commodity food)
)

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(gold-amount >= 600)
	(stone-amount <= 100)
	(commodity-buying-price stone <= 200)
	(can-buy-commodity stone)
=>
	(chat-local-to-self "need stone")
	(buy-commodity stone)
)

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(wood-amount >= 500)
	(or
		(gold-amount < 200)
		(food-amount < 100)
	)
	(commodity-selling-price wood >= 50)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "Gold panic; sell wood")
	(sell-commodity wood)
)

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(food-amount >= 900)
	(or
		(gold-amount < 200)
		(wood-amount < 100)
	)
	(can-sell-commodity food)
=>
	(chat-local-to-self "excess food")
	(sell-commodity food)
)

(defrule
	(current-age == feudal-age)
	(game-time > 900)
	(stone-amount >= 1000)
	(or
		(gold-amount < 100)
		(wood-amount < 100)
	)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "excess stone")
	(sell-commodity stone)
)

;****************************CASTLE
(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 1000)
	(wood-amount <= 200)
	(commodity-buying-price wood <= 100)
	(can-buy-commodity wood)
=>
	(chat-local-to-self "Wood panic")
	(buy-commodity wood)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 500)
	(wood-amount <= 100)
	(can-buy-commodity wood)
=>
	(chat-local-to-self "Wood panic")
	(buy-commodity wood)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 1000)
	(food-amount <= 1000)
	(commodity-buying-price food <= 100)
	(can-buy-commodity food)
=>
	(chat-local-to-self "Food panic")
	(buy-commodity food)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 500)
	(food-amount <= 100)
	(can-buy-commodity food)
=>
	(chat-local-to-self "Food panic")
	(buy-commodity food)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 600)
	(stone-amount <= 125)
	(commodity-buying-price stone <= 200)
	(can-buy-commodity stone)
=>
	(chat-local-to-self "stone panic")
	(buy-commodity stone)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(gold-amount >= 1200)
	(stone-amount <= 650)
	(commodity-buying-price stone <= 200)
	(can-buy-commodity stone)
=>
	(chat-local-to-self "need stone")
	(buy-commodity stone)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(wood-amount >= 1000)
	(or
		(gold-amount < 800)
		(food-amount < 200)
	)
	(commodity-selling-price wood >= 25)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "Gold panic; sell wood")
	(sell-commodity wood)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(food-amount >= 1100)
	(or
		(gold-amount < 800)
		(wood-amount < 200)
	)
	(can-sell-commodity food)
=>
	(chat-local-to-self "excess food")
	(sell-commodity food)
)

(defrule
	(current-age == castle-age)
	(game-time > 900)
	(stone-amount >= 1000)
	(or
		(gold-amount < 200)
		(wood-amount < 200)
	)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "excess stone")
	(sell-commodity stone)
)

;imperial age

(defrule
	(current-age == imperial-age)
	(gold-amount >= 500)
	(wood-amount <= 200)
	(can-buy-commodity wood)
=>
	(chat-local-to-self "Wood panic")
	(buy-commodity wood)
)

(defrule
	(current-age == imperial-age)
	(gold-amount >= 500)
	(food-amount <= 200)
	(can-buy-commodity food)
=>
	(chat-local-to-self "Food panic")
	(buy-commodity food)
)

(defrule
	(current-age == imperial-age)
	(gold-amount >= 1300)
	(stone-amount <= 650)
	(can-buy-commodity stone)
=>
	(chat-local-to-self "need stone")
	(buy-commodity stone)
)


(defrule
	(current-age == imperial-age)
	(gold-amount >= 600)
	(stone-amount <= 125)
	(commodity-buying-price stone <= 250)
	(can-buy-commodity stone)
=>
	(chat-local-to-self "stone panic")
	(buy-commodity stone)
)

(defrule
	(current-age == imperial-age)
	(wood-amount >= 1100)
	(or
		(gold-amount < 1500)
		(food-amount < 200)
	)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "Gold panic; sell wood")
	(sell-commodity wood)
)

(defrule
	(current-age == imperial-age)
	(food-amount >= 1600)
	(or
		(gold-amount < 1500)
		(wood-amount < 200)
	)
	(can-sell-commodity food)
=>
	(chat-local-to-self "excess food")
	(sell-commodity food)
)

(defrule
	(current-age == imperial-age)
	(stone-amount >= 1500)
	(or
		(or
			(gold-amount < 200)
			(wood-amount < 200)
		)
		(food-amount < 200)
	)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "excess stone")
	(sell-commodity stone)
)

(defrule
	(current-age == imperial-age)
	(wood-amount >= 2000)
	(or
		(gold-amount < 3000)
		(food-amount < 200)
	)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "Gold panic; sell wood")
	(sell-commodity wood)
)

(defrule
	(current-age == imperial-age)
	(food-amount >= 2500)
	(or
		(gold-amount < 3000)
		(wood-amount < 200)
	)
	(can-sell-commodity food)
=>
	(chat-local-to-self "excess food")
	(sell-commodity food)
)


(defrule
	(current-age == imperial-age)
	(wood-amount >= 3000)
	(or
		(gold-amount < 5000)
		(food-amount < 200)
	)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "Gold panic; sell wood")
	(sell-commodity wood)
)

(defrule
	(current-age == imperial-age)
	(food-amount >= 3000)
	(or
		(gold-amount < 5000)
		(wood-amount < 200)
	)
	(can-sell-commodity food)
=>
	(chat-local-to-self "excess food")
	(sell-commodity food)
)

;******************FEEEE!*************************************;

(defrule
	(goal AllowMilitaryTechs 3)
	(gold-amount <= 1000)
	(wood-amount greater-than 600)
	(can-sell-commodity wood)
=>
	(chat-local-to-self "selling wood for faith gold")
	(sell-commodity wood)
)

(defrule
	(goal AllowMilitaryTechs 3)
	(gold-amount <= 100)
	(stone-amount greater-than 750)
	(commodity-selling-price stone greater-than 100)
	(can-sell-commodity stone)
=>
	(chat-local-to-self "selling stone for faith gold")
	(sell-commodity stone)
)

(defrule
	(goal AllowMilitaryTechs 3)
	(gold-amount <= 1000)
	(food-amount greater-or-equal 850)
	(can-sell-commodity food)
=>
	(chat-local-to-self "selling food for faith gold")
	(sell-commodity food)
)

;getting needed food
(defrule
	(goal AllowMilitaryTechs 3)
	(food-amount <= 800)
	(gold-amount greater-or-equal 1100)
	(can-buy-commodity food)
=>
	(chat-local-to-self "buying faith food")
	(buy-commodity food)
)

;***********************
;TRIBUTE

(defrule
	(true)
=>
	(enable-timer TributeTimer 1)
	(disable-self)
)

(defrule
	(or
	(taunt-detected any-ally 3)	(taunt-detected any-ally 38))
	(food-amount >= 1500)
			(building-type-count-total market >= 1)
=>
	(release-escrow food)
	(tribute-to-player this-any-ally food 500)
	(acknowledge-taunt this-any-ally 3)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "Toma, come todo lo que puedas")
	(chat-local-to-self "Tribute food")
)


(defrule
	(or
	(taunt-detected any-ally 4)	(taunt-detected any-ally 38))
	(wood-amount >= 1500)
			(building-type-count-total market >= 1)
=>
	(release-escrow wood)
	(tribute-to-player this-any-ally wood 500)
	(acknowledge-taunt this-any-ally 4)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "¡Madera, valla recurso mas inutil!")
	(chat-local-to-self "Tribute wood")
)


(defrule
	(or
	(taunt-detected any-ally 5)	(taunt-detected any-ally 38))
	(gold-amount >= 1500)
			(building-type-count-total market >= 1)
=>
	(release-escrow gold)
	(tribute-to-player this-any-ally gold 500)
	(acknowledge-taunt this-any-ally 5)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "¡Me encanta el oro!, asi que no lo derroches")
	(chat-local-to-self "Tribute gold")
)


(defrule
	(or
	(taunt-detected any-ally 6)	(taunt-detected any-ally 38))
	(stone-amount >= 1500)
			(building-type-count-total market >= 1)
=>
	(release-escrow stone)
	(tribute-to-player this-any-ally stone 500)
	(acknowledge-taunt this-any-ally 6)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "La piedra escasea en estas tierras ten cuidado como la uses")
	(chat-local-to-self "Tribute stone")
)

(defrule
	(or
	(taunt-detected any-ally 3)	(taunt-detected any-ally 38))
	(goal 16 0)
	(food-amount >= 500)
			(building-type-count-total market >= 1)
=>
	(release-escrow food)
	(tribute-to-player this-any-ally food 100)
	(acknowledge-taunt this-any-ally 3)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "Toma, come todo lo que puedas")
	(chat-local-to-self "Tribute food")
)


(defrule
	(or
	(taunt-detected any-ally 4)	(taunt-detected any-ally 38))
	(goal 16 0)
	(wood-amount >= 500)
			(building-type-count-total market >= 1)
=>
	(release-escrow wood)
	(tribute-to-player this-any-ally wood 100)
	(acknowledge-taunt this-any-ally 4)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "¡Madera, valla recurso mas inutil!")
	(chat-local-to-self "Tribute wood")
)


(defrule
	(or
	(taunt-detected any-ally 5)	(taunt-detected any-ally 38))
	(goal 16 0)
	(gold-amount >= 500)
			(building-type-count-total market >= 1)
=>
	(release-escrow gold)
	(tribute-to-player this-any-ally gold 100)
	(acknowledge-taunt this-any-ally 5)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "¡Me encanta el oro!, asi que no lo derroches")
	(chat-local-to-self "Tribute gold")
)


(defrule
	(or
	(taunt-detected any-ally 6)	(taunt-detected any-ally 38))
	(goal 16 0)
	(stone-amount >= 800)
			(building-type-count-total market >= 1)
=>
	(release-escrow stone)
	(tribute-to-player this-any-ally stone 100)
	(acknowledge-taunt this-any-ally 6)
	(acknowledge-taunt this-any-ally 38)
	(chat-to-player this-any-ally "La piedra escasea en estas tierras ten cuidado como la uses")
	(chat-local-to-self "Tribute stone")
)

(defrule
	(or
	(taunt-detected any-ally 3)	(taunt-detected any-ally 38))
	(or
	(food-amount <= 1500)
	(and
	(food-amount <= 500) 	(goal 16 0))
	)
		(building-type-count-total market >= 1)
=>
	(chat-to-player this-any-ally "Lo seinto, me estoy muriendo de ambre")
	(chat-local-to-self "No Tribute food")
	(acknowledge-taunt this-any-ally 3)
	(acknowledge-taunt this-any-ally 38)
)


(defrule
	(or
	(taunt-detected any-ally 4)	(taunt-detected any-ally 38))

	(or
	(wood-amount <= 1500)
	(and
	(wood-amount <= 500) 	(goal 16 0))
	)
		(building-type-count-total market >= 1)	
	
=>
	(chat-to-player this-any-ally "¡No tengo madera!!!")
	(chat-local-to-self "No Tribute wood")
	(acknowledge-taunt this-any-ally 4)
	(acknowledge-taunt this-any-ally 38)
)

(defrule
	(or
	(taunt-detected any-ally 5)	(taunt-detected any-ally 38))

	(or
	(gold-amount <= 1500)
	(and
	(gold-amount <= 500) 	(goal 16 0))
	)
		(building-type-count-total market >= 1)	
	
=>
	(chat-to-player this-any-ally "¡Me encanta el oro!, Pero no tengo nada `=(")
	(chat-local-to-self "no Tribute gold")
	(acknowledge-taunt this-any-ally 5)
	(acknowledge-taunt this-any-ally 38)
)


(defrule
	(or
	(taunt-detected any-ally 6)	(taunt-detected any-ally 38))
	(or
	(stone-amount <= 1500)
	(and
	(stone-amount <= 500) 	(goal 16 0))
	)
		(building-type-count-total market >= 1)
	
=>
	(chat-to-player this-any-ally "Odio la piedra siempre se acava muy rapido y cuando mas lo nesesitas.")
	(acknowledge-taunt this-any-ally 6)
	(acknowledge-taunt this-any-ally 38)
	(chat-local-to-self "no Tribute stone")
)
(defrule
	(or
	(taunt-detected any-ally 3)
	(or	
	(taunt-detected any-ally 4)
	(or
	(taunt-detected any-ally 5)	(taunt-detected any-ally 6)
	)))
	(building-type-count-total market < 1)
=>
	(chat-to-player this-any-ally "¡Pero señor no tengo mercado!")
	(acknowledge-taunt this-any-ally 3)
	(acknowledge-taunt this-any-ally 4)
	(acknowledge-taunt this-any-ally 5)
	(acknowledge-taunt this-any-ally 6)
	(chat-local-to-self "no Market!")
)

(defrule
	(taunt-detected any-ally 38)
	(building-type-count-total market < 1)
=>
	(chat-to-player this-any-ally "¡Pero señor no tengo mercado!")
	(acknowledge-taunt this-any-ally 38)
	(chat-local-to-self "no Market38")
)

(defrule
	(food-amount > 1600)
	(current-age-time > 1800)
	(players-stance any-computer ally)
	(building-type-count-total market >= 1)
=>
	(chat-to-allies "/103")
	;(chat-local-to-self "Exeso de Alimentos")
)

(defrule
	(wood-amount > 1100)
	(current-age-time > 1800)
	(players-stance any-computer ally)
	(building-type-count-total market >= 1)
=>
	(chat-to-allies "/104")
	;(chat-local-to-self "Exeso de Madera")
)

(defrule
	(gold-amount > 1200)
	(current-age-time > 1800)
	(players-stance any-computer ally)
	(building-type-count-total market >= 1)
=>
	(chat-to-allies "/105")
	;(chat-local-to-self "Exeso de ORO")
)

(defrule
	(stone-amount > 800)
	(current-age-time > 1800)
	(players-stance any-computer ally)
	(building-type-count-total market >= 1)
=>
	(chat-to-allies "/106")
	(chat-local-to-self "Exeso de piedra")
)

(defrule
	(taunt-detected any-ally 103)
	(food-amount < 500)
=>
	(chat-to-player this-any-ally "/3 Ambre!!!...")
	(acknowledge-taunt this-any-ally 103)
	(chat-local-to-self "Alimentos :)")
)

(defrule
	(taunt-detected any-ally 104)
	(wood-amount < 500)
=>
	(chat-to-player this-any-ally "/4 Gracias")
	(acknowledge-taunt this-any-ally 104)
	(chat-local-to-self "Madera...")
)

(defrule
	(taunt-detected any-ally 105)
	(gold-amount < 500)
=>
	(chat-to-player this-any-ally "/5 SI POR FAVOR! =D")
	(acknowledge-taunt this-any-ally 105)
	(chat-local-to-self "ORO!!!")
)

(defrule
	(taunt-detected any-ally 106)
	(stone-amount < 125)
=>
	(chat-to-player this-any-ally "/6 WOW!")
	(acknowledge-taunt this-any-ally 106)
	(chat-local-to-self "Imposible O.O!")
)

(defrule
	(taunt-detected any-ally 107)
=>
	(acknowledge-taunt this-any-ally 107)
	(tribute-to-player this-any-ally wood 300)
	(tribute-to-player this-any-ally stone 100)
	(chat-local-to-self "ally`s town!")
)

(defrule
	(timer-triggered TributeTimer)	
	(unit-type-count-total villager < 30)
	(building-type-count town-center >= 1)	
	(town-under-attack)	
	(current-age-time > 600)
	(current-age >= feudal-age)	
	(food-amount <= 100)
=>
	(chat-to-allies "Mis aldeanos se mueren de hambre, porfabor ¡DAME ALIMENTOS!")
	(chat-to-allies "/3")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 60)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(current-age-time > 600)
	(current-age >= feudal-age)	
	(food-amount < 300)
=>
	(chat-to-allies "Me podrias dar alimentos porfabor, tengo ambre...")
	(chat-to-allies "/3")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(goal AllowMilitaryTechs 2)
	(civ-selected persian)	
	(food-amount < 1500)
=>
	(chat-to-allies "Quiero mejorar a mis ELFANTES a ELITE, ¡dame alimentos!")
	(chat-to-allies "/3")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(goal AllowMilitaryTechs 2)
	(civ-selected byzantine)
	(food-amount < 1500)
=>
	(chat-to-allies "Mis CATAFRACTAS requieren de tegnologias, necesito alimentos.")
	(chat-to-allies "/3")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(goal AllowMilitaryTechs 2)
	(food-amount < 1000)
=>
	(chat-to-allies "Alimentos porfavor.")
	(chat-to-allies "/3")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(current-age-time > 600)
	(current-age >= feudal-age)	
	(wood-amount < 300)
=>
	(chat-to-allies "Detesto la madera... ¿me darias un poco?")
	(chat-to-allies "/4")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(goal AllowMilitaryTechs 2)
	(civ-selected korean)
	(wood-amount < 900)
=>
	(chat-to-allies "¡Madera para mis carretas de guerra!!!")
	(chat-to-allies "/4")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(current-age-time > 600)
	(current-age >= feudal-age)	
	(gold-amount < 200)
=>
	(chat-to-allies "¡ORO YA!... este.. gracias.")
	(chat-to-allies "/5")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)


(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(goal AllowMilitaryTechs 2)
	(gold-amount < 800)
=>
	(chat-to-allies "oro porfavor")
	(chat-to-allies "/5")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)

(defrule
	(timer-triggered TributeTimer)		
	(goal AllowMilitaryTechs 3)
	(gold-amount < 1000)
=>
	(chat-to-allies "Es hora de que me le paguen a mis saserdotes para curar sus pecados... :P")
	(chat-to-allies "/5")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 300)
)



(defrule
	(timer-triggered TributeTimer)		
	(building-type-count-total castle less-than 1)
	(current-age-time > 2400)
	(stone-amount < 650)
=>
	(chat-to-allies "Necesito piedra para edificar un esplendoroso castillio.")
	(chat-to-allies "/6")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)

(defrule
	(timer-triggered TributeTimer)	
	(town-under-attack)	
	(current-age-time > 600)
	(current-age >= feudal-age)	
	(stone-amount < 100)
=>
	(chat-to-allies "Yo se que hay poca, pero me podrias dar un poco.")
	(chat-to-allies "/6")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)

(defrule
	(timer-triggered TributeTimer)		
	(building-type-count-total town-center less-than 1)
	(stone-amount < 100)
	(wood-amount < 300)
=>
	(chat-to-allies "¡¡¡Necesito recursos para construir un Centro urbano de inmediato!!!")
	(chat-to-allies "/38")
	(disable-timer TributeTimer)
	(enable-timer TributeTimer 600)
)

(defrule
	(players-stance any-computer ally)	
	(building-type-count-total town-center less-than 1)
	(unit-type-count-total villager > 0)
	(stone-amount < 100)
	(wood-amount < 300)
=>
	(chat-to-allies "/107")
	(chat-local-to-self "town-center!!!")
)

(defrule
	(goal 1 19)
	(stance-toward any-human ally)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(tribute-to-player this-any-human wood 10000)
	(tribute-to-player this-any-human food 10000)
	(tribute-to-player this-any-human gold 10000)
	(tribute-to-player this-any-human stone 10000)
	(disable-self)
)

(defrule
	(goal 1 19)
	(players-population any-ally > 10)
=>
	(release-escrow wood)
	(release-escrow food)
	(release-escrow gold)
	(release-escrow stone)
	(tribute-to-player this-any-ally wood 10000)
	(tribute-to-player this-any-ally food 10000)
	(tribute-to-player this-any-ally gold 10000)
	(tribute-to-player this-any-ally stone 10000)
	(disable-self)
)


(defrule
	(goal 1 19)
=>
	(set-goal 1 9)
	(disable-self)
)


;/////////////////////////HELP!!!//////////////////


(defrule
	(true)
=>
	(enable-timer chatTimer 1)
	(disable-self)
)

(defrule
	(research-completed ri-cartography)
	(current-age-time > 90)
=>
	(chat-to-allies "Si nesecitas ayuda mandame el 12")
	(disable-self)
)

(defrule
	(timer-triggered chatTimer)				; Ally 1 answers
	(taunt-detected any-ally 12)
	(not (town-under-attack))
	(research-completed ri-cartography)
=>
	(acknowledge-taunt this-any-ally 12)
	(chat-to-allies "No te preocupes mis tropas estan en camino")
	(set-strategic-number sn-target-evaluation-ally-proximity 10000)
	(attack-now)
	(disable-timer chatTimer)
	(enable-timer chatTimer 120)
)

(defrule
	(goal isTreaty NO)
	(timer-triggered chatTimer)
	(not (town-under-attack))				; Ally 1 answers
		(taunt-detected any-ally 201)
		(not (goal Wonderr 3))
	(research-completed ri-cartography)
=>
		(acknowledge-taunt this-any-ally 201)
	(chat-to-allies "No te preocupes mis tropas estan en camino, viejo :P")
	(attack-now)
	(disable-timer chatTimer)
	(enable-timer chatTimer 600)
)

(defrule
	(player-in-game any-ally)					; Player asks help
	(goal ArmyAdvantage ENEMY)
	(timer-triggered chatTimer)
	(town-under-attack)
=>
	(chat-to-allies "/12 NESESITO AYUDAAAAAAAAAA!!!!!!")
	(disable-timer chatTimer)
	(enable-timer chatTimer 300)
)


;*********************************
;***** AI/ENEMY SCORE DETECT *****
;*********************************

(defrule							; Goal initialization
	(true)
=>
	(set-goal Advantage NONE)
	(set-goal ArmyAdvantage NONE)
	(disable-self)
)

(defrule
	(or	(and (current-score > 1300)					; Rules for
		     (players-score every-enemy < 1000)		; managing score advantage/disadvantage/equality
		)											; from 1000 to 2000 points
		(or (and (current-score > 1600)
		         (players-score every-enemy < 1300)
			)
			(and (current-score > 2000)
		         (players-score every-enemy < 1600)
			)
		)
	)
=>
	(set-goal Advantage PLAYER)
)

(defrule
	(or	(and (current-score < 1000)
		     (players-score every-enemy > 1300)
		)
		(or (and (current-score < 1300)
		         (players-score every-enemy > 1600)
			)
			(and (current-score < 1600)
		         (players-score every-enemy > 2000)
			)
		)
	)
=>
	(set-goal Advantage ENEMY)
)

(defrule
	(or	(and(and(current-score > 1000)
				(current-score < 1300)
			)
			(and(players-score any-enemy > 1000)
				(players-score any-enemy < 1300)
			)
		)
		(and(and(current-score > 1300)
				(current-score < 1600)
			)
			(and(players-score any-enemy > 1300)
				(players-score any-enemy < 1600)
			)
		)
	)
=>
	(set-goal Advantage NONE)
)

(defrule
	(current-score > 1600)
	(current-score < 2000)
	(players-score any-enemy > 1600)
	(players-score any-enemy < 2000)
=>
	(set-goal Advantage NONE)
)

(defrule
	(or	(and (current-score > 2600)					; Rules for
		     (players-score every-enemy < 2000)		; managing score advantage/disadvantage/equality
		)											; from 2000 to 4000 points
		(or (and (current-score > 3200)
		         (players-score every-enemy < 2600)
			)
			(and (current-score > 4000)
		         (players-score every-enemy < 3200)
			)
		)
	)
=>
	(set-goal Advantage PLAYER)
)

(defrule
	(or	(and (current-score < 2000)
		     (players-score every-enemy > 2600)
		)
		(or (and (current-score < 2600)
		         (players-score every-enemy > 3200)
			)
			(and (current-score < 3200)
		         (players-score every-enemy > 4000)
			)
		)
	)
=>
	(set-goal Advantage ENEMY)
)

(defrule
	(or	(and(and(current-score > 2000)
				(current-score < 2600)
			)
			(and(players-score any-enemy > 2000)
				(players-score any-enemy < 2600)
			)
		)
		(and(and(current-score > 2600)
				(current-score < 3200)
			)
			(and(players-score any-enemy > 2600)
				(players-score any-enemy < 3200)
			)
		)
	)
=>
	(set-goal Advantage NONE)
)

(defrule
	(current-score > 3200)
	(current-score < 4000)
	(players-score any-enemy > 3200)
	(players-score any-enemy < 4000)
=>
	(set-goal Advantage NONE)
)

(defrule
	(or	(and (current-score > 5200)					; Rules for
		     (players-score every-enemy < 4000)		; managing score advantage/disadvantage/equality
		)											; from 4000 to 8000 points
		(or (and (current-score > 6400)
		         (players-score every-enemy < 5200)
			)
			(and (current-score > 8000)
		         (players-score every-enemy < 6400)
			)
		)
	)
=>
	(set-goal Advantage PLAYER)
)

(defrule
	(or	(and (current-score < 4000)					; Rules for
		     (players-score every-enemy > 5200)		; managing score advantage/disadvantage/equality
		)											; from 2000 to 4000 points
		(or (and (current-score < 5200)
		         (players-score every-enemy > 6400)
			)
			(and (current-score < 6400)
		         (players-score every-enemy > 8000)
			)
		)
	)
=>
	(set-goal Advantage ENEMY)
)

(defrule
	(or	(and(and(current-score > 4000)
				(current-score < 5200)
			)
			(and(players-score any-enemy > 4000)
				(players-score any-enemy < 5200)
			)
		)
		(and(and(current-score > 5200)
				(current-score < 6400)
			)
			(and(players-score any-enemy > 5200)
				(players-score any-enemy < 6400)
			)
		)
	)
=>
	(set-goal Advantage NONE)
)

(defrule
	(current-score > 6400)
	(current-score < 8000)
	(players-score any-enemy > 6400)
	(players-score any-enemy < 8000)
=>
	(set-goal Advantage NONE)
)

(defrule
	(or	(and (current-score > 10400)				; Rules for
		     (players-score every-enemy < 8000)		; managing score advantage/disadvantage/equality
		)											; from 8000 to 16000 points
		(or (and (current-score > 12800)
		         (players-score every-enemy < 10400)
			)
			(and (current-score > 16000)
		         (players-score every-enemy < 10400)
			)
		)
	)
=>
	(set-goal Advantage PLAYER)
)

(defrule
	(or	(and (current-score < 8000)
		     (players-score every-enemy > 10400)
		)
		(or (and (current-score < 10400)
		         (players-score every-enemy > 12800)
			)
			(and (current-score < 12800)
		         (players-score every-enemy > 16000)
			)
		)
	)
=>
	(set-goal Advantage ENEMY)
)

(defrule
	(or	(and(and(current-score > 8000)
				(current-score < 10400)
			)
			(and(players-score any-enemy > 8000)
				(players-score any-enemy < 10400)
			)
		)
		(and(and(current-score > 10400)
				(current-score < 12800)
			)
			(and(players-score any-enemy > 10400)
				(players-score any-enemy < 12800)
			)
		)
	)
=>
	(set-goal Advantage NONE)
)

(defrule
	(current-score > 12800)
	(current-score < 16000)
	(players-score any-enemy > 12800)
	(players-score any-enemy < 16000)
=>
	(set-goal Advantage NONE)
)

(defrule
	(or	(and (current-score > 20800)				; Rules for
		     (players-score every-enemy < 16000)		; managing score advantage/disadvantage/equality
		)											; from 16000 to 32000 points
		(or (and (current-score > 25600)
		         (players-score every-enemy < 20800)
			)
			(and (current-score > 32000)
		         (players-score every-enemy < 20800)
			)
		)
	)
=>
	(set-goal Advantage PLAYER)
)

(defrule
	(or	(and (current-score < 16000)
		     (players-score every-enemy > 20800)
		)
		(or (and (current-score < 20800)
		         (players-score every-enemy > 25600)
			)
			(and (current-score < 25600)
		         (players-score every-enemy > 32000)
			)
		)
	)
=>
	(set-goal Advantage ENEMY)
)

(defrule
	(or	(and(and(current-score > 16000)
				(current-score < 20800)
			)
			(and(players-score any-enemy > 16000)
				(players-score any-enemy < 20800)
			)
		)
		(and(and(current-score > 25600)
				(current-score < 20800)
			)
			(and(players-score any-enemy > 25600)
				(players-score any-enemy < 20800)
			)
		)
	)
=>
	(set-goal Advantage NONE)
)


(defrule
	(current-score > 25600)
	(current-score < 32000)
	(players-score any-enemy > 25600)
	(players-score any-enemy < 32000)
=>
	(set-goal Advantage NONE)
)


;********************************
;***** AI/ENEMY ARMY DETECT *****
;********************************

(defrule
	(or	(or	(and(players-military-population every-enemy > 10)
				(military-population < 5)
			)
			(and(players-military-population every-enemy > 15)
				(military-population < 10)
			)
		)
		(or	(and(players-military-population every-enemy > 20)
				(military-population < 14)
			)
			(and(players-military-population every-enemy > 25)
				(military-population < 17)
			)
		)
	)
=>
	(set-goal ArmyAdvantage ENEMY)
)

(defrule
	(or	(or	(and(players-military-population every-enemy > 30)
				(military-population < 20)
			)
			(and(players-military-population every-enemy > 40)
				(military-population < 26)
			)
		)
		(or	(and(players-military-population every-enemy > 50)
				(military-population < 33)
			)
			(and(players-military-population every-enemy > 60)
				(military-population < 40)
			)
		)
	)
=>
	(set-goal ArmyAdvantage ENEMY)
)

(defrule
	(or	(or	(and(players-military-population every-enemy > 70)
				(military-population < 47)
			)
			(and(players-military-population every-enemy > 80)
				(military-population < 53)
			)
		)
		(or	(and(players-military-population every-enemy > 90)
				(military-population < 60)
			)
			(and(players-military-population every-enemy > 95)
				(military-population < 67)
			)
		)
	)
=>
	(set-goal ArmyAdvantage ENEMY)
)

(defrule
	(or	(or	(and(players-military-population every-enemy < 5)
				(military-population > 10)
			)
			(and(players-military-population every-enemy < 10)
				(military-population > 15)
			)
		)
		(or	(and(players-military-population every-enemy < 14)
				(military-population > 20)
			)
			(and(players-military-population every-enemy < 17)
				(military-population > 20)
			)
		)
	)
=>
	(set-goal ArmyAdvantage PLAYER)
)

(defrule
	(or	(or	(and(players-military-population every-enemy < 20)
				(military-population > 30)
			)
			(and(players-military-population every-enemy < 26)
				(military-population > 40)
			)
		)
		(or	(and(players-military-population every-enemy < 33)
				(military-population > 50)
			)
			(and(players-military-population every-enemy < 40)
				(military-population > 60)
			)
		)
	)
=>
	(set-goal ArmyAdvantage PLAYER)
)

(defrule
	(or	(or	(and(players-military-population every-enemy < 47)
				(military-population > 70)
			)
			(and(players-military-population every-enemy < 53)
				(military-population > 80)
			)
		)
		(or	(and(players-military-population every-enemy < 60)
				(military-population > 90)
			)
			(and(players-military-population every-enemy < 67)
				(military-population > 95)
			)
		)
	)
=>
	(set-goal ArmyAdvantage PLAYER)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 5)
				(players-military-population any-enemy <= 10)
			)
			(and(military-population >= 5)
				(military-population <= 10)
			)
		)
		(and(and(players-military-population any-enemy >= 10)
				(players-military-population any-enemy <= 15)
			)
			(and(military-population >= 10)
				(military-population <= 15)
			)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 14)
				(players-military-population any-enemy <= 20)
			)
			(and(military-population <= 20)
				(military-population >= 14)
			)
		)
		(and(and(players-military-population any-enemy >= 17)
				(players-military-population any-enemy <= 25)
			)
			(and(military-population >= 17)
				(military-population <= 25)
			)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 20)
				(players-military-population any-enemy <= 30)
			)
			(and(military-population >= 20)
				(military-population <= 30)
			)
		)
		(and(and(players-military-population any-enemy >= 26)
				(players-military-population any-enemy <= 40)
			)
			(and(military-population >= 26)
				(military-population <= 40)
			)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 33)
				(players-military-population any-enemy <= 50)
			)
			(and(military-population <= 50)
				(military-population >= 33)
			)
		)
		(and(and(players-military-population any-enemy >= 40)
				(players-military-population any-enemy <= 60)
			)
			(and(military-population >= 40)
				(military-population <= 60)
			)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 47)
				(players-military-population any-enemy <= 70)
			)
			(and(military-population >= 47)
				(military-population <= 70)
			)
		)
		(and(and(players-military-population any-enemy >= 53)
				(players-military-population any-enemy <= 80)
			)
			(and(military-population >= 53)
				(military-population <= 80)
			)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)

(defrule
	(or	(and(and(players-military-population any-enemy >= 60)
				(players-military-population any-enemy <= 90)
			)
			(and(military-population <= 90)
				(military-population >= 60)
			)
		)
		(and(players-military-population any-enemy >= 67)
			(military-population >= 67)
		)
	)
=>
	(set-goal ArmyAdvantage NONE)
)


;///////////////////////////////Conteo de barcos/////////////////////////////

(defrule							; Goal initialization
	(true)
=>
	(set-goal EnemyWarboats NO)
	(disable-self)
)

(defrule
	(goal EnemyWarboats NO)
	(or	(or	(players-unit-type-count any-enemy galley-line >= 20)			; > 20 warboats!
			(players-unit-type-count any-enemy fire-ship-line >= 20)
		)
		(or	(players-unit-type-count any-enemy cannon-galleon-line >= 20)
			(players-unit-type-count any-enemy longboat-line >= 20)
		)
	)
=>
	(set-goal EnemyWarboats YES)
;	(chat-local-to-self "20 enemy warboats!")
)

(defrule
	(goal EnemyWarboats YES)
	(players-unit-type-count every-enemy galley-line < 5)			; < 5 warboats...
	(players-unit-type-count every-enemy fire-ship-line < 5)
	(players-unit-type-count every-enemy cannon-galleon-line < 5)
	(players-unit-type-count every-enemy longboat-line < 5)
=>
	(set-goal EnemyWarboats NO)
)

;/////////////////////////////////////////////////////////////////////LOAD (Acarga de archivos)///////////////////////////////////////////////////////////////
(load "AleIADE_Files\AleIA_chats")
; ============== ATTACKING -.
(load "AleIADE_Files\AleIA_attacking")
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;WALL
(load "AleIADE_Files\AleIA_build")
;////////////////////////////////////////////////////////////ESTRATEGIA!!!////////////////////////////////////////////////
(load "AleIADE_Files\AleIA_estrategia")

